function ExerciceSEQ(choixCorrect,inserePremier) { this.indications; this.commentaireSucces=null; this.consigne=null; this.scoreCourant=0; this.scoreTotal; this.scoreMin=0;this.scoreMaxPoids=0; this.valide=false; this.titre=''; this.actif=true; this.type="SEQ"; this.choixCorrect=choixCorrect; this.tabCellulesOrdonnees; this.zoneMelange; this.zoneReponse; this.numAjoutCourant=0; this.tabToutesCellules; this.inserePremier=inserePremier; this.ordreIndifferent=false; this.disposition; this.remetInsereNormal=false;this.niveauCertitude=-1; this.existeClasseCorrection=false;this.existeClasseSuggRef=false;this.transitionCSS="";this.dureeTransitionCSS=0;this.init=exo_init;this.initEchelleScore=exo_initEchelleScore;this.valider=exo_valider;this.action=exo_action;this.initialiser=exo_initialiser; this.desactiver=exo_desactiver; this.solutions=exo_solutions;this.donneSuggestion=exo_donneSuggestion;this.donneTabReponses=exo_donneTabReponses;this.afficherMesReponses=exo_afficherMesReponses;this.estDansListeJuste=exo_estDansListeJuste;this.corrigerReponses=exo_corrigerReponses;this.enleverCorrection=exo_enleverCorrection;this.marquerSuggestionRef=exo_marquerSuggestionRef;this.marquerObjetSelectionne=exo_marquerObjetSelectionne;this.effacerMarqueSuggestionRef=exo_effacerMarqueSuggestionRef;}function exo_init(){ this.titre=document.title; this.indications= new Array(); this.tabCellulesOrdonnees= new Array(); this.tabToutesCellules= new Array(); this.existeClasseCorrection=classeCSSExiste(".STY_objetSeqJuste");this.existeClasseSuggRef=classeCSSExiste(".STY_objetSeqSuggRef"); var oTab=PF_donneObjet("tableauOrdonne"); if (oTab!=null){ var lescellules=new Array(); for (var i=0;i<oTab.childNodes.length;i++){ if (oTab.childNodes[i].nodeName.toLowerCase()=="span" && oTab.childNodes[i].getAttribute("id")!=null){ lescellules.push(oTab.childNodes[i]); } } for (var i=0;i<lescellules.length;i++){ var oCell=lescellules[i]; var lid=oCell.getAttribute("id"); if (lid && (oCell.innerHTML!="")&&(lid.indexOf("conteneur")==0)){ var lidc=lid.substring(9); this.tabCellulesOrdonnees.push(lidc); this.tabToutesCellules.push(lidc); } } if (this.disposition=="V"){ this.zoneMelange=PF_donneObjet("STY_texteSEQV");this.zoneReponse=PF_donneObjet("STY_reponseSEQV");PF_masquerDiv("STY_zoneSEQH"); } else { this.zoneMelange=PF_donneObjet("zoneSeqAffichage");this.zoneReponse=PF_donneObjet("STY_reponseSEQ");PF_masquerDiv("STY_zoneSEQV");} var oTabRestant=PF_donneObjet("tableauRestant"); var oCell=oTabRestant.firstChild; while (oCell!=null){ var oSuiv=oCell.nextSibling; var lid=oCell.getAttribute("id"); if (oCell.innerHTML!="" && lid && lid.indexOf("conteneur")==0){ oTab.appendChild(oCell); this.tabToutesCellules.push(lid.substring(9)); } oCell=oSuiv; }lescellules=new Array(); for (var i=0;i<oTab.childNodes.length;i++){ if (oTab.childNodes[i].nodeName.toLowerCase()=="span" && oTab.childNodes[i].getAttribute("id")!=null){ lescellules.push(oTab.childNodes[i]); } }var totalR=lescellules.length;if (totalR>1){melangerReponses(lescellules,totalR);melangerReponses(lescellules,totalR);melangerReponses(lescellules,totalR);melangerReponses(lescellules,totalR+1);melangerReponses(lescellules,totalR+3);melangerReponses(lescellules,totalR-2);melangerReponses(lescellules,totalR-1);} afficherObjets();}}function melangerReponses(lescellules,totalR){var numN1=Math.floor(Math.random()*totalR);var numN2=Math.floor(Math.random()*totalR);if (numN1!=numN2){var oRep1=lescellules[numN1];var oRep2=lescellules[numN2];if ((oRep1!=null)&&(oRep2!=null)){if (oRep1.getAttribute("id").indexOf("obj")==0){oRep1=oRep1.parentNode;}if (oRep2.getAttribute("id").indexOf("obj")==0){oRep2=oRep2.parentNode;}if ((oRep1.getAttribute("id").indexOf("conteneur")==0)&&(oRep2.getAttribute("id").indexOf("conteneur")==0)){var lePere=oRep1.parentNode;var posInsert=oRep1.nextSibling;oRep2.parentNode.replaceChild(oRep1, oRep2);if (posInsert==oRep2){posInsert=oRep1;}lePere.insertBefore(oRep2,posInsert);}}}} function exo_initEchelleScore(){ this.scoreMaxPoids=this.tabCellulesOrdonnees.length; if (!parent.oSco.scoreBinaire&&parent.oSco.penaliserMauvaiseReponse){this.scoreMin=this.scoreTotal*-1;}}function exo_valider(){this.scoreCourant=0;var nbReps=this.tabCellulesOrdonnees.length;var numOrd=0;if (parent.oSco.penaliserMauvaiseReponse){var oCell=this.zoneReponse.firstChild;var score0=0;while (oCell!=null){var oSuiv=oCell.nextSibling;var lid=oCell.getAttribute('id');if (lid==null){lid="";}if (lid.indexOf('dupliObj')==0){var idRep=lid.substring(8);if (this.ordreIndifferent){if (this.estDansListeJuste(idRep)){score0+=1;} else {score0-=1;}} else {if (numOrd<nbReps && this.tabCellulesOrdonnees[numOrd]==idRep){score0+=1;} else {if (parent.oSco.penaliserMauvaiseReponse||!this.estDansListeJuste(idRep)){score0-=1;}}}numOrd++;}oCell=oSuiv;}if (this.scoreMaxPoids==0){return this.scoreTotal;}this.scoreCourant=Math.round(score0/this.scoreMaxPoids*10)/10*this.scoreTotal;} else {var poidT=0;for(var i=0;i<this.tabToutesCellules.length;i++){var idRep=this.tabToutesCellules[i];var objDansZoneOrd=PF_donneObjet("dupliObj"+idRep);if (this.ordreIndifferent){if (objDansZoneOrd!=null && this.estDansListeJuste(idRep)){this.scoreCourant+=1;}if (objDansZoneOrd!=null || this.estDansListeJuste(idRep)){poidT++;}} else {if (objDansZoneOrd!=null && this.estDansListeJuste(idRep)){var oCell=this.zoneReponse.firstChild;numOrd=0;while (oCell!=null){var oSuiv=oCell.nextSibling;var lid=oCell.getAttribute('id');if (lid==null){lid="";}if (lid.indexOf('dupliObj')==0){if (lid.substring(8)==idRep){break;}numOrd++;}oCell=oSuiv;}if (numOrd<nbReps && this.tabCellulesOrdonnees[numOrd]==idRep){this.scoreCourant+=1;}}if (objDansZoneOrd!=null || this.estDansListeJuste(idRep)){poidT++;}}numOrd++;}if (poidT==0){return this.scoreTotal;}this.scoreCourant=Math.round(this.scoreCourant/poidT*this.scoreTotal*10)/10;}if (this.scoreCourant<0 && !parent.oSco.scoreNegatif){this.scoreCourant=0;}if (this.scoreCourant<this.scoreMin){this.scoreCourant=this.scoreMin;}if (this.scoreCourant>=this.scoreTotal){this.valide=true;}appliquerNiveauCertitude(this);}function exo_estDansListeJuste(idRep){var dansListe=false;for (var k=0;k<this.tabCellulesOrdonnees.length;k++){if (this.tabCellulesOrdonnees[k]==idRep){dansListe=true;}}return dansListe;}function exo_action(idRep){if (this.actif){var oConteneur=PF_donneObjet("conteneur"+idRep);var existeDupli=PF_donneObjet("dupliObj"+idRep);if (existeDupli){this.numAjoutCourant--;if (this.transitionCSS!=""){var positionX=existeDupli.offsetLeft;var positionY=existeDupli.offsetTop;if (valCSS(this.zoneReponse,"","position",document.defaultView)!="static"){positionX+=this.zoneReponse.offsetLeft;positionY+=this.zoneReponse.offsetTop;}var objDeplace=existeDupli.cloneNode(true);existeDupli.style.visibility="hidden";this.zoneMelange.parentNode.appendChild(objDeplace);objDeplace.style.webkitTransitionProperty="none";objDeplace.style.MozTransitionProperty="none";objDeplace.id="animObj"+idRep;objDeplace.onclick=null;objDeplace.onmouseover=null;objDeplace.style.position="absolute";objDeplace.style.left=positionX+"px";objDeplace.style.top=positionY+"px";setTimeout("suiteDeplacementObjet('"+objDeplace.id+"',true)",50);} else {existeDupli.parentNode.removeChild(existeDupli);oConteneur.style.visibility="visible";}actionDetecteSEQ();} else {var ajout=true;if ((this.choixCorrect)){if ((!this.ordreIndifferent)||(!this.estDansListeJuste(idRep))){if (!((etatEval)&&(parent.oSco.evaluation.etatCorrige))){ajout=false;}}}var numPos=this.numAjoutCourant;if ((this.inserePremier)&&(!this.remetInsereNormal)){numPos=this.tabCellulesOrdonnees.length-this.numAjoutCourant-1;}if (this.numAjoutCourant<this.tabCellulesOrdonnees.length){if (this.tabCellulesOrdonnees[numPos]==idRep){ajout=true;} else {if (!this.ordreIndifferent){var oObjet=PF_donneObjet("obj"+idRep);var contenuCourant=oObjet.innerHTML;for (var j=0;j<this.tabCellulesOrdonnees.length;j++){var idAutre=this.tabCellulesOrdonnees[j];if (idAutre!=idRep){var objAutre=PF_donneObjet("obj"+idAutre);if (objAutre.innerHTML==contenuCourant){if (this.tabCellulesOrdonnees[numPos]==idAutre){ajout=false;return this.action(idAutre);}}}}}}}if (ajout){var oObjet=PF_donneObjet("obj"+idRep);var oCopie=oObjet.cloneNode(true);oCopie.setAttribute("id","dupliObj"+idRep);oCopie.className="STY_objetSeq";oConteneur.style.visibility="hidden";if ((this.inserePremier)&&(!this.remetInsereNormal)){this.zoneReponse.insertBefore(oCopie,this.zoneReponse.firstChild);} else {this.zoneReponse.appendChild(oCopie);}this.numAjoutCourant++;if (this.transitionCSS=="" && document.defaultView){this.transitionCSS=valCSS(oObjet,"",parent.oSco.extensionNavig()+"transition-property",document.defaultView);if (this.transitionCSS==null||this.transitionCSS=="all"){this.transitionCSS="";}if (this.transitionCSS!=""){this.dureeTransitionCSS=GEN_dureeTransitionCssObjet(oObjet);}}if (this.transitionCSS!=""){var positionX=oObjet.offsetLeft;var positionY=oObjet.offsetTop;oCopie.style.visibility="hidden";var objDeplace=oCopie.cloneNode(true);this.zoneMelange.parentNode.appendChild(objDeplace);objDeplace.style.webkitTransitionProperty="none";objDeplace.style.MozTransitionProperty="none";objDeplace.id="animObj"+idRep;objDeplace.onclick=null;objDeplace.onmouseover=null;objDeplace.style.position="absolute";objDeplace.style.left=positionX+"px";objDeplace.style.top=positionY+"px";setTimeout("suiteDeplacementObjet('"+objDeplace.id+"',false)",50);}actionDetecteSEQ();}}}}function suiteDeplacementObjet(lid,retour){var obj=PF_donneObjet(lid);obj.style.visibility="";obj.style.webkitTransitionProperty=exo.transitionCSS;obj.style.MozTransitionProperty=exo.transitionCSS;if (retour){var oFin=PF_donneObjet(lid.replace("animObj","obj"));var positionX=oFin.offsetLeft;var positionY=oFin.offsetTop;if (valCSS(exo.zoneReponse,"","position",document.defaultView)!="static"){positionX+=exo.zoneReponse.offsetLeft;positionY+=exo.zoneReponse.offsetTop;}} else {var oFin=PF_donneObjet(lid.replace("animObj","dupliObj"));var positionX=oFin.offsetLeft;var positionY=oFin.offsetTop;if (valCSS(exo.zoneReponse,"","position",document.defaultView)!="static"){positionX+=exo.zoneReponse.offsetLeft;positionY+=exo.zoneReponse.offsetTop;}}obj.style.left=positionX+"px";obj.style.top=positionY+"px";setTimeout("finDeplacementObjet('"+lid+"',"+retour+")",exo.dureeTransitionCSS);}function finDeplacementObjet(lid,retour){var obj=PF_donneObjet(lid);if (retour){var oFin=PF_donneObjet(lid.replace("animObj","dupliObj"));oFin.parentNode.removeChild(oFin);oFin=PF_donneObjet(lid.replace("animObj","conteneur"));oFin.style.visibility="visible";} else {var oFin=PF_donneObjet(lid.replace("animObj","dupliObj"));oFin.style.visibility="visible";}obj.parentNode.removeChild(obj);}function actionDetecteSEQ(){if (parent.oSco.forcerReponse){if (exo.zoneReponse.firstChild!=null){actionDetecte();}else if (actionD){actionD=false;desactiverBoutonValider();desactiverBoutonInit();}} else {actionDetecte();}}function exo_initialiser(){this.actif=true;if (this.TransitionCSS!=""){var lesobjs=this.zoneReponse.getElementsByTagName("div");for (var i=lesobjs.length-1;i>=0;i--){var oObj=lesobjs.item(i);if (PF_attr(oObj,"id").indexOf("dupliObj")==0){this.action(PF_attr(oObj,"id").replace("dupliObj",""));}}actionD=false;desactiverBoutonValider();desactiverBoutonInit();} else {this.zoneReponse.innerHTML="";var lesobjs=this.zoneMelange.getElementsByTagName("span");for (var i=0;i<lesobjs.length;i++){var oObj=lesobjs.item(i);if (oObj.getAttribute("id").indexOf("conteneur")==0){oObj.style.visibility="visible";}}}this.numAjoutCourant=0;this.scoreCourant=0;this.valide=false;this.remetInsereNormal=false;this.enleverCorrection();}function afficherObjets(){var oTab=PF_donneObjet("tableauOrdonne");exo.zoneMelange.innerHTML="";exo.zoneReponse.innerHTML=""; var oCell=oTab.firstChild; while (oCell!=null){ var oSuiv=oCell.nextSibling; if ((oCell.getAttribute('id').indexOf('conteneur')==0)&&(oCell.innerHTML!='')){ exo.zoneMelange.appendChild(oCell); } oCell=oSuiv; }}function exo_desactiver(){this.actif=false;}function exo_solutions(){this.initialiser();this.actif=true;this.remetInsereNormal=true;for (var i=0;i<this.tabCellulesOrdonnees.length;i++){this.action(this.tabCellulesOrdonnees[i]);}desactiverBoutonInit();this.remetInsereNormal=false;this.corrigerReponses(false);}function exo_donneSuggestion(){var res=null;var i=0;while (i<exo.indications.length){if (exo.indications[i].id.indexOf('divSugg')==0){var ref=exo.indications[i].ref;if (exo.indications[i].ref!='' && PF_donneObjet("dupliObj"+ref)!=null && suggestionDejaAffiche.indexOf(exo.indications[i].id+',')<0){res=exo.indications[i];break;}}i++;}if (res==null){i=0;while (i<exo.indications.length){if (exo.indications[i].id.indexOf('divSugg')==0){if (exo.indications[i].ref=='' && suggestionDejaAffiche.indexOf(exo.indications[i].id+',')<0){res=exo.indications[i];break;}}i++;}}return res;}function exo_donneTabReponses(){var tabRep=new Array();var tabInteraction=new Array();tabInteraction[0]=this.valide;var chReps="";var txtDesc="";var oCell=this.zoneReponse.firstChild;while (oCell!=null){var oSuiv=oCell.nextSibling;var lid=oCell.getAttribute('id');if (lid==null){lid="";}if (lid.indexOf('dupliObj')==0){var idRep=lid.substring(8);if (chReps!=''){chReps+="[,]";}chReps+=idRep;if (txtDesc!=''){txtDesc+=", ";}txtDesc+=texteReponse(oCell);}oCell=oSuiv;}tabInteraction[1]=chReps;tabInteraction[2]="seq";tabInteraction[3]=txtDesc;tabInteraction[4]="sequencing";if (this.ordreIndifferent){tabInteraction[3]="choice";}tabRep[0]=tabInteraction;return tabRep;}function exo_afficherMesReponses(tabRep){this.actif=true;this.remetInsereNormal=true;if (tabRep.length!=1){return false;}var oInteraction=tabRep[0];var lesreps=oInteraction.learner_response.split("[,]");for (var j=0;j<lesreps.length;j++){this.action(lesreps[j]);}this.remetInsereNormal=false;}function sourisDessus(obj){ if (exo.actif && obj.className.indexOf("STY_objetSeqDessus")<0){ var ajoutSugg=""; if (exo.existeClasseSuggRef && obj.className.indexOf("STY_objetSeqSuggRef")>0){ajoutSugg=" STY_objetSeqSuggRef";} if (exo.existeClasseCorrection && obj.className.indexOf("STY_objetSeqJuste")>0){ajoutSugg+=" STY_objetSeqJuste";} if (exo.existeClasseCorrection && obj.className.indexOf("STY_objetSeqFaux")>0){ajoutSugg+=" STY_objetSeqFaux";} obj.className='STY_objetSeqDessus'+ajoutSugg; }}function sourisDehors(obj){ var ajoutSugg=""; if (exo.existeClasseSuggRef && obj.className.indexOf("STY_objetSeqSuggRef")>0){ajoutSugg=" STY_objetSeqSuggRef";} if (exo.existeClasseCorrection && obj.className.indexOf("STY_objetSeqJuste")>0){ajoutSugg+=" STY_objetSeqJuste";} if (exo.existeClasseCorrection && obj.className.indexOf("STY_objetSeqFaux")>0){ajoutSugg+=" STY_objetSeqFaux";}obj.className='STY_objetSeq'+ajoutSugg;}function texteReponse(obj){var vDesc=parent.XML_texteNoeud(obj);if (vDesc==""){var lesimg=obj.getElementsByTagName("img");if (lesimg.length>0){vDesc=lesimg[0].title;}}return vDesc;}function exo_corrigerReponses(montreFaux){if (!this.existeClasseCorrection){return;}if (montreFaux && !classeCSSExiste(".STY_objetSeqFaux")){return;}for(var i=0;i<this.tabToutesCellules.length;i++){this.marquerObjetSelectionne(this.tabToutesCellules[i],montreFaux)}}function exo_marquerObjetSelectionne(idRep,montreFaux){var objDansZoneOrd=PF_donneObjet("dupliObj"+idRep);if (objDansZoneOrd!=null){if (this.ordreIndifferent){if (this.estDansListeJuste(idRep)){objDansZoneOrd.className="STY_objetSeq STY_objetSeqJuste";} else if (montreFaux){objDansZoneOrd.className="STY_objetSeq STY_objetSeqFaux";}} else {var repCorrecte=false;if (this.estDansListeJuste(idRep)){var oCell=this.zoneReponse.firstChild;numOrd=0;while (oCell!=null){var oSuiv=oCell.nextSibling;var lid=oCell.getAttribute('id');if (lid==null){lid="";}if (lid.indexOf('dupliObj')==0){if (lid.substring(8)==idRep){break;}numOrd++;}oCell=oSuiv;}if (numOrd<this.tabCellulesOrdonnees.length && this.tabCellulesOrdonnees[numOrd]==idRep){objDansZoneOrd.className="STY_objetSeq STY_objetSeqJuste";repCorrecte=true;}}if (!repCorrecte && montreFaux){objDansZoneOrd.className="STY_objetSeq STY_objetSeqFaux";}}}}function exo_marquerSuggestionRef(idRep){if (!this.existeClasseSuggRef){return;}var obj=PF_donneObjet("dupliObj"+idRep);if (obj!=null){if (obj.className.indexOf("STY_objetSeqSuggRef")<0){obj.className+=" STY_objetSeqSuggRef";}}}function exo_effacerMarqueSuggestionRef(){}function exo_enleverCorrection(){}function EXO_solutionDirecte(){if ((!etatEval || !parent.oSco.evaluation.etatCorrige) && exo.existeClasseCorrection){var i=0;while (i<exo.indications.length){if (exo.indications[i].ref.indexOf("[solution]")==0){return true;}i++;}}return false;}
