function ExerciceGD() { this.indications; this.commentaireSucces=null; this.consigne=null; this.tabCibles; this.tabDeplaces; this.tabTitreCibles; this.tabTitreDeplaces; this.scoreCourant=0; this.scoreTotal; this.scoreMin=0;this.scoreMaxPoids=0;this.valide=false; this.titre=''; this.tabPaires; this.retourManque; this.retourIncorrect; this.tabDeplacesX; this.tabDeplacesY; this.decalageX; this.decalageY;this.type="GD"; this.actif=true;this.niveauCertitude=-1; this.existeClasseCorrection=false;this.existeClasseSuggRef=false;this.modeClicClic=false;this.init=exo_init;this.initEchelleScore=exo_initEchelleScore;this.valider=exo_valider; this.initialiser=exo_initialiser; this.desactiver=exo_desactiver; this.creerPairesFausses=exo_creerPairesFausses;this.donneSuggestion=exo_donneSuggestion;this.solutions=exo_solutions;this.donneTabReponses=exo_donneTabReponses;this.titreObj=exo_titreObj;this.afficherMesReponses=exo_afficherMesReponses;this.formerPaire=exo_formerPaire;this.mobileJuste=exo_mobileJuste;this.donnePaireForme=exo_donnePaire;this.corrigerReponses=exo_corrigerReponses;this.corrigerMobile=exo_corrigerMobile;this.enleverCorrection=exo_enleverCorrection;this.marquerSuggestionRef=exo_marquerSuggestionRef;this.effacerMarqueSuggestionRef=exo_effacerMarqueSuggestionRef;}function exo_init(){this.titre=document.title; this.tabCibles=new Array(); this.tabDeplaces=new Array(); this.tabPaires=new Array(); this.indications= new Array(); this.tabDeplacesX= new Array(); this.tabDeplacesY= new Array(); this.tabTitreCibles= new Array(); this.tabTitreDeplaces= new Array(); this.existeClasseCorrection=classeCSSExiste(".STY_mobileJuste");this.existeClasseSuggRef=classeCSSExiste(".STY_mobile1SuggRef");if (navigator.userAgent.indexOf("WebKit")>0&&(navigator.userAgent.indexOf("iPhone")>0||navigator.userAgent.indexOf("iPad")>0)||navigator.userAgent.indexOf("Android")>0){this.modeClicClic=true;}if (navigator.appName=="Opera" && (navigator.userAgent.indexOf("SymbOS")>0||navigator.userAgent.indexOf("Windows Mobile")>0)){this.modeClicClic=true;}}function exo_initEchelleScore(){var scoreMaxPoids=0;for (var i=0; i<exo.tabDeplaces.length ; i++){ var idMobile=exo.tabDeplaces[i]; var poidsJusteMax=0; for (var j=0;j<this.tabPaires.length;j++){ var oPaire=this.tabPaires[j]; if (oPaire.idDeplace==idMobile && oPaire.correction==CODE_V){ if (oPaire.poids>poidsJusteMax){poidsJusteMax=oPaire.poids;} } } scoreMaxPoids+=poidsJusteMax; var oDiv=PF_donneObjet("exoGD"+this.tabDeplaces[i]); if (oDiv.className=="GD_bordureDIV"){oDiv.className="STY_mobile";} if (this.modeClicClic){ addSwipeListenerGD(oDiv); } else {try {oDiv.style.cursor="move";}catch(e){}}}this.scoreMaxPoids=scoreMaxPoids;if (!parent.oSco.scoreBinaire && scoreMaxPoids!=0 && parent.oSco.penaliserMauvaiseReponse){this.scoreMin=this.scoreTotal*-1;}if (this.modeClicClic){PF_donneObjet("STY_texteGD").onclick=evtClicSurZoneGD;}}function exo_valider(){var score0=0;for (var i=0;i<this.tabDeplaces.length;i++){var oPaire=this.donnePaireForme(this.tabDeplaces[i]);if (oPaire!=null){if (this.mobileJuste(this.tabDeplaces[i])){score0+=oPaire.poids;} else {if (parent.oSco.penaliserMauvaiseReponse){score0-=oPaire.poids;} else {var existePaireJuste=false;for (var j=0;j<this.tabPaires.length;j++){ var oPaire=this.tabPaires[j]; if (oPaire.idDeplace==this.tabDeplaces[i] && oPaire.correction==CODE_V){ existePaireJuste=true;break; } } if (!existePaireJuste){score0-=oPaire.poids;} }}}} if (this.scoreMaxPoids==0){this.scoreCourant=this.scoreTotal;} else{this.scoreCourant=Math.round(score0/this.scoreMaxPoids*this.scoreTotal*10)/10;} if (this.scoreCourant<0 && !parent.oSco.scoreNegatif){this.scoreCourant=0;}if (this.scoreCourant>=this.scoreTotal){this.valide=true;}appliquerNiveauCertitude(this);}function exo_initialiser(){for (var i=0; i!=this.tabDeplaces.length ; i++){var oDiv=PF_donneObjet("exoGD"+this.tabDeplaces[i]);oDiv.style.left=this.tabDeplacesX[i];oDiv.style.top=this.tabDeplacesY[i];try {oDiv.style.cursor="move";}catch(e){}}for (var j=0; j!=this.tabPaires.length ; j++){this.tabPaires[j].paireForme=false;}this.actif=true;this.scoreCourant=0;this.valide=false;this.enleverCorrection();this.effacerMarqueSuggestionRef();if (this.modeClicClic && mobileCourantSelClic){mobileCourantSelClic.className=mobileCourantSelClic.className.replace(/ STY_mobile\d*Sel/,"");mobileCourantSelClic=null;deplacement=false;}}function exo_desactiver(){deplacement=false;this.actif=false;for (var i=0; i!=this.tabDeplaces.length ; i++){var oDiv=PF_donneObjet("exoGD"+this.tabDeplaces[i]);try {oDiv.style.cursor="default";}catch(e){}}}function exo_creerPairesFausses(){var i,j,k; for (i=0; i!=exo.tabDeplaces.length ; i++){ for (j=0; j!=exo.tabCibles.length ;j++){ var existeP=false; for (k=0; k!=exo.tabPaires.length ; k++){ if ((exo.tabPaires[k].idDeplace==exo.tabDeplaces[i])&&(exo.tabPaires[k].idCible==exo.tabCibles[j])){ existeP=true; } } if (!existeP){ exo.tabPaires.push(new PaireGD("_#"+exo.tabDeplaces[i],"_#"+exo.tabCibles[j],'ng','','','','')); } } }}function exo_solutions(){this.initialiser();for (var i=0; i<exo.tabDeplaces.length ; i++){ var idMobile=exo.tabDeplaces[i]; var oPairePoidsMax=null; for (var j=0;j<this.tabPaires.length;j++){ var oPaire=this.tabPaires[j]; if (oPaire.idDeplace==idMobile && oPaire.correction==CODE_V){ if (oPairePoidsMax==null || oPairePoidsMax.poids<oPaire.poids){ oPairePoidsMax=oPaire; } } } if (oPairePoidsMax!=null){this.formerPaire(oPairePoidsMax);}}this.corrigerReponses(false);}function exo_formerPaire(oPaire){var oCible=PF_donneObjet('exoGD'+oPaire.idCible);var oMobile=PF_donneObjet('exoGD'+oPaire.idDeplace);var decalX=oPaire.decalageX;if (decalX==''){decalX=this.decalageX;}var decalY=oPaire.decalageY;if (decalY==''){decalY=this.decalageY;}if (decalX!=''){var nb=parseInt(oCible.style.left)+parseInt(decalX);oMobile.style.left=nb+"px";}if (decalY!=''){var nb=parseInt(oCible.style.top)+parseInt(decalY);oMobile.style.top=nb+"px";}oPaire.paireForme=true;}function exo_donneSuggestion(){var res=null;var i=0;while (i<exo.indications.length){if (exo.indications[i].id.indexOf('divSugg')==0){var ref=exo.indications[i].ref;if (ref!='' && suggestionDejaAffiche.indexOf(exo.indications[i].id+',')<0){var tabParams=ref.split(':');for (var n=0;n<this.tabPaires.length;n++){var oPa=this.tabPaires[n];if (oPa.paireForme && tabParams[0]==oPa.idDeplace && (tabParams[1]==oPa.idCible ||(tabParams[1]=='<>'&&!this.mobileJuste(tabParams[0])))){res=exo.indications[i];i=9999;break;}}/*if (tabParams[1]=='<>'){if(!this.mobileJuste(tabParams[0])){res=exo.indications[i];break;}} else {for (var n=0;n<this.tabPaires.length;n++){var oPa=this.tabPaires[n];if (oPa.paireForme && tabParams[0]==oPa.idDeplace && tabParams[1]==oPa.idCible){res=exo.indications[i];i=9999;break;}}}*/}}i++;}if (res==null){i=0;while (i<exo.indications.length){if (exo.indications[i].id.indexOf('divSugg')==0 && exo.indications[i].ref=='' && suggestionDejaAffiche.indexOf(exo.indications[i].id+',')<0){res=exo.indications[i];break;}i++;}}return res;}function exo_donneTabReponses(){var tabRep=new Array();var tabInteraction=new Array();var chReps="";var txtDesc="";for (var i=0;i<this.tabDeplaces.length;i++){var idMobile=this.tabDeplaces[i];for (var j=0;j<this.tabPaires.length;j++){var oPar=this.tabPaires[j];if (oPar.idDeplace==idMobile && oPar.paireForme){if (chReps!=''){chReps+="[,]";}chReps+=idMobile+"[.]"+oPar.idCible;if (txtDesc!=''){txtDesc+="\n";}txtDesc+=titreMobile(oPar.idDeplace);if (parent.oSco.langue=="fr"){txtDesc+=" ";}txtDesc+=": "+titreCible(oPar.idCible);j=this.tabPaires.length;}}}tabInteraction[0]=this.valide;tabInteraction[1]=chReps;tabInteraction[2]="gd";tabInteraction[3]=txtDesc;tabRep[0]=tabInteraction;return tabRep;}function exo_afficherMesReponses(tabRep){if (tabRep.length!=1){return false;}var oInteraction=tabRep[0];var lesreps=oInteraction.learner_response.split("[,]");for (var j=0;j<lesreps.length;j++){var tabRep=lesreps[j].split("[.]");for (var k=0;k<this.tabPaires.length;k++){var oPar=this.tabPaires[k];if ((oPar.idDeplace==tabRep[0])&&(oPar.idCible==tabRep[1])){this.formerPaire(oPar);k=999;}}}}function exo_titreObj(code,type){var res=code;var tabC;var tabT;if (type=="cible"){tabC=this.tabCibles;tabT=this.tabTitreCibles;}else {tabC=this.tabDeplaces;tabT=this.tabTitreDeplaces;}for (var i=0;i<tabC.length;i++){if (tabC[i]==code){res=tabT[i];}}return res;}function exo_mobileJuste(idMobile){var existePaireJuste=false;var surPaireJuste=false;var surPaire=false;for (var j=0;j<this.tabPaires.length;j++){var oPaire=this.tabPaires[j];if (oPaire.idDeplace==idMobile){if (oPaire.correction==CODE_V){existePaireJuste=true;}if (oPaire.paireForme){surPaire=true;if (oPaire.correction==CODE_V){surPaireJuste=true;}}}}return (surPaireJuste || ((!existePaireJuste)&&(!surPaire)));}function exo_donnePaire(idMobile){var res=null;for (var j=0;j<this.tabPaires.length;j++){var oPaire=this.tabPaires[j];if (oPaire.idDeplace==idMobile){if (oPaire.paireForme){res=oPaire;break;}}}return res;}function titreMobile(lid){for (var i=0;i<exo.tabDeplaces.length;i++){if (exo.tabDeplaces[i]==lid){return exo.tabTitreDeplaces[i];}}return ""}function titreCible(lid){for (var i=0;i<exo.tabCibles.length;i++){if (exo.tabCibles[i]==lid){return exo.tabTitreCibles[i];}}return ""}function exo_corrigerReponses(montreFaux){if (!this.existeClasseCorrection){return;}if (montreFaux && !classeCSSExiste(".STY_mobileFaux")){return;}var avecEffet=false;for (var j=0;j<this.tabPaires.length;j++){var oPaire=this.tabPaires[j];if (oPaire.paireForme){if (this.corrigerMobile(oPaire.idDeplace,oPaire.correction,montreFaux)){avecEffet=true;}} }if (avecEffet){PF_affecterAlt();}}function exo_corrigerMobile(idMobile,correction,montreFaux){var existeEffet=false;var oMobile=PF_donneObjet('exoGD'+idMobile);var classe=oMobile.className;var oCnt=PF_donneObjet(oMobile.id+"fondContenu");if (oCnt!=null){existeEffet=true;oCnt.className=classe;enleveEffetMobile(oMobile,oCnt);}if (correction==CODE_V){if (classe.indexOf("Juste")<0){if (classe.indexOf("STY_mobile")<0){oMobile.className+=" STY_mobileJuste";} else {oMobile.className=classe+" "+classe+"Juste";}}} else if (montreFaux){if (classe.indexOf("Faux")<0){if (classe.indexOf("STY_mobile")<0){oMobile.className+=" STY_mobileFaux";} else {oMobile.className=classe+" "+classe+"Faux";}}}return existeEffet;}function exo_marquerSuggestionRef(ref){if (!this.existeClasseSuggRef){return;}var tabParams=ref.split(':');if (tabParams.length<2){return;}var oPaire=this.donnePaireForme(tabParams[0]);var existeEffet=false;var oMobile=null;if (oPaire){if ((tabParams[1]=="<>" && oPaire.correction!=CODE_V)||tabParams[1]==oPaire.idCible){oMobile=PF_donneObjet('exoGD'+oPaire.idDeplace);}}if (oPaire==null && tabParams[1]=="<>"){oMobile=PF_donneObjet('exoGD'+tabParams[0]);}if (oMobile!=null){var classe=oMobile.className.split(" ")[0];var oCnt=PF_donneObjet(oMobile.id+"fondContenu");if (oCnt!=null){existeEffet=true;oCnt.className=oMobile.className;enleveEffetMobile(oMobile,oCnt);}if (oMobile.className.indexOf("SuggRef")<0){classe=oMobile.className+" "+classe+"SuggRef";oMobile.className=classe;}}if (existeEffet){PF_affecterAlt();}}function exo_effacerMarqueSuggestionRef(){if (!this.existeClasseSuggRef){return;}var avecEffet=false;for (var i=0;i<this.tabDeplaces.length;i++){ var oMobile=PF_donneObjet('exoGD'+exo.tabDeplaces[i]); var classe0=oMobile.className; var classe=classe0; if (classe.indexOf("SuggRef")>0){classe=classe.replace(/ STY_mobile\d+SuggRef/,"");classe=classe.replace(" STY_mobileSuggRef","");oMobile.className=classe;var oCnt=PF_donneObjet(oMobile.id+"fondContenu");if (oCnt!=null){avecEffet=true;oCnt.className=classe0;enleveEffetMobile(oMobile,oCnt);}}}if (avecEffet){PF_affecterAlt();}}function exo_enleverCorrection(){if (!this.existeClasseCorrection){return;}var avecEffet=false;for (var i=0;i<this.tabDeplaces.length;i++){ var oMobile=PF_donneObjet('exoGD'+exo.tabDeplaces[i]); var classe0=oMobile.className; var classe=classe0; if (classe.indexOf("Juste")>0||classe.indexOf("Faux")>0){classe=classe.replace(/ STY_mobile\d+Juste/,"");classe=classe.replace(" STY_mobileJuste","");classe=classe.replace(/ STY_mobile\d+Faux/,"");classe=classe.replace(" STY_mobileFaux","");oMobile.className=classe;var oCnt=PF_donneObjet(oMobile.id+"fondContenu");if (oCnt!=null){avecEffet=true;oCnt.className=classe0;enleveEffetMobile(oMobile,oCnt);}}}if (avecEffet){PF_affecterAlt();}}function enleveEffetMobile(oMobile,oCnt){var larg=parseInt(oCnt.style.width);if (isNaN(larg)){larg=parseInt(oMobile.style.width);}var haut=parseInt(oCnt.style.height);if (isNaN(haut)){haut=parseInt(oMobile.style.height);}var estMoz=(parent.oSco.config_navigateur!="IE");if (valCSS(oCnt,"borderLeftStyle","border-left-style",estMoz)!="none"){var bordG=valCSS(oCnt,"borderLeftWidth","border-left-width",estMoz);if (bordG!="" && !isNaN(parseInt(bordG))){larg-=parseInt(bordG)*2;haut-=parseInt(bordG)*2;}} else {larg-=1;}oMobile.innerHTML=oCnt.innerHTML;var gardOptionsOmbre=valCSS(oMobile,"backgroundPosition","background-position",estMoz);oMobile.style.backgroundColor="";oMobile.style.borderLeft="";oMobile.style.borderRight="";oMobile.style.borderTop="";oMobile.style.borderBottom="";oMobile.style.border="";oMobile.style.borderColor = "";oMobile.style.borderWidth = "";oMobile.style.borderStyle = "";oMobile.style.padding="";oMobile.style.paddingLeft="";oMobile.style.paddingRight="";oMobile.style.paddingTop="";oMobile.style.paddingBottom="";if (estMoz){oMobile.style.backgroundPosition=gardOptionsOmbre;var padd=valCSS(oMobile,"borderLeftWidth","border-left-width",estMoz);if (padd!="" && padd!="medium"){larg-=parseInt(padd)*2+1;}}if (!isNaN(haut)){oMobile.style.height=haut+"px";}oMobile.style.width=larg+"px";}var mobileCourantSelClic=null;function evtClicSurMobile(evt){if (!exo.actif){return;}var oMobi;if (evt!=null){oMobi=evt.target;evt.stopPropagation();} else {oMobi=window.event.srcElement;window.event.cancelBubble=true;}while (oMobi && oMobi.id.indexOf("exoGDd")!=0){oMobi=oMobi.parentNode;}if (mobileCourantSelClic!=null && mobileCourantSelClic.id==oMobi.id){return;}if (mobileCourantSelClic!=null){mobileCourantSelClic.className=mobileCourantSelClic.className.replace(/ STY_mobile\d*Sel/,"");}mobileCourantSelClic=oMobi;var classe=oMobi.className.split(" ")[0];oMobi.className=oMobi.className+" "+classe+"Sel";}function evtClicSurZoneGD(evt){if (mobileCourantSelClic==null || !exo.actif){return;}var posY,posX;if (!evt){var evt=window.event;}posY=evt.clientY;posX=evt.clientX;var oHTML=document.getElementsByTagName("html")[0]; posX+=oHTML.scrollLeft+document.body.scrollLeft; posY+=oHTML.scrollTop+document.body.scrollTop;var oTg=PF_donneObjet("STY_texteGD");posX-=oTg.offsetLeft;posY-=oTg.offsetTop;oTg=PF_donneObjet("STY_zoneExercice");if (retrouveValCSS(oTg,"position")=="absolute"){posY-=PF_donneObjet("STY_zoneExercice").offsetTop;posX-=PF_donneObjet("STY_zoneExercice").offsetLeft;}mobileCourant=mobileCourantSelClic;mobileCourant.style.left=(posX-mobileCourant.offsetWidth/2)+"px";mobileCourant.style.top=(posY-mobileCourant.offsetHeight/2)+"px";mobileCourantSelClic.className=mobileCourantSelClic.className.replace(/ STY_mobile\d*Sel/,"");mobileCourantSelClic=null;var tempsDecal=100;var transitionCSS=valCSS(mobileCourant,"",parent.oSco.extensionNavig()+"transition-property",document.defaultView);if (transitionCSS!=null&&transitionCSS!="all"&&transitionCSS!=""){var dureeTrans=valCSS(mobileCourant,"",parent.oSco.extensionNavig()+"transition-duration",document.defaultView);if (dureeTrans && dureeTrans.indexOf("s")>0){dureeTrans=dureeTrans.split(",");tempsDecal=Number(dureeTrans[0].replace("s",""))*1000+20;}}setTimeout("deplacement=true;GD_finDep()",tempsDecal);}function EXO_solutionDirecte(){if ((!etatEval || !parent.oSco.evaluation.etatCorrige) && exo.existeClasseCorrection){var i=0;while (i<exo.indications.length){if (exo.indications[i].ref.indexOf("[solution]")==0){return true;}i++;}}return false;}function addSwipeListenerGD(el){ function cancelTouch(){ el.removeEventListener('touchmove', onTouchMove); el.removeEventListener('touchend', onTouchEnd);} function onTouchMove(e){ if (e.touches.length > 1){ cancelTouch(); }else{ GD_deplaceDiv(e); e.preventDefault(); e.stopPropagation(); }} function onTouchEnd(e){ GD_finDep(); cancelTouch(); } function onTouchStart(e){ if (e.touches.length == 1){ e.preventDefault(); e.stopPropagation(); el.addEventListener('touchmove', onTouchMove, false); el.addEventListener('touchend', onTouchEnd, false); var exoGd=e.target; while (exoGd.nodeName!="DIV" || exoGd.id==null || exoGd.id.indexOf("exoGD")!=0){ exoGd=exoGd.parentNode; } GD_debutDep(e,exoGd.id.substring(5)); } } if (window.addEventListener){ el.addEventListener('touchstart',onTouchStart,false); }}
