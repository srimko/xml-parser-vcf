var apiHandle= null;var APIfindLMSinstanceTries= 0;var noAPIFound= "false";var terminated= "false";var initok= "false";var _debug=false;function MosSCO(identifiant,titre,titreStage,nomModuleCourant,nomEntreprise,codeStage,langue) { this.titre=titre; this.tabPages; this.tabPosDocs; this.numPageCourante=0; this.version="xml"; this.identifiant=identifiant; this.codeStage=codeStage; this.exoBloquant; this.bloquantSaufAcheve=false; this.idUtil=''; this.langue=langue; this.dateMAJ=''; this.autorisePrecedent; this.dejaReussi=false; this.config_plateforme=""; this.config_navigateur=""; this.navigIE6=false; this.glossaireSurPage=""; this.boutonsSVG=""; this.formatBouton="png"; this.linaireNonVisite=false; this.titreStage=titreStage; this.nomModuleCourant=nomModuleCourant; this.nomEntreprise=nomEntreprise; this.dateCourante=''; this.indexPremierePage=0; this.exoSolutions=false; this.nbTotalPages=0; this.exoValideChoixUnique=false; this.scoreBinaire=false; this.scoreNegatif=false; this.penaliserMauvaiseReponse=true; this.forcerReponse=false; this.autoriserReprise=false; this.passageEntreActivites=true; this.niveauIncomplet=30; this.niveauComplete=100; this.refGlo=''; this.refGloExt="xml"; this.maxTempsPage=0; this.ordrePlan=""; this.tabDonneesDemarrage=null; this.afficherSolutionsDirect=false; this.notesCharge=false; this.premierePageSco=true; this.evaluation=null; this.etatEvaluation=false; this.posFenLocale; this.init = csSCO_init; this.numeroPage = csSCO_numeroPage; this.donneDate = csSCO_donneDate; this.donneNumeroPageGnr = csSCO_donneNumeroPageGnr; this.donnePourcentEffectue = csSCO_donnePourcentEffectue; this.donnePage= csSCO_donnePage; this.nombrePages= csSCO_nombrePages; this.nbExercices= csSCO_nbExercices; this.csSCO_paramDoc= csSCO_paramDoc; this.appBoutonsSVG= csSCO_appBoutonsSVG; this.extensionNavig= csSCO_extensionNavig; this.donneeLMS= csSCO_donneeLMS;}function csSCO_init(exoBloquant,versionPages,dateMAJ,objEval){this.tabPages = new Array();this.tabPosDocs = new Array(); this.exoBloquant=exoBloquant; if (versionPages!=''){this.version=versionPages;} this.dateMAJ=dateMAJ;var oDate = new Date();var mois=oDate.getMonth()+1;if (mois<10){mois='0'+mois;}var jour=oDate.getDate();if (jour<10){jour='0'+jour;} this.dateCourante=oDate.getFullYear()+'-'+mois+'-'+jour; var deb=window.location.href; deb=deb.substring(0,deb.lastIndexOf("/sco/")); this.codeStage=deb.substring(deb.lastIndexOf("/")+1); if (navigator.appName.indexOf('Microsoft')>=0 && window.XMLHttpRequest==null){ this.navigIE6=true; }}function csSCO_numeroPage(codePage){var numPg=-1;for (var n=0;n<this.tabPages.length;n++){if (this.tabPages[n].code==codePage){numPg=n;}}return numPg;}function csSCO_donneDate(date0){var res='';var indexD=0;var annee=date0.substring(indexD,indexD+4);indexD=5;var mois=date0.substring(indexD,indexD+2);indexD=8;var jour=date0.substring(indexD,indexD+2);var sep="/";if (this.langue=='de'||donnePays()=="CH"){sep=".";}res=jour+sep+mois+sep+annee;if (donnePays()=="US"){res=mois+sep+jour+sep+annee;}return res;}function donnePays(){var lang="";if (oSco.langue.indexOf("-")>0){return oSco.langue.substring(3);}if (navigator.userLanguage){lang=navigator.userLanguage;}else {lang=navigator.language;}var indT=lang.indexOf("-");if (indT>0){return lang.substring(indT+1).toUpperCase();}return "";}function csSCO_donneNumeroPageGnr(){return (this.indexPremierePage+this.numPageCourante);}function csSCO_nombrePages(){return (this.tabPages.length);} function csSCO_nbExercices(){var res=0;for (var n=0;n<this.tabPages.length;n++){if (this.tabPages[n].estExercice()){res++;}}return res;}function csSCO_donnePourcentEffectue(){var res=(this.numPageCourante+1)/this.tabPages.length*100;return (Math.round(res));}function csSCO_donnePage(numP){var res=null;if ((numP<this.tabPages.length)&&(numP>=0)){ res=this.tabPages[numP];}return res;}function csSCO_paramDoc(refDoc,numParam){var res='';for (var n=0;n<this.tabPosDocs.length;n++){var laPos=this.tabPosDocs[n];var sep=";";if (laPos.indexOf("[;]")>0){sep="[;]";}var tabparam=laPos.split(sep);if (tabparam[0]==refDoc){if (numParam<tabparam.length){res=tabparam[numParam];if (numParam==3 && res.indexOf("&amp;")>0){res=res.replace(/&amp;/g,"&");}}}}return res;}function PageContenu(titre,code,type,prerequis,score,dateMAJ,typeExo,theme){ this.titre=titre;this.code=code; this.type=type; this.prerequis=prerequis; this.score=score;this.dateMAJ=dateMAJ;this.typeExo=typeExo;this.notes="";this.theme=theme;this.dateNotes="";this.etatVisite=false;this.premiereVisite=true;this.validePrerequis=csPAGE_validePrerequis;this.estExercice=csPAGE_estExercice;}function csPAGE_validePrerequis(){if (this.prerequis=="SKIP"){return false;}if (oSco.etatEvaluation && !evalVerifPrerequis(this.prerequis)){return false;}return true;}function csPAGE_estExercice(){return (this.type=="exercice" && this.prerequis.indexOf("RESULT")!=0);}function APIinitialize(){ var strReturnVal= "false"; var hAPI= APIgetHandle(); if (hAPI != null){ strReturnVal = hAPI.Initialize("");if (strReturnVal != "true"){ APIdisplayErrorInfo(hAPI.GetLastError(),"Initialize","");} else {initok="true";} } return strReturnVal;}function APIisRunning(){var strReturnVal= "false";var hAPI=APIgetHandle();if (hAPI && initok=="true" && APIisTerminated()!="true")strReturnVal = "true";return strReturnVal;}function APIisTerminated(){return terminated;}function APIterminate(){ var strReturnVal = "false"; var hAPI= APIgetHandle(); if (hAPI!= null){ if (APIisTerminated()!="true"){ strReturnVal = hAPI.Terminate(""); if (strReturnVal!="true"){ APIdisplayErrorInfo(hAPI.GetLastError(),"Terminate",""); } else { terminated="true"; temps0=0; } } }return strReturnVal;}function APIfindLMSinstance(win){ while (win.API_1484_11==null && win.parent!=null && win.parent!=win) { APIfindLMSinstanceTries++; if (APIfindLMSinstanceTries >80){ alert("Error finding API -- too deeply nested."); return null; } win = win.parent; } return win.API_1484_11;}function APIget(){var hAPI = null;try {hAPI=APIfindLMSinstance(window);if (hAPI==null && window.opener!=null && (typeof(window.opener)!="undefined")) { hAPI = APIfindLMSinstance(window.opener);}} catch(e){} if (hAPI == null){ if (_debug){alert("Unable to find an API adapter");} noAPIFound = "true";}return hAPI;}function APIgetHandle(){ if (apiHandle == null){if (noAPIFound == "false") apiHandle = APIget(); } return apiHandle;}function APIgetValue(name){ var strReturnVal= ""; var strErrorCode= "0"; var hAPI= null; if (APIisRunning()=="true"){ hAPI = APIgetHandle(); if (hAPI != null){ strReturnVal = hAPI.GetValue(name); strErrorCode = hAPI.GetLastError(); if (strErrorCode != "0"){ APIdisplayErrorInfo(strErrorCode,name,""); } } } return strReturnVal;}function APIsetValue(strName,strVal){ var strReturnVal= "false"; var strErrorCode= "0"; var hAPI= null; if (APIisRunning()=="true"){ hAPI = APIgetHandle(); if (hAPI != null){ strReturnVal = hAPI.SetValue(strName,strVal); if (strReturnVal!="true"){ APIdisplayErrorInfo(hAPI.GetLastError(),strName,strVal); } } } return strReturnVal;}function APIcommit(){var strReturnVal= "false"; if (APIisRunning()== "true" ){var hAPI = APIgetHandle();if (hAPI!= null)strReturnVal = hAPI.Commit(""); } return strReturnVal;}function APIdisplayErrorInfo(errCode,attr,val){var hAPI=APIgetHandle();var resc="ERROR: " +errCode+"\n"+hAPI.GetDiagnostic(errCode);if (val!=""){val=" / "+val;}if (attr!=""){resc+="\n"+attr+val;} if (_debug){ alert(resc); }}function XML_texteNoeud(obj){var s = "";if (obj==null){return "";}for(var i=0;i<obj.childNodes.length;i++){var oNode = obj.childNodes[i];if(oNode.nodeType == 3)s += oNode.nodeValue;else if(oNode.nodeType == 1)s += XML_texteNoeud(oNode);}return s;}function csSCO_appBoutonsSVG(val){if (val=="oui"){this.boutonsSVG="oui";if (navigator.userAgent.indexOf("WebKit")>0){ this.formatBouton="svg"; } else if (navigator.userAgent.indexOf("Firefox")>0 && typeof(document.body.style.boxShadow)=="string"){ this.formatBouton="svg"; } else if (navigator.userAgent.indexOf("MSIE")>0 && typeof(document.body.style.boxShadow)=="string"){ this.formatBouton="svg"; }}}function csSCO_extensionNavig(val){if (navigator.userAgent.indexOf("WebKit")>0){return "-webkit-";}if (navigator.userAgent.indexOf("Firefox")>0){return "-moz-";}if (navigator.userAgent.indexOf("Opera")>0){return "-o-";}return "";}function csSCO_donneeLMS(nomAttr){if (this.tabDonneesDemarrage==null){return "";}for (var i=0;i<this.tabDonneesDemarrage.length;i++){var tabp=this.tabDonneesDemarrage[i].split("[:]");if (tabp[0]==nomAttr){return tabp[1];}}return "";}function tabRegVT(){var tabReg=new Array();tabReg[0]=new RegExp("\\[CMI_NAME\\]");tabReg[1]=new RegExp("\\[CMI_FIRSTNAME\\]");tabReg[2]=new RegExp("\\[pg\\w+\\('\\w*'\\)\\]");tabReg[3]=new RegExp("\\[LEX\\(\\d+\\)\\]");tabReg[4]=new RegExp("\\[SSP_VAR_[^\\]]+\\]");return tabReg;}function variablesTexte(obj,tabReg){var lesfils=obj.childNodes;for (var i=0;i<lesfils.length;i++){var oFils=lesfils.item(i);if (oFils.nodeType==3){var memoVal=oFils.nodeValue;var temp=memoVal;if (temp.length>5){var modif=false;if (temp.match(tabReg[0])){temp=temp.replace(tabReg[0],donneNomU());modif=true;}if (temp.match(tabReg[1])){temp=temp.replace(tabReg[1],donnePrenomU());modif=true;}if (temp.match(tabReg[2])){var debut="";var fin=temp;var n=0;var offs=temp.search(tabReg[2]);while (offs>=0 && n<20){var tlemot=fin.match(tabReg[2]);var lemot=tlemot[0];debut+=fin.substring(0,offs);fin=fin.substring(lemot.length+offs);lemot=lemot.substring(1,lemot.length-1);lemot=lemot.replace(/pg(\w+)\(/g,"donneTextePre('pg$1',");try {lemot=eval(lemot);} catch(e){lemot="";}n++;offs=fin.search(tabReg[2]);debut+=lemot;}temp=debut+fin;modif=true;}if (temp.match(tabReg[3])){var debut="";var fin=temp;var n=0;var offs=temp.search(tabReg[3]);while (offs>=0 && n<20){var tlemot=fin.match(tabReg[3]);var lemot=tlemot[0];debut+=fin.substring(0,offs);fin=fin.substring(lemot.length+offs);lemot=lemot.substring(1,lemot.length-1);lemot=lemot.replace(/\LEX\(/g,"donneTexteLex(");try {lemot=eval(lemot);} catch(e){lemot="";}n++;offs=fin.search(tabReg[3]);debut+=lemot;}temp=debut+fin;modif=true;}if (temp.match(tabReg[4])){var debut="";var fin=temp;var n=0;var offs=temp.search(tabReg[4]);while (offs>=0 && n<20){var tlemot=fin.match(tabReg[4]);var lemot=tlemot[0];debut+=fin.substring(0,offs);fin=fin.substring(lemot.length+offs);lemot=lemot.substring(1,lemot.length-1);if (lemot.indexOf("SSP_VAR_U_")==0){lemot=SCO_donneAllocation(lemot.substring(10),"learner");} else if (lemot.indexOf("SSP_VAR_C_")==0){lemot=SCO_donneAllocation(lemot.substring(10),"course");}n++;offs=fin.search(tabReg[4]);debut+=lemot;}temp=debut+fin;modif=true;}if (modif){var indRet=temp.indexOf("\n");if (indRet>0){var oSpan=oFils.ownerDocument.createElement("span");temp=temp.replace(/&/g,"&amp;");temp=temp.replace(/</g,"&lt;");temp=temp.replace(/>/g,"&gt;");oFils.parentNode.replaceChild(oSpan,oFils);oSpan.innerHTML=temp.replace(/\n/g,"<br>");} else {oFils.nodeValue=temp;}}}} else if (oFils.nodeType==1){variablesTexte(oFils,tabReg);}}}function donneTexteLex(num){return lexique.lexs[num];}function donnePrenomU(){var res='';var nom=APIgetValue("cmi.learner_name");var indexVirg=nom.indexOf(',');if (indexVirg>0){res=nom.substring(indexVirg+1);res=res.replace(/^\s+/,"");} return res;}function donneNomU(){var res='';var nom=APIgetValue("cmi.learner_name");var indexVirg=nom.indexOf(',');if (indexVirg>0){res=nom.substring(0,indexVirg);} return res;}
