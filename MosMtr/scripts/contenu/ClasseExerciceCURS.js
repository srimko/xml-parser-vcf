function ExerciceCURS() { this.indications; this.commentaireSucces=null; this.consigne=null; this.tabCurseurs; this.scoreCourant=0; this.scoreTotal=0; this.scoreMin=0;this.scoreMaxPoids=0;this.valide=false; this.titre=''; this.retourIncorrect;this.actif=true;this.type="CURS";this.scoreParValeur=false;this.niveauCertitude=-1;this.existeClasseCorrection=false;this.existeClasseSuggRef=false;this.modeTouche=false;this.init=exo_init;this.initEchelleScore=exo_initEchelleScore;this.ajouterReponse=exo_ajouterReponse;this.compterTotal=exo_compterTotal;this.valider=exo_valider; this.initialiser=exo_initialiser; this.solutions=exo_solutions;this.donneObjCurs=exo_donneObjCurs;this.donneSuggestion=exo_donneSuggestion;this.desactiver=exo_desactiver; this.donneTabReponses=exo_donneTabReponses;this.afficherMesReponses=exo_afficherMesReponses;this.corrigerReponses=exo_corrigerReponses;this.corrigerCurseur=exo_corrigerCurseur;this.marquerSuggestionRef=exo_marquerSuggestionRef;this.enleverCorrection=exo_enleverCorrection;this.effacerMarqueSuggestionRef=exo_effacerMarqueSuggestionRef;}function exo_init(){this.titre=document.title; this.indications= new Array(); this.tabCurseurs=new Array();this.existeClasseCorrection=classeCSSExiste(".STY_borneSol1");this.existeClasseSuggRef=classeCSSExiste(".STY_borneRepSuggRef1");if (navigator.userAgent.indexOf("WebKit")>0&&(navigator.userAgent.indexOf("iPhone")>0||navigator.userAgent.indexOf("iPad")>0)||navigator.userAgent.indexOf("Android")>0){this.modeTouche=true;}}function exo_initEchelleScore(){PF_afficherDiv("STY_zoneExercice");PF_affecterAlt();var scoreMaxPoids=0;for (var i=0;i<this.tabCurseurs.length;i++){var oCurseur=this.tabCurseurs[i];if (oCurseur.possedeDomaine(CODE_V)){scoreMaxPoids+=oCurseur.poids;}oCurseur.correction=CODE_F;oCurseur.valInitiale();oCurseur.juger(false);if (parent.oSco.config_navigateur=="Netscape"){var cursHtml=PF_donneObjet("divEchelle"+oCurseur.id);if (this.modeTouche){addSwipeListenerCURS(PF_donneObjet("divCurseur"+oCurseur.id));cursHtml.addEventListener('touchmove',function(e){e.preventDefault();e.stopPropagation();},false);}if (cursHtml.parentNode.style.position=="absolute"){var pere=cursHtml.parentNode;while (pere!=null && pere.nodeName!='TD'){pere=pere.parentNode;}if (pere && pere.nodeName=="TD" && pere.style.position=="relative"){var lfils=pere.firstChild;if (lfils.nodeName=="DIV"){if (lfils.style.position=""){lfils.style.position="relative";}} else {pere.innerHTML="<div style=\"position:relative\">"+pere.innerHTML+"</div>";}}}}}this.scoreMaxPoids=scoreMaxPoids;if (!parent.oSco.scoreBinaire && scoreMaxPoids!=0 && parent.oSco.penaliserMauvaiseReponse){this.scoreMin=this.scoreTotal*-1;}/*if (exo.scoreParValeur){this.scoreMin=0;for (var k=0;k<this.tabCurseurs.length;k++){var oCurs=this.tabCurseurs[k];var poids=oCurs.poids;var valMin=oCurs.valMin;var valMax=oCurs.valMax;if (valMin!="" && valMax!=""){valMin=Number(valMin);valMax=Number(valMax);if (poids!=""){poids=Number(poids);valMin*=poids;valMax*=poids;}if (valMax<valMin){this.scoreMin+=valMax;} else {this.scoreMin+=valMin;}}}}*/}function exo_ajouterReponse(num,debut,fin,correction){correction=correction-num*3;if (correction==2){correction=CODE_V;}else{correction=CODE_F;}var debut=Number(decodeX(debut))-this.scoreTotal;var fin=Number(decodeX(fin))+this.scoreTotal;var domaine = new DomaineCurseur(debut,fin,correction);var obj=this.donneObjCurs(num);obj.tabDomaines.push(domaine);}function exo_compterTotal(){var score0=0;/*if (exo.scoreParValeur){for (var k=0;k<this.tabCurseurs.length;k++){var oCurseur=this.tabCurseurs[k];var scoreCurs=oCurseur.valeurActuelle;if (oCurseur.poids!=""){scoreCurs*=Number(oCurseur.poids);}score0+=scoreCurs; }} */if (parent.oSco.penaliserMauvaiseReponse){for (var k=0;k<this.tabCurseurs.length;k++){var oCurseur=this.tabCurseurs[k];if (oCurseur.correction==CODE_V){score0+=oCurseur.poids;} else {score0-=oCurseur.poids;} }if (this.scoreMaxPoids==0){return 0;}score0=Math.round(score0/this.scoreMaxPoids*this.scoreTotal*10)/10;} else {var poisMaxItem=0;for (var k=0;k<this.tabCurseurs.length;k++){var oCurseur=this.tabCurseurs[k];if (oCurseur.correction==CODE_V){score0+=oCurseur.poids;}poisMaxItem+=oCurseur.poids;}if (poisMaxItem==0){return 0;}score0=Math.round(score0/poisMaxItem*this.scoreTotal*10)/10;}if (score0<0 && !parent.oSco.scoreNegatif){score0=0;}return score0;}function exo_valider(){this.scoreCourant=this.compterTotal();if (this.scoreCourant>=this.scoreTotal){this.valide=true;}appliquerNiveauCertitude(this);for (var i=0;i<this.tabCurseurs.length;i++){var oCurseur=this.tabCurseurs[i];var idObj=escape(oCurseur.titre);if (oCurseur.titre!=""){var compteObj=parent.SCO_compteCMI("cmi.objectives");var indexAjoute=-1;for (var t=0;t<compteObj;t++){if (parent.APIgetValue("cmi.objectives."+t+".id")==idObj){indexAjoute=t;t=999;}}if (indexAjoute>=0){var statut="failed";if (oCurseur.correction==CODE_V){statut="passed";}/*if (indexAjoute==compteObj){parent.APIsetValue("cmi.objectives."+indexAjoute+".id",idObj);}*/var debattr="cmi.objectives."+indexAjoute+".";parent.APIsetValue(debattr+"success_status",statut);parent.APIsetValue(debattr+"score.raw",oCurseur.valeurActuelle);parent.APIsetValue(debattr+"score.min",oCurseur.valMin);parent.APIsetValue(debattr+"score.max",oCurseur.valMax);var vpc=new String(oCurseur.pourcentage(oCurseur.valeurActuelle));if (vpc.length>7){vpc=vpc.substring(0,7);}parent.APIsetValue(debattr+"score.scaled",vpc);}}}}function exo_initialiser(){for (var i=0;i<this.tabCurseurs.length;i++){this.tabCurseurs[i].correction=CODE_F;this.tabCurseurs[i].valInitiale();this.tabCurseurs[i].etatDeplace=false;this.tabCurseurs[i].juger(false);}var zone=PF_donneObjet('STY_texteCURS');if (zone!=null){var lesdivs=zone.getElementsByTagName('div');for (var p=0;p<lesdivs.length;p++){var oDiv=lesdivs[p];if (oDiv.className.indexOf('STY_borne')==0){oDiv.style.display='none';}}}this.actif=true;this.scoreCourant=0;this.valide=false;this.enleverCorrection();}function exo_desactiver(){var i;this.actif=false;}function EXO_peutVoirMesReponses(){return !exo.existeClasseCorrection;}function exo_corrigerReponses(montreFaux){if (!this.existeClasseCorrection){return;}if (montreFaux && !classeCSSExiste(".STY_borneRepFaux")){return;}for (var n=0;n<this.tabCurseurs.length;n++){this.corrigerCurseur(this.tabCurseurs[n],montreFaux,false);}}function exo_marquerSuggestionRef(ref){if (!this.existeClasseSuggRef){return;}var tabParams=ref.split(':');if (tabParams.length<2){return;}var oCurs=this.donneObjCurs(tabParams[0]);this.corrigerCurseur(oCurs,true,true);}function exo_effacerMarqueSuggestionRef(idUni){if (!this.existeClasseSuggRef){return;}for (var n=0;n<this.tabCurseurs.length;n++){if (idUni==null || idUni==this.tabCurseurs[n].id){var oBorne=PF_donneObjet("borneCursSol"+this.tabCurseurs[n].id);if (oBorne!=null){oBorne.parentNode.removeChild(oBorne);}}}}function exo_corrigerCurseur(oCurs,montreFaux,montreSuggestion){if (montreFaux && !oCurs.etatDeplace){return;}var domaineTrouve=false;var oZone=PF_donneObjet('divEchelle'+oCurs.id);var lidNouv="borneCursSol"+oCurs.id;var oNouv=PF_donneObjet(lidNouv);if (oNouv==null){oNouv=document.createElement("div");oZone.appendChild(oNouv);oNouv.id=lidNouv;oNouv.style.position="absolute";}for (var k=oCurs.tabDomaines.length-1;k>=0;k--){var domaineTmp=oCurs.tabDomaines[k];var domaineTrouve=false;if (montreFaux){if (domaineTmp.curseurDedans){domaineTrouve=true;}} else {if (domaineTmp.correction==CODE_V){domaineTrouve=true;}}if (domaineTrouve){if (oCurs.vertical){oNouv.className="STY_borneSol1";var initPourcent=oCurs.pourcentage(domaineTmp.max);var posFin=Math.round((oCurs.tailleCurseur/2)+oCurs.tailleEchelle-(oCurs.tailleEchelle*initPourcent));if (posFin<0){posFin=1;}initPourcent=oCurs.pourcentage(domaineTmp.min);var pos=Math.round((oCurs.tailleCurseur/2)+oCurs.tailleEchelle-(oCurs.tailleEchelle*initPourcent));var hauteur=pos-posFin;if (montreFaux && oCurs.correction!=CODE_V){oNouv.className+=" STY_borneRepFaux";}if (montreSuggestion){oNouv.className+=" STY_borneRepSuggRef1";}posFin--;hauteur++;if (hauteur<5){hauteur=5;}oNouv.style.top=posFin+'px';oNouv.style.height=hauteur+'px';} else {var initPourcent=oCurs.pourcentage(domaineTmp.min);var pos=Math.round((oCurs.tailleCurseur/2)+oCurs.tailleEchelle*initPourcent);oNouv.className="STY_borneSol0";initPourcent=oCurs.pourcentage(domaineTmp.max);var posFin=Math.round((oCurs.tailleCurseur/2)+oCurs.tailleEchelle*initPourcent);var longueur=posFin-pos;if (montreFaux && oCurs.correction!=CODE_V){oNouv.className+=" STY_borneRepFaux";}if (montreSuggestion){oNouv.className+=" STY_borneRepSuggRef0";}pos--;longueur++;if (longueur<5){longueur=5;}oNouv.style.left=pos+'px';oNouv.style.width=longueur+'px';}break;}}if (!domaineTrouve){if (montreFaux){if (oCurs.vertical){oNouv.className="STY_borneSol1";if (oCurs.correction!=CODE_V){oNouv.className+=" STY_borneRepFaux";}if (montreSuggestion){oNouv.className+=" STY_borneRepSuggRef1";}var posFin=PF_donneObjet('divCurseur'+oCurs.id).offsetTop;var hauteur=PF_donneObjet('imgCurseur'+oCurs.id).offsetHeight;posFin--;hauteur++;if (hauteur<5){hauteur=5;}oNouv.style.top=posFin+'px';oNouv.style.height=hauteur+'px';} else {oNouv.className="STY_borneSol0";if (oCurs.correction!=CODE_V){oNouv.className+=" STY_borneRepFaux";}if (montreSuggestion){oNouv.className+=" STY_borneRepSuggRef0";}pos=PF_donneObjet('divCurseur'+oCurs.id).offsetLeft;longueur=PF_donneObjet('imgCurseur'+oCurs.id).offsetWidth;pos--;longueur++;if (longueur<5){longueur=5;}oNouv.style.left=pos+'px';oNouv.style.width=longueur+'px';}}}}function exo_enleverCorrection(){if (!this.existeClasseCorrection){return;}for (var n=0;n<this.tabCurseurs.length;n++){var oBorne=PF_donneObjet("borneCursSol"+this.tabCurseurs[n].id);if (oBorne!=null){oBorne.parentNode.removeChild(oBorne);}}}function exo_solutions(){if (this.existeClasseCorrection){return this.corrigerReponses(false);}for (var n=0;n<this.tabCurseurs.length;n++){var oCurs=this.tabCurseurs[n];for (var k=oCurs.tabDomaines.length-1;k>=0;k--){var domaineTmp=oCurs.tabDomaines[k];if (domaineTmp.correction==CODE_V){var initPourcent;var pos='';if (n==0){this.initialiser();}var moy=(domaineTmp.max-domaineTmp.min)/2+domaineTmp.min;oCurs.deplaceCurseur(moy);oCompteurC=PF_donneObjet('divCompteur'+oCurs.id);uniteC=oCurs.unite;changeCompteur(moy);oCurs.correction=CODE_V;}}}}function exo_donneObjCurs(num){var res=null;for (var i=0;i<this.tabCurseurs.length;i++){if (num==this.tabCurseurs[i].id){res=this.tabCurseurs[i];}}return res;}function exo_donneSuggestion(){var res=null;var i=0;while (i<exo.indications.length){if (exo.indications[i].id.indexOf('divSugg')==0){var ref=exo.indications[i].ref;if (ref!='' && suggestionDejaAffiche.indexOf(exo.indications[i].id+',')<0){var tabParams=ref.split(':');var idCurs=tabParams[0];for (var n=0;n<this.tabCurseurs.length;n++){if (this.tabCurseurs[n].id==idCurs && this.tabCurseurs[n].etatDeplace){if (tabParams[1]=='<>'){if (this.tabCurseurs[n].correction!=CODE_V){res=exo.indications[i];i=9999;break;}} else {var oDom=this.tabCurseurs[n].tabDomaines[Number(tabParams[1])-1];if (oDom!=null&&oDom.curseurDedans){res=exo.indications[i];i=9999;break;}}}}}}i++;}if (res==null){i=0;while (i<exo.indications.length){if (exo.indications[i].id.indexOf('divSugg')==0 && exo.indications[i].ref=='' && suggestionDejaAffiche.indexOf(exo.indications[i].id+',')<0){res=exo.indications[i];break;}i++;}}return res;}function exo_donneTabReponses(){var tabRep=new Array();for (var k=0;k<this.tabCurseurs.length;k++){var oCurs=this.tabCurseurs[k];if (oCurs!=null){var validd=false;if (oCurs.correction==CODE_V){validd=true;}var tabInteraction=new Array();tabInteraction[0]=validd;var valCurse=oCurs.valeurActuelle;if (oCurs.poids!=""){valCurse*=Number(oCurs.poids);}tabInteraction[1]=valCurse.toFixed(2).replace(".00","");tabInteraction[2]="c"+oCurs.id;tabInteraction[3]=oCurs.valeurActuelle.toFixed(2).replace(".00","");tabRep[k]=tabInteraction;}}return tabRep;}function exo_afficherMesReponses(tabRep){for (var i=0;i<tabRep.length;i++){var oInteraction=tabRep[i];var idCurs=oInteraction.id;idCurs=idCurs.substring(idCurs.indexOf("_")+2);for (var j=0;j<this.tabCurseurs.length;j++){var oCurs=this.tabCurseurs[j];if (oCurs.id==idCurs){var num=Number(oInteraction.learner_response);if (oCurs.poids!=""){num=num/Number(oCurs.poids);}oCurs.deplaceCurseur(num);oCompteurC=PF_donneObjet('divCompteur'+oCurs.id);uniteC=oCurs.unite;changeCompteur(num);oCurs.valeurActuelle=num;oCurs.juger();}}}}function decodeX(va){var res="";for (var i=0;i<va.length;i++){var car=va.charAt(i);switch(car){case '3' : res+="0";break;case '8' : res+="1";break;case '7' : res+="2";break;case '9' : res+="3";break;case '1' : res+="7";break;case '0' : res+="8";break;case '2' : res+="9";break;default : res+=car;}}return res;}function addSwipeListenerCURS(el){ function cancelTouch(){ el.removeEventListener('touchmove', onTouchMove); el.removeEventListener('touchend', onTouchEnd);} function onTouchMove(e){ if (e.touches.length > 1){ cancelTouch(); }else{ e.preventDefault(); e.stopPropagation(); CURS_deplaceDiv(e,true); }}function onTouchEnd(e){CURS_finDep();cancelTouch(); } function onTouchStart(e){ if (e.touches.length == 1){ e.preventDefault(); e.stopPropagation(); el.addEventListener('touchmove', onTouchMove, false); el.addEventListener('touchend', onTouchEnd, false); var exoGd=e.target; while (exoGd.nodeName!="DIV" || exoGd.id==null || exoGd.id.indexOf("divCurseur")!=0){ exoGd=exoGd.parentNode; } CURS_debutDep(e,exoGd.id.substring(10),true); } } if (window.addEventListener){ el.addEventListener('touchstart',onTouchStart,false); }}
