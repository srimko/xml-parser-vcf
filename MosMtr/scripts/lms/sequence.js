var activiteCourante=null;var activiteSuspendue=null;var activiteRacine=null;var activiteSpecifieParChoix="";var activiteSpecifieParChoixPreemptif="";var MODE_PREEMPTIF=false;var ROLLUP_SUR_COURANT=false;var requeteDeSortie="";var allocationsGlobales=null;var objGlobauxCourant=null;var objGlobauxPremptif=null;var resDebug="";var tabRemonter=null;var tabDejaFaitRollup=null;var tabTestItemPlan=new Array();var SANS_REMONTE=false;var TEST_AFF_PARC=false;var sortieSurBoutonSuivant=false;var scoDemandeEtatObjectif=false;var modifEtatMembre=false;var vaRecommencerRacine=false;var dateDerniereActionLMS=null;function overallSequencing(requete){dateDerniereActionLMS=(new Date()).getTime();if (MODE_PREEMPTIF && itemCourant!=null){if (requete=="previous"){if (estPremiereActiviteArbre(itemCourant)){return "false";}if (controlMode(itemCourant.parentNode,"flow")=="false"||controlMode(itemCourant.parentNode,"forwardOnly")=="true"){return "false";}} else if (requete=="continue"){if (controlMode(itemCourant.parentNode,"flow")=="false"){return "false";}return "true";} else if (requete=="choice"){var oActivite=donneActiviteId(activiteSpecifieParChoixPreemptif);if (oActivite!=null){if (estFeuille(oActivite)){if (controlMode(oActivite.parentNode,"choice")=="false"){return "false";}} else {if (controlMode(oActivite,"flow")=="false"){return "false";}}}}}tabDejaFaitRollup=new Array();window.status=requete;if (MODE_PREEMPTIF){activiteRacine=itemRacine.cloneNode(true);activiteCourante=null;activiteSuspendue=null;if (itemCourant!=null){if (itemCourant==itemRacine){activiteCourante=activiteRacine;} else {activiteCourante=parent.XML_trouveNoeud(activiteRacine,"item","identifier",itemCourant.getAttribute("identifier"));}}if (itemSuspendu!=null){if (itemSuspendu==itemRacine){activiteSuspendue=activiteRacine;} else {activiteSuspendue=parent.XML_trouveNoeud(activiteRacine,"item","identifier",itemSuspendu.getAttribute("identifier"));}}objGlobauxPremptif=objGlobauxCourant.cloneNode(true);} else {activiteRacine=itemRacine;activiteCourante=itemCourant;activiteSuspendue=itemSuspendu;requeteDeSortie="";sortieSurBoutonSuivant=false;if (requete=="exitAll"||requete=="abandonAll"){itemRacine.removeAttribute("activiteSuspendue");}}vaRecommencerRacine=false;var requeteEnAttente="";var tabRes=navigationRequest(requete);if (tabRes[0]=="notValid"){return erreurOP(tabRes[4]);}if (tabRes[1]!=""){tabRes=terminationRequest(tabRes[1]);if (tabRes[0]=="notValid"){return erreurOP(tabRes[2]);}if (tabRes[1]!=""){requete=tabRes[1];}}if (requete!=""){tabRes=sequencingRequest(requete);activiteSpecifieParChoix="";if (tabRes[0]=="notValid"){if (requete=="continue" && !MODE_PREEMPTIF){if (controlMode(itemCourant.parentNode,"flow")=="true"){sortieSurBoutonSuivant=true;return finSessionSequence(false);}}return erreurOP(tabRes[3]);}if (tabRes[2]=="true"){return finSessionSequence(true);}if (tabRes[1]==null){tabDejaFaitRollup=null;return "true";}var tabDeliv=deliveryRequest(tabRes[1]);if (tabDeliv[0]=="notValid"){return erreurOP(tabDeliv[1]);}var resDb=contentDeliveryEnvironment(tabRes[1]);if (resDb!=""){return erreurOP(resDb);}window.status="";tabDejaFaitRollup=null;return "true";}tabDejaFaitRollup=null;}function erreurOP(msgErreur){tabDejaFaitRollup=null;if (!MODE_PREEMPTIF){window.status=donneException(msgErreur);}return "false";}function finSessionSequence(sortieDefinitive){tabDejaFaitRollup=null;if (MODE_PREEMPTIF){return "true";}var temporise=false;if (parent.API_1484_11.etatCommunication=="enCours"){parent.API_1484_11.scoEnAttente=true;temporise=true;} else {parent.API_1484_11.etatCommunication="pasInitialise";}var adrBlanc=adrPageBlanche();if (sortieSurBoutonSuivant){sortieDefinitive=false;parent.haut.majFleche('EtpSuiv','','#');parent.haut.majFleche('EtpPrec','','#');parent.haut.PF_modifTexteDiv("STY_titreEtapeJS","");parent.planLMS.PF_modifTexteDiv("STY_titreEtapeJS","");parent.haut.PF_modifTexteDiv("STY_titreSequencePere","");parent.planLMS.PF_modifTexteDiv("STY_titreSequencePere","");if (parent.haut.oFlashIntBar){try {parent.haut.oFlashIntBar.MOS_setCurrentItem("","","");}catch(e){}}if (parent.SUR_CHORUS){adrBlanc=adrPageDefaut("fin");} else {setTimeout("ecritMsgBlanc(78)",500);}parent.contenuLMS.location=adrBlanc;parent.haut.NAVIG_barreProgress(null,0);}deselectionneLien(lienCourant);activiteCourante=null;itemCourant=null;if (sortieDefinitive){if (temporise){parent.contenuLMS.location=adrBlanc;setTimeout("parent.LMS_persisteParcours(false);parent.LMS_fermer()",1000);} else {parent.LMS_persisteParcours(false);parent.LMS_fermer();}} else {setTimeout("majBoutonsInit('pasInitialise')",800);}}function ecritMsgBlanc(lex){var titreZ="";try {titreZ=parent.contenuLMS.document.title;} catch(e){}if (titreZ=="blanc"){var oCorps=parent.contenuLMS.document.getElementsByTagName("body")[0];oCorps.innerHTML="<div class=\"STY_msgInfoBlanc\"><br/>"+donneLex(lex)+"</div>";} else {setTimeout("ecritMsgBlanc("+lex+")",900);}}function adrPageDefaut(type){return parent.RACINE_MOS+"MosSrv/aspx/ADM_accueilConnexion.aspx?cPage=defautStg&msg="+type+"&styleST="+parent.STYLE_INTERFACE;}function tabR(chaine){return chaine.split(";");}function tabContient(tab,val){var res=false;var i=0;while (!res && i<tab.length){if (tab[i]==val){res=true;}i++;}return res;}function attrObj(oNoeud,nomAttr){if (oNoeud==null){alert("attrObj null for "+nomAttr);}var res=oNoeud.getAttribute(nomAttr);if (res==null||res==""){if (nomAttr=="objectiveContributesToRollup"){res="false";if (oNoeud.nodeName.indexOf("primaryObjective")>=0){res="true";}}if (nomAttr=="objectiveProgressStatus"){res="false";}if (nomAttr=="objectiveSatisfiedStatus"){res="false";}if (nomAttr=="objectiveMeasureStatus"){res="false";}if (nomAttr=="objectiveNormalizedMeasure"){res="0.0";}if (nomAttr=="satisfiedByMeasure"){res="false";}if (nomAttr=="attemptProgressStatus"){res="false";}if (nomAttr=="attemptCompletionStatus"){res="false";}if (nomAttr=="attemptCompletionAmountStatus"){res="false";}if (nomAttr=="attemptCount"){res="0";}if (nomAttr=="activityProgressStatus"){res="false";}if (nomAttr=="selectionCountStatus"){res="true";}if (nomAttr=="randomizeChildren"){res="true";}if (nomAttr=="availableChildren"){res="_all";}if (nomAttr=="attemptCompletionAmount"){res="0.0";}if (nomAttr=="attemptAbsoluteDuration"){res="0.0";}}return res;}function attributSequence(oActivite,nomAttr,ns,nom){var res="";var oSeq=parent.XML_filsNS(oActivite,"imsss","sequencing");if (oSeq!=null){var oControl=parent.XML_filsNS(oSeq,ns,nom);if (oControl!=null){res=oControl.getAttribute(nomAttr);if (res==null){res="";}}}return res;}function controlMode(oActivite,nomAttr){var res=attributSequence(oActivite,nomAttr,"imsss","controlMode");if (res==""){if (nomAttr=="choice"){res="true";}else if (nomAttr=="choiceExit"){res="true";}else if (nomAttr=="flow"){res="false";}else if (nomAttr=="forwardOnly"){res="false";}else if (nomAttr=="useCurrentAttemptObjectiveInfo"){res="true";}else if (nomAttr=="useCurrentAttemptProgressInfo"){res="true";}}return res;}function limitConditions(oActivite,nomAttr){var res=attributSequence(oActivite,nomAttr,"imsss","limitConditions");if (res==""){if (nomAttr=="attemptLimit"){res="0";}else if (nomAttr=="attemptAbsoluteDurationLimit"){res="0.0";}}return res;}function deliveryControls(oActivite,nomAttr){if (SUIVI_DESACTIVE){return "false";}var res=attributSequence(oActivite,nomAttr,"imsss","deliveryControls");if (res==""){if (nomAttr=="tracked"){res="true";}else if (nomAttr=="completionSetByContent"){res="false";}else if (nomAttr=="objectiveSetByContent"){res="false";}}return res;}function randomizationControls(oActivite,nomAttr){var res=attributSequence(oActivite,nomAttr,"imsss","randomizationControls");if (res==""){if (nomAttr=="randomizationTiming"){res="never";}else if (nomAttr=="selectCount"){res="0";}else if (nomAttr=="reorderChildren"){res="false";}else if (nomAttr=="selectionTiming"){res="never";}}return res;}function rollupRules(oActivite,nomAttr){var res=attributSequence(oActivite,nomAttr,"imsss","rollupRules");if (res==""){if (nomAttr=="objectiveMeasureWeight"){res="1";}else if (nomAttr=="rollupObjectiveSatisfied"){res="true";}else if (nomAttr=="rollupProgressCompletion"){res="true";}}return res;}function completionThreshold(oActivite,nomAttr){var objDansitem=parent.XML_filsNS(oActivite,"adlcp","completionThreshold");var res="";if (objDansitem!=null){res=PF_attr(objDansitem,nomAttr);}if (res==""){if (nomAttr=="progressWeight"){res="1";}else if (nomAttr=="minProgressMeasure"){res="1.0";}else if (nomAttr=="completedByMeasure"){res="false";}}return res;}function rollupConsiderations(oActivite,nomAttr){var res=attributSequence(oActivite,nomAttr,"adlseq","rollupConsiderations");if (res==""){if (nomAttr=="requiredForSatisfied"){res="always";}else if (nomAttr=="requiredForNotSatisfied"){res="always";}else if (nomAttr=="requiredForCompleted"){res="always";}else if (nomAttr=="requiredForIncomplete"){res="always";}else if (nomAttr=="measureSatisfactionIfActive"){res="true";}}return res;}function constrainedChoiceConsiderations(oActivite,nomAttr){var res=attributSequence(oActivite,nomAttr,"adlseq","constrainedChoiceConsiderations");if (res==""){if (nomAttr=="preventActivation"){res="false";}else if (nomAttr=="constrainChoice"){res="false";}}return res;}function donneObjectifs(oActivite,creer){var objsSeq=parent.XML_filsNS(oActivite,"imsss","sequencing");if (objsSeq==null){if (!creer){return new Array(0);}objsSeq=ajouteElementSeq(oActivite,"sequencing");}var objs=parent.XML_filsNS(objsSeq,"imsss","objectives");if (objs==null){if (!creer){return new Array(0);}objs=ajouteElementSeq(objsSeq,"objectives");}var oPrimaire=parent.XML_filsNS(objs,"imsss","primaryObjective");if (oPrimaire==null){if (creer){ajouteElementSeq(objs,"primaryObjective");}}return parent.XML_tabElementFils(objs);}function donneLesFils(oObj,nomFils){var tabFils=new Array();var tabTous=parent.XML_tabElementFils(oObj);for (var i=0;i<tabTous.length;i++){if (tabTous[i].nodeName==nomFils){tabFils.push(tabTous[i]);}}return tabFils;}function estActive(oActivite){return (PF_attr(oActivite,"activityIsActive")=="true");}function estSuspendue(oActivite){return (PF_attr(oActivite,"activityIsSuspended")=="true");}function navigationRequest(requete){parent.abandonEnCours=false;if (requete=="start"){if (activiteCourante==null){return tabR("valid;;start;;");} else {return tabR("notValid;;;;NB.2.1-1");}} else if (requete=="resumeAll"){if (activiteCourante==null){if (activiteSuspendue!=null){return tabR("valid;;resumeAll;;");} else {return tabR("notValid;;;;NB.2.1-3");}} else {return tabR("notValid;;;;NB.2.1-1");}} else if (requete=="continue"){if (activiteCourante==null){return tabR("notValid;;;;NB.2.1-2");} if (!estRacine(activiteCourante) && controlMode(activiteCourante.parentNode,"flow")=="true") {if (estActive(activiteCourante)){return tabR("valid;exit;continue;;");} else {return tabR("valid;;continue;;");}} else {return tabR("notValid;;;;NB.2.1-4");}} else if (requete=="previous"){if (activiteCourante==null){return tabR("notValid;;;;NB.2.1-2");}if (!estRacine(activiteCourante)){if (controlMode(activiteCourante.parentNode,"flow")=="true" && controlMode(activiteCourante.parentNode,"forwardOnly")=="false"){if (estActive(activiteCourante)){return tabR("valid;exit;previous;;");} else {return tabR("valid;;previous;;");}} else {return tabR("notValid;;;;NB.2.1-5");}} else {return tabR("notValid;;;;NB.2.1-6");}} else if (requete=="forward"){return tabR("notValid;;;;NB.2.1-7");} else if (requete=="backward"){return tabR("notValid;;;;NB.2.1-7");} else if (requete=="choice"){var cibleDuChoix=activiteSpecifieParChoix;if (MODE_PREEMPTIF){cibleDuChoix=activiteSpecifieParChoixPreemptif;}var oChoix=donneActiviteId(cibleDuChoix);if (oChoix!=null){if (estRacine(oChoix) || controlMode(oChoix.parentNode,"choice")=="true"){if (activiteCourante==null){return tabR("valid;;choice;"+cibleDuChoix+";");}if (!estFrere(oChoix,activiteCourante)){var oAncetre=ancetreCommun(oChoix,activiteCourante);var tabCheminActivites=formerCheminAct(activiteCourante,true,oAncetre,false);if (tabCheminActivites.length>0){for (var n=0;n<tabCheminActivites.length;n++){if (estActive(tabCheminActivites[n]) && controlMode(tabCheminActivites[n],"choiceExit")=="false"){return tabR("notValid;;;;NB.2.1-8");}}} else {return tabR("notValid;;;;NB.2.1-9");}}if (estActive(activiteCourante) && controlMode(activiteCourante,"choiceExit")=="false"){return tabR("notValid;;;;NB.2.1-8");}if (estActive(activiteCourante)){return tabR("valid;exit;choice;"+cibleDuChoix+";");} else {return tabR("valid;;choice;"+cibleDuChoix+";");}} else {return tabR("notValid;;;;NB.2.1-10");}} else {return tabR("notValid;;;;NB.2.1-11");}} else if (requete=="exit"){if (activiteCourante!=null){if (estActive(activiteCourante)){return tabR("valid;exit;exit;;");} else {return tabR("notValid;;;;NB.2.1-12");}} else {return tabR("notValid;;;;NB.2.1-2");}} else if (requete=="exitAll"){if (activiteCourante!=null){if (!MODE_PREEMPTIF){requeteDeSortie="exitAll";}return tabR("valid;exitAll;exit;;");} else {return tabR("notValid;;;;NB.2.1-2");}} else if (requete=="abandon"){if (!MODE_PREEMPTIF){parent.abandonEnCours=true;}if (activiteCourante!=null){if (estActive(activiteCourante)){return tabR("valid;abandon;exit;;");} else {return tabR("notValid;;;;NB.2.1-12");}} else {return tabR("notValid;;;;NB.2.1-2");}} else if (requete=="abandonAll"){if (!MODE_PREEMPTIF){parent.abandonEnCours=true;}if (activiteCourante!=null){if (!MODE_PREEMPTIF){requeteDeSortie="abandonAll";}return tabR("valid;abandonAll;exit;;");} else {return tabR("notValid;;;;NB.2.1-2");}} else if (requete=="suspendAll"){if (activiteCourante!=null){if (!MODE_PREEMPTIF){requeteDeSortie="suspendAll";}return tabR("valid;suspendAll;exit;;");} else {return tabR("notValid;;;;NB.2.1-2");}} else if (requete=="jump"){var cibleDuChoix=activiteSpecifieParChoix;if (MODE_PREEMPTIF){cibleDuChoix=activiteSpecifieParChoixPreemptif;}var oChoix=donneActiviteId(cibleDuChoix);var sautPossible=false;if (oChoix!=null){if (estRacine(oChoix)){sautPossible=true;}else {var filsDipos=attrObj(oChoix.parentNode,"availableChildren");if (filsDipos=="_all"){sautPossible=true;} else {var tabC=availableChildren.split("[;]");if (!tabContient(tabC,cibleDuChoix)){sautPossible=true;}}}} if (sautPossible){return tabR("valid;exit;jump;"+cibleDuChoix+";");} else {return tabR("notValid;;;;NB.2.1-11");}}return tabR("notValid;;;;NB.2.1-13");}function sequencingExitActionRules(){if (MODE_PREEMPTIF){return true;}var cibleSortie=null;if (estRacine(activiteCourante)){return true;}var tabCheminActivites=formerCheminAct(activiteCourante.parentNode,true,activiteRacine,true);var bloque=false;var i=tabCheminActivites.length-1;while (i>=0 && !bloque){var res=sequencingRulesCheck(tabCheminActivites[i],"exit");if (res!="nil"){cibleSortie=tabCheminActivites[i];bloque=true;}i--;}if (cibleSortie!=null){terminateDescendentAttempts(cibleSortie);endAttempt(cibleSortie);affecteActiviteCourante(cibleSortie);}}function sequencingPostConditionRules(){if (estSuspendue(activiteCourante)){return tabR(";");}var res=sequencingRulesCheck(activiteCourante,"exitAll,exitParent,retry,retryAll,continue,previous");if (res!="nil"){if (res=="retry"||res=="continue"||res=="previous"){return tabR(res+";");}if (res=="exitParent"||res=="exitAll"){return tabR(";"+res);}if (res=="retryAll"){return tabR("retry;exitAll");}}return tabR(";");}function terminationRequest(requete){if (activiteCourante==null){return tabR("notValid;;TB.2.3-1");}if ((requete=="exit"||requete=="abandon") && !estActive(activiteCourante)){return tabR("notValid;;TB.2.3-2");}if (!MODE_PREEMPTIF && requete!="suspendAll"){itemRacine.removeAttribute("activiteSuspendue");}var sequencePostTemp="";if (requete=="exit"){if (estRacine(activiteCourante)){sortieSurBoutonSuivant=true;}endAttempt(activiteCourante);sequencingExitActionRules(activiteCourante);var processedExit=true;var finCas=false;while (processedExit && !finCas){processedExit=false;var tabResPot=sequencingPostConditionRules();if (tabResPot[1]=="exitAll"){requete="exitAll";finCas=true;sequencePostTemp=tabResPot[0];}if (!finCas){if (tabResPot[1]=="exitParent"){if (!estRacine(activiteCourante)){affecteActiviteCourante(activiteCourante.parentNode);if (estRacine(activiteCourante)){sortieSurBoutonSuivant=true;}endAttempt(activiteCourante);processedExit=true;} else {return tabR("notValid;;TB.2.3-4");}} else {if (estRacine(activiteCourante)&&tabResPot[0]!="retry"){return tabR("valid;exit;");}}}}if (!finCas){return tabR("valid;"+tabResPot[0]+";");}}if (requete=="exitAll"){if (estActive(activiteCourante)){endAttempt(activiteCourante);}terminateDescendentAttempts(activiteRacine);endAttempt(activiteRacine);affecteActiviteCourante(activiteRacine);var srt=sequencePostTemp;if (srt==""){srt="exit";}return tabR("valid;"+srt+";");}if (requete=="suspendAll"){if (estActive(activiteCourante)||estSuspendue(activiteCourante)){if (FIGER_ETAT_ITEM && estFeuille(activiteCourante) && ressourceCourante && ressourceCourante.getAttribute("adlcp:scormType")=="asset"){endAttempt(activiteCourante);}overallRollup(activiteCourante);affecteActiviteSuspendue(activiteCourante);} else {if (!estRacine(activiteCourante)){affecteActiviteSuspendue(activiteCourante.parentNode);} else {return tabR("notValid;;TB.2.3-3");}}var tabCheminActivites=formerCheminAct(activiteSuspendue,true,activiteRacine,true);if (tabCheminActivites.length==0){return tabR("notValid;;TB.2.3-5");}for (var j=0;j<tabCheminActivites.length;j++){desactiveActivite(tabCheminActivites[j]);tabCheminActivites[j].setAttribute("activityIsSuspended","true");if (j>0){durationRollup(tabCheminActivites[j]);}}affecteActiviteCourante(activiteRacine);if (!MODE_PREEMPTIF && parent.API_1484_11.cmi!=null && parent.API_1484_11.etatCommunication=="enCours"){parent.API_1484_11.SetValue("cmi.exit","suspend");}return tabR("valid;exit;");}if (requete=="abandon"){desactiveActivite(activiteCourante);return tabR("valid;;");}if (requete=="abandonAll"){desactiveActivite(activiteCourante);var tabCheminActivites=formerCheminAct(activiteCourante,true,activiteRacine,true);if (tabCheminActivites.length==0){return tabR("notValid;;TB.2.3-6");}for (var j=0;j<tabCheminActivites.length;j++){desactiveActivite(tabCheminActivites[j]);}affecteActiviteCourante(activiteRacine);return tabR("valid;exit;");}return tabR("notValid;;TB.2.3-7");}function measureRollup(oActivite){var totalWeightedMeasure=0;var countedMeasures=0;var validData=false;var objectifCible=donneObjectifCible(oActivite,false);if (objectifCible!=null){var tabFils=donneLesFils(oActivite,"item");for (var n=0;n<tabFils.length;n++){if (deliveryControls(tabFils[n],"tracked")=="true"){if (rollupConsiderations(tabFils[n],"rollupMeasureIfInSatisfactionRollup")!="true" || checkChildForRollup(tabFils[n],"satisfied")){var rolledUpObjective=donneObjectifCible(tabFils[n],false);if (rolledUpObjective!=null){var poidsItem=Number(rollupRules(tabFils[n],"objectiveMeasureWeight"));countedMeasures+=poidsItem;if (lireEtatObjectif(rolledUpObjective,"objectiveMeasureStatus")=="true"){totalWeightedMeasure+=Number(lireValeurObjectif(rolledUpObjective,"objectiveNormalizedMeasure"))*poidsItem;validData=true;}} else {return true;}}}}if (!validData){enregistrerEtatObjectif(objectifCible,"objectiveMeasureStatus","false");} else {if (countedMeasures>0){var scoreRemonte=totalWeightedMeasure/countedMeasures;scoreRemonte+=0.00001;enregistrerObjectif(objectifCible,"objectiveNormalizedMeasure",parent.reelScore(scoreRemonte),false);} else {enregistrerEtatObjectif(objectifCible,"objectiveMeasureStatus","false");}}return true;}return true;}function completionMeasureRollup(oActivite){var totalWeightedMeasure=0;var countedMeasures=0;var validData=false;var tabFils=donneLesFils(oActivite,"item");for (var n=0;n<tabFils.length;n++){if (deliveryControls(tabFils[n],"tracked")=="true"){var poidsItem=Number(completionThreshold(tabFils[n],"progressWeight"));countedMeasures+=poidsItem;if (attrObj(tabFils[n],"attemptCompletionAmountStatus")=="true"||(FIGER_ETAT_ITEM && PF_attr(tabFils[n],"attemptCompletionAmount")!="")){totalWeightedMeasure+=Number(PF_attr(tabFils[n],"attemptCompletionAmount"))*poidsItem;validData=true;}}}if (!validData){oActivite.setAttribute("attemptCompletionAmountStatus","false");} else {if (countedMeasures>0){oActivite.setAttribute("attemptCompletionAmountStatus","true");var scoreRemonte=totalWeightedMeasure/countedMeasures;scoreRemonte+=0.00001;oActivite.setAttribute("attemptCompletionAmount",parent.reelScore(scoreRemonte));} else {oActivite.setAttribute("attemptCompletionAmountStatus","false");}}return true;}function durationRollup(oActivite){var tabFils=donneLesFils(oActivite,"item");if (tabFils.length==0){return ;}var tempRemonte=0;for (var n=0;n<tabFils.length;n++){if (deliveryControls(tabFils[n],"tracked")=="true"){var tempsMsFils=0;var tempsFils=PF_attr(tabFils[n],"activityAbsoluteDuration");if (tempsFils!=""){tempRemonte+=parent.intervalleEnMS(tempsFils);}var tempsDerTenta=PF_attr(tabFils[n],"attemptAbsoluteDuration");if (tempsDerTenta!=""){tempRemonte+=parent.intervalleEnMS(tempsDerTenta);}}}if (tempRemonte>0){oActivite.setAttribute("activityAbsoluteDuration",parent.formaterSecondes(tempRemonte/1000));if (estRacine(oActivite)){DOMManifest.documentElement.setAttribute("tempsTotal",Math.round(tempRemonte/1000));}}return true;}function evaluerSeuilMesureSatisfaction(objectifCible,faireVerifActif){var res="unknown";var oActivite=objectifCible.parentNode.parentNode.parentNode;if (!faireVerifActif || peutMesurerSatisfaction(oActivite)){var measureO=Number(lireValeurObjectif(objectifCible,"objectiveNormalizedMeasure"));var minNormalizedMeasure="";var objMinMeasure=parent.XML_filsNS(objectifCible,"imsss","minNormalizedMeasure");if (objMinMeasure!=null){minNormalizedMeasure=parent.XML_texteNoeud(objMinMeasure);}if (minNormalizedMeasure==""){minNormalizedMeasure="1";}if (measureO>=Number(minNormalizedMeasure)){res="true";} else {res="false";}}return res;}function objectiveRollupUsingMeasure(oActivite){var objectifCible=donneObjectifCible(oActivite,false);if (objectifCible!=null){if (attrObj(objectifCible,"satisfiedByMeasure")=="true"){if (lireEtatObjectif(objectifCible,"objectiveMeasureStatus")=="false"){enregistrerEtatObjectif(objectifCible,"objectiveProgressStatus","false");} else {if (peutMesurerSatisfaction(oActivite)){var resEval=evaluerSeuilMesureSatisfaction(objectifCible,false);if (resEval=="unknown"){enregistrerEtatObjectif(objectifCible,"objectiveProgressStatus","false");} else {enregistrerObjectif(objectifCible,"objectiveSatisfiedStatus",resEval,false);}}}}return true;} else {return true;}}function objectiveRollupUsingRules(oActivite){var objectifCible=donneObjectifCible(oActivite,false);if (objectifCible!=null){var tabReglesSatisf=donneReglesRollup(oActivite,"satisfied",false);if (tabReglesSatisf.length==0){tabReglesSatisf=donneReglesRollup(oActivite,"notSatisfied",false);if (tabReglesSatisf.length==0){donneReglesRollup(oActivite,"satisfied",true);donneReglesRollup(oActivite,"notSatisfied",true);}}if (!FIGER_ETAT_ITEM){objectifCible.removeAttribute("objectiveSatisfiedStatus");objectifCible.removeAttribute("objectiveProgressStatus");} var resRu=rollupRuleCheck(oActivite,"notSatisfied");if (resRu=="true"){enregistrerObjectif(objectifCible,"objectiveSatisfiedStatus","false",false);}resRu=rollupRuleCheck(oActivite,"satisfied");if (resRu=="true"){enregistrerObjectif(objectifCible,"objectiveSatisfiedStatus","true",false);}return true;} else {return true;}}function activityProgressRollupUsingMeasure(oActivite){var resRu="";var marqueIncomplet=false;if (FIGER_ETAT_ITEM && PF_attr(oActivite,"attemptCompletionStatus")=="true"){resRu="true";} else {initCompletion(oActivite);if (completionThreshold(oActivite,"completedByMeasure")=="true"){if (attrObj(oActivite,"attemptCompletionAmountStatus")=="true"){var valp=Number(attrObj(oActivite,"attemptCompletionAmount"));if (valp>=Number(completionThreshold(oActivite,"minProgressMeasure"))){enregistrerCompletion(oActivite,true);} else {enregistrerCompletion(oActivite,false);marqueIncomplet=true;}}}if (!MODE_PREEMPTIF){if (PF_attr(oActivite,"attemptCompletionStatus")!=PF_attr(oActivite,"ancienEtatCompl")){parent.parcoursEnregistre=false;}oActivite.removeAttribute("ancienEtatCompl");}}appliqueCompletionRacine(oActivite,resRu,marqueIncomplet);}function activityProgressRollupUsingRules(oActivite){var tabReglesSatisf=donneReglesRollup(oActivite,"completed",false);if (tabReglesSatisf.length==0){tabReglesSatisf=donneReglesRollup(oActivite,"incomplete",false);if (tabReglesSatisf.length==0){donneReglesRollup(oActivite,"completed",true);donneReglesRollup(oActivite,"incomplete",true);}}var resRu="";var marqueIncomplet=false;if (FIGER_ETAT_ITEM && PF_attr(oActivite,"attemptCompletionStatus")=="true"){resRu="true";} else {initCompletion(oActivite);resRu=rollupRuleCheck(oActivite,"incomplete");if (resRu=="true"){enregistrerCompletion(oActivite,false);marqueIncomplet=true;}resRu=rollupRuleCheck(oActivite,"completed");if (resRu=="true"){enregistrerCompletion(oActivite,true);}if (!MODE_PREEMPTIF){if (PF_attr(oActivite,"attemptCompletionStatus")!=PF_attr(oActivite,"ancienEtatCompl")){parent.parcoursEnregistre=false;}oActivite.removeAttribute("ancienEtatCompl");}}appliqueCompletionRacine(oActivite,resRu,marqueIncomplet);}function appliqueCompletionRacine(oActivite,resRu,marqueIncomplet){if (MODE_PREEMPTIF){return;}oActivite.setAttribute("dateRemonte",parent.getDateServeur('milli'));parcoursEnregistre=false;if (estRacine(oActivite)){var resuP="attempted";if (resRu=="true"){resuP="completed";} else if (marqueIncomplet){resuP="incomplete";}var racmn=DOMManifest.documentElement;if (PF_attr(racmn,"etatParcours")!=resuP && parent.SYNC_CORRIGE_ITEM==""){modifEtatMembre=true;if (resuP=="completed"){parent.haut.PF_masquerDiv("STY_zoneParcoursNonAcheve");parent.haut.PF_afficherDiv("STY_zoneParcoursAcheve");} else {parent.haut.PF_masquerDiv("STY_zoneParcoursAcheve");parent.haut.PF_afficherDiv("STY_zoneParcoursNonAcheve");}}racmn.setAttribute("etatParcours",resuP);if (resuP=="completed" && PF_attr(racmn,"dateCompletion")==""){racmn.setAttribute("dateCompletion",parent.getDateServeur(''));racmn.setAttribute("evtCompletion","true");racmn.setAttribute("tempsCompletion",PF_attr(racmn,"tempsTotal"));/*if (parent.SUR_CHORUS && diplomePossible){setTimeout("afficherDiplome()",800);}*/}if (resuP=="completed" && parent.lesson_mode=="normal"){if (modeExploration=="complete"){FIGER_ETAT_ITEM=true;}}}}function donneReglesRollup(oActivite,rollupAction,creer){var tabReglesAction=new Array();var objSeq=parent.XML_filsNS(oActivite,"imsss","sequencing");if (objSeq==null && creer){objSeq=ajouteElementSeq(oActivite,"sequencing");}if (objSeq!=null){var objR=parent.XML_filsNS(objSeq,"imsss","rollupRules");if (objR==null && creer){objR=ajouteElementSeq(objSeq,"rollupRules");}if (objR!=null){var tabFRules=parent.XML_tabElementFils(objR);for (var i=0;i<tabFRules.length;i++){var oCond=parent.XML_filsNS(tabFRules[i],"imsss","rollupAction");if (oCond==null){alert("rollupAction null");}if (oCond.getAttribute("action")==rollupAction){tabReglesAction.push(tabFRules[i]);}}if (creer && tabReglesAction.length==0){var defautR=ajouteElementSeq(objR,"rollupRule");defautR.setAttribute("childActivitySet","all");var lesconds=ajouteElementSeq(defautR,"rollupConditions");var oCond=ajouteElementSeq(lesconds,"rollupCondition");if (rollupAction=="satisfied"){oCond.setAttribute("condition","satisfied");}if (rollupAction=="completed"){oCond.setAttribute("condition","completed");}if (rollupAction=="notSatisfied"){oCond.setAttribute("condition","objectiveStatusKnown");}if (rollupAction=="incomplete"){oCond.setAttribute("condition","activityProgressKnown");}var oAction=ajouteElementSeq(defautR,"rollupAction");oAction.setAttribute("action",rollupAction);}}}return tabReglesAction;}function rollupRuleCheck(oActivite,rollupAction){var tabReglesAction=donneReglesRollup(oActivite,rollupAction,false);for (var r=0;r<tabReglesAction.length;r++){var tabContributingChildren=new Array();var tabFils=donneLesFils(oActivite,"item");var oConditions=parent.XML_filsNS(tabReglesAction[r],"imsss","rollupConditions");for (var j=0;j<tabFils.length;j++){if (deliveryControls(tabFils[j],"tracked")=="true"){if (checkChildForRollup(tabFils[j],rollupAction)){tabContributingChildren.push(evaluateRollupConditions(tabFils[j],oConditions));}}}var statusChange=false;var childActivitySet=tabReglesAction[r].getAttribute("childActivitySet");if (childActivitySet==null){childActivitySet="all";}if (childActivitySet=="all"){if (!tabContient(tabContributingChildren,"false") && !tabContient(tabContributingChildren,"unknown")){statusChange=true;}}if (childActivitySet=="any"){if (tabContient(tabContributingChildren,"true")){statusChange=true;}} else if (childActivitySet=="none"){if (!tabContient(tabContributingChildren,"true") && !tabContient(tabContributingChildren,"unknown")){statusChange=true;}} else if (childActivitySet=="atLeastCount"){var nombreTrue=0;for (var i=0;i<tabContributingChildren.length;i++){if (tabContributingChildren[i]=="true"){nombreTrue++;}}var minimumCount=tabReglesAction[r].getAttribute("minimumCount");if (minimumCount!=null && nombreTrue>=Number(minimumCount)){statusChange=true;}} else if (childActivitySet=="atLeastPercent"){var nombreTrue=0;for (var i=0;i<tabContributingChildren.length;i++){if (tabContributingChildren[i]=="true"){nombreTrue++;}}var minimumPercent=tabReglesAction[r].getAttribute("minimumPercent");nombreTrue=nombreTrue/tabContributingChildren.length;if (minimumPercent!=null && nombreTrue>=Number(minimumPercent)){statusChange=true;}}if (statusChange){return "true";}}return "false";}function evaluateRollupConditions(oActivite,oConditions){var tabFCond=parent.XML_tabElementFils(oConditions);var tabConditions=new Array(tabFCond.length);for (var i=0;i<tabFCond.length;i++){tabConditions[i]=evalueCondition(tabFCond[i],oActivite);}if (tabConditions.length==0){return "unknown";}var opfin=PF_attr(oConditions,"conditionCombination");if (opfin==""){opfin="any";}return combineResultatsConditions(tabConditions,opfin);}function evalueCondition(oCondition,oActivite){var resCond="unknown";var condition=oCondition.getAttribute("condition");var objectifCible;if (condition=="satisfied" || condition=="objectiveStatusKnown" || condition=="objectiveMeasureKnown" || condition=="objectiveMeasureGreaterThan" || condition=="objectiveMeasureLessThan" ||(OBJECTIFS_ADLSEQ && (condition=="completed"||condition=="activityProgressKnown"))){var referencedObjective=PF_attr(oCondition,"referencedObjective");if (referencedObjective!=""){referencedObjective=reduitEspaceID(referencedObjective);objectifCible=donneObjectifId(oActivite,referencedObjective);if (objectifCible==null){window.status="Objective "+referencedObjective+" not found";return resCond;}} else {objectifCible=donneObjectifCible(oActivite,true);}}if (condition=="satisfied"){if (lireEtatObjectif(objectifCible,"objectiveProgressStatus")=="true"){if (lireValeurObjectif(objectifCible,"objectiveSatisfiedStatus")=="true"){resCond="true";} else {resCond="false";}}} else if (condition=="objectiveStatusKnown"){resCond="false";if (lireEtatObjectif(objectifCible,"objectiveProgressStatus")=="true"){resCond="true";}} else if (condition=="objectiveMeasureKnown"){resCond="false";if (lireEtatObjectif(objectifCible,"objectiveMeasureStatus")=="true"){resCond="true";}} else if (condition=="objectiveMeasureGreaterThan"){if (lireEtatObjectif(objectifCible,"objectiveMeasureStatus")=="true"){resCond="false";var measureN=lireValeurObjectif(objectifCible,"objectiveNormalizedMeasure");var seuil=oCondition.getAttribute("measureThreshold");if ((seuil==null)||isNaN(seuil)){alert("measureThreshold is null in sequencing rule");}if (Number(measureN)>Number(seuil)){resCond="true";}}} else if (condition=="objectiveMeasureLessThan"){if (lireEtatObjectif(objectifCible,"objectiveMeasureStatus")=="true"){resCond="false";var measureN=lireValeurObjectif(objectifCible,"objectiveNormalizedMeasure");var seuil=oCondition.getAttribute("measureThreshold");if ((seuil==null)||isNaN(seuil)){alert("measureThreshold is null in sequencing rule");}if (Number(measureN)<Number(seuil)){resCond="true";}}} else if (condition=="completed"){var lirePossible=true;if (ROLLUP_SUR_COURANT && PF_attr(oActivite,"infoProgCourant")!="true"){if (!estRacine(oActivite) && controlMode(oActivite.parentNode,"useCurrentAttemptProgressInfo")=="true"){lirePossible=false;}}if (completionThreshold(oActivite,"completedByMeasure")=="true" && PF_attr(oCondition,"referencedObjective")==""){var seuil=Number(completionThreshold(oActivite,"minProgressMeasure"));if (peutLireValeurAdlObj("attemptProgressMeasure",oActivite,null)){var valp=Number(lireValeurAdlObj("attemptProgressMeasure",oActivite,null));if (valp>=seuil){resCond="true";} else {resCond="false";}} else {if (attrObj(oActivite,"attemptCompletionAmountStatus")=="true"){var valp=Number(attrObj(oActivite,"attemptCompletionAmount"));if (valp>=seuil){resCond="true";} else {resCond="false";}}}} else {if (peutLireValeurAdlObj("attemptCompletionStatus",oActivite,objectifCible)){resCond=lireValeurAdlObj("attemptCompletionStatus",oActivite,objectifCible);} else {if (attrObj(oActivite,"attemptProgressStatus")=="true" && lirePossible){resCond="false";if (attrObj(oActivite,"attemptCompletionStatus")=="true"){resCond="true";}}if (FIGER_ETAT_ITEM && attrObj(oActivite,"attemptCompletionStatus")=="true"){oActivite.setAttribute("attemptProgressStatus","true");oActivite.setAttribute("activityProgressStatus","true");resCond="true";}}}} else if (condition=="activityProgressKnown"){resCond="false";if (objectifCible!=null && PF_attr(oCondition,"referencedObjective")!="" && (peutLireValeurAdlObj("attemptCompletionStatus",oActivite,objectifCible)||PF_attr(objectifCible,"attemptProgressStatus")=="true")){resCond="true";} else {if (attrObj(oActivite,"activityProgressStatus")=="true"&&attrObj(oActivite,"attemptProgressStatus")=="true"){resCond="true";}}} else if (condition=="attempted"){resCond="false";if ((attrObj(oActivite,"activityProgressStatus")=="true")&&(parseInt(attrObj(oActivite,"attemptCount"))>0)){resCond="true";}} else if (condition=="attemptLimitExceeded"){resCond="false";if (attrObj(oActivite,"activityProgressStatus")=="true"){var compte=parseInt(attrObj(oActivite,"attemptCount"));var seuil=oCondition.getAttribute("attemptLimit");var limiteEssais=parseInt(limitConditions(oActivite,"attemptLimit"));if (limiteEssais>0){if (Number(compte)>=limiteEssais){resCond="true";}}}} else if (condition=="always"){resCond="true";}var operator=PF_attr(oCondition,"operator");if (operator=="not"){if (resCond=="false"){resCond="true";}else if (resCond=="true"){resCond="false";}}return resCond;}function donneActiviteId(lid){var obj=parent.XML_trouveNoeud(activiteRacine,"item","identifier",lid);if ((obj==null)&&(activiteRacine.getAttribute("identifier")==lid)){obj=activiteRacine;}return obj;}function donneObjectifCible(oActivite,creer){creer=true;var objsSeq=parent.XML_filsNS(oActivite,"imsss","sequencing");if (objsSeq==null){if (!creer){return null;}objsSeq=ajouteElementSeq(oActivite,"sequencing");}var objs=parent.XML_filsNS(objsSeq,"imsss","objectives");if (objs==null){if (!creer){return null;}objs=ajouteElementSeq(objsSeq,"objectives");}var oPrimaire=parent.XML_filsNS(objs,"imsss","primaryObjective");if (oPrimaire==null){if (!creer){return null;}oPrimaire=ajouteElementSeq(objs,"primaryObjective");}return oPrimaire;}function donneObjectifId(oAct,lid){var res=null;var lesobjs=donneObjectifs(oAct,false);for (var i=0;i<lesobjs.length;i++){var oObj=lesobjs[i];var idoj=oObj.getAttribute("objectiveID");if (idoj && reduitEspaceID(idoj)==reduitEspaceID(lid)){res=oObj;}}return res;}function checkChildForRollup(oActivite,rollupAction){var included=false;if (rollupAction=="satisfied"||rollupAction=="notSatisfied"){if (rollupRules(oActivite,"rollupObjectiveSatisfied")=="true"){included=true;if ((rollupAction=="satisfied"&&rollupConsiderations(oActivite,"requiredForSatisfied")=="ifNotSuspended") || (rollupAction=="notSatisfied"&&rollupConsiderations(oActivite,"requiredForNotSatisfied")=="ifNotSuspended")){if (attrObj(oActivite,"activityProgressStatus")=="false" || (parseInt(attrObj(oActivite,"attemptCount"))>0 && attrObj(oActivite,"activityIsSuspended")=="true")){included=false;}} else {if ((rollupAction=="satisfied"&&rollupConsiderations(oActivite,"requiredForSatisfied")=="ifAttempted") || (rollupAction=="notSatisfied" && rollupConsiderations(oActivite,"requiredForNotSatisfied")=="ifAttempted")){if (attrObj(oActivite,"activityProgressStatus")=="false" || parseInt(attrObj(oActivite,"attemptCount"))==0){included=false;}} else {if ((rollupAction=="satisfied" && rollupConsiderations(oActivite,"requiredForSatisfied")=="ifNotSkipped") || (rollupAction=="notSatisfied" && rollupConsiderations(oActivite,"requiredForNotSatisfied")=="ifNotSkipped")){if (sequencingRulesCheck(oActivite,"skip")!="nil"){included=false;}}}}}}if (rollupAction=="completed"||rollupAction=="incomplete"){if (rollupRules(oActivite,"rollupProgressCompletion")=="true"){included=true;if ((rollupAction=="completed" && rollupConsiderations(oActivite,"requiredForCompleted")=="ifNotSuspended") || (rollupAction=="incomplete" && rollupConsiderations(oActivite,"requiredForIncomplete")=="ifNotSuspended")){if (attrObj(oActivite,"activityProgressStatus")=="false" || (parseInt(attrObj(oActivite,"attemptCount"))>0 && (attrObj(oActivite,"activityIsSuspended")=="true"))){included=false;}} else {if ((rollupAction=="completed" && rollupConsiderations(oActivite,"requiredForCompleted")=="ifAttempted") || (rollupAction=="incomplete" && rollupConsiderations(oActivite,"requiredForIncomplete")=="ifAttempted")){if (attrObj(oActivite,"activityProgressStatus")=="false" || parseInt(attrObj(oActivite,"attemptCount"))==0){included=false;}} else {if ((rollupAction=="completed" && rollupConsiderations(oActivite,"requiredForCompleted")=="ifNotSkipped") || (rollupAction=="incomplete" && rollupConsiderations(oActivite,"requiredForIncomplete")=="ifNotSkipped")){if (sequencingRulesCheck(oActivite,"skip")!="nil"){included=false;}}}}}}return included;}function donneRegles(oActivite){var res=null;var objr=parent.XML_filsNS(oActivite,"imsss","sequencing");if (objr!=null){objr=parent.XML_filsNS(objr,"imsss","sequencingRules");}if (objr!=null){res=objr;}return res;}function overallRollup(oActivite){ROLLUP_SUR_COURANT=false;if (!FIGER_ETAT_ITEM && activiteCourante!=null && PF_attr(activiteCourante,"identifier")==PF_attr(oActivite,"identifier")){ROLLUP_SUR_COURANT=true;}if (peutMesurerSatisfaction(oActivite)){if (tabDejaFaitRollup==null){tabDejaFaitRollup=new Array();}tabDejaFaitRollup.push(oActivite.getAttribute("identifier"));}var tabCheminActivites=formerCheminAct(oActivite,true,activiteRacine,true);if (tabCheminActivites.length==0){return "";}for (var i=0;i<tabCheminActivites.length;i++){var oAct=tabCheminActivites[i];if (tabDejaFaitRollup && peutMesurerSatisfaction(oAct)){tabDejaFaitRollup.push(oAct.getAttribute("identifier"));}var estFeuille0=estFeuille(oAct);if (!estFeuille0){measureRollup(oAct);completionMeasureRollup(oAct);}var objectifCible=donneObjectifCible(oAct,false);if (objectifCible!=null&&(attrObj(objectifCible,"satisfiedByMeasure")=="true")){objectiveRollupUsingMeasure(oAct);} else {if (!estFeuille0){objectiveRollupUsingRules(oAct);}}if (!estFeuille0){if (completionThreshold(oAct,"completedByMeasure")=="true"){activityProgressRollupUsingMeasure(oAct);} else {activityProgressRollupUsingRules(oAct);}}}ROLLUP_SUR_COURANT=false;}function selectChildren(oActivite){var lesFils=donneLesFils(oActivite,"item");if (lesFils.length==0){return "";}/*if (estActive(oActivite)||estSuspendue(oActivite)){return "";}*/var selectionTiming=randomizationControls(oActivite,"selectionTiming");if (selectionTiming=="never"){return "";}if (selectionTiming=="once"){if ((attrObj(oActivite,"activityProgressStatus")=="false")||(attrObj(oActivite,"availableChildren")=="_all")){if (attrObj(oActivite,"selectionCountStatus")=="true"){var compte=parseInt(randomizationControls(oActivite,"selectCount"));var lesids="[;]";if ((compte>0)&&(compte<lesFils.length)){for (var k=0;k<compte;k++){var num=Math.floor(Math.random()*lesFils.length);while (lesids.indexOf("[;]"+lesFils[num].getAttribute("identifier")+"[;]")>=0){num=Math.floor(Math.random()*lesFils.length);}lesids+=lesFils[num].getAttribute("identifier")+"[;]";}oActivite.setAttribute("availableChildren",lesids.substring(3,lesids.length-3));purgerLesFils(oActivite);}}} else {purgerLesFils(oActivite);}return "";}if (selectionTiming=="onEachNewAttempt"){return "";}}function purgerLesFils(oActivite){var availableChildren=attrObj(oActivite,"availableChildren");if (availableChildren!="_all"){var lesFils=donneLesFils(oActivite,"item");var tabC=availableChildren.split("[;]");for (var k=lesFils.length-1;k>=0;k--){if (!tabContient(tabC,lesFils[k].getAttribute("identifier"))){var oDiv=PF_donneObjet("div"+lesFils[k].getAttribute("nom"));oDiv.parentNode.removeChild(oDiv);oDiv=PF_donneObjet("divFils"+lesFils[k].getAttribute("nom"));if (oDiv!=null){oDiv.parentNode.removeChild(oDiv);}lesFils[k].parentNode.removeChild(lesFils[k]);}}}}function remettreOrdreEnregistre(oActivite){var availableChildren=attrObj(oActivite,"availableChildren");if (availableChildren!="_all"){var lesFils=donneLesFils(oActivite,"item");var tabC=availableChildren.split("[;]");var posPrem=tabC.length-1;while (posPrem>=0){var oItem=parent.XML_trouveNoeud(oActivite,"item","identifier",tabC[posPrem]);var lesFils=donneLesFils(oActivite,"item");if (oItem && PF_attr(lesFils[0],"identifier")!=tabC[posPrem]){oActivite.insertBefore(oItem,oActivite.firstChild);var oDiv=PF_donneObjet("div"+oItem.getAttribute("nom"));var oDivFils=PF_donneObjet("divFils"+oItem.getAttribute("nom"));var oDiv0=PF_donneObjet("div"+lesFils[0].getAttribute("nom"));oDiv.parentNode.insertBefore(oDiv,oDiv0);if (oDivFils!=null){oDiv.parentNode.insertBefore(oDivFils,oDiv.nextSibling);}}posPrem--;}}}function randomizeChildren(oActivite){var lesFils=donneLesFils(oActivite,"item");if (lesFils.length==0){return "";}/*if (estActive(oActivite)||estSuspendue(oActivite)){return "";}*/var randomizationTiming=randomizationControls(oActivite,"randomizationTiming");if (randomizationTiming=="never"){return "";}if (randomizationTiming=="once"){if (attrObj(oActivite,"activityProgressStatus")=="false"){if (attrObj(oActivite,"randomizeChildren")=="true"){melangerLesFils(oActivite,lesFils);}} else {remettreOrdreEnregistre(oActivite);}return "";}if (randomizationTiming=="onEachNewAttempt"){melangerLesFils(oActivite,lesFils);}}function melangerLesFils(oActivite,lesFils){var nbPris=0;while (nbPris<lesFils.length){var num=Math.floor(Math.random()*lesFils.length);if (num>0){var oItem=lesFils[num];oActivite.insertBefore(oItem,lesFils[0]);var oDiv=PF_donneObjet("div"+oItem.getAttribute("nom"));var oDivFils=PF_donneObjet("divFils"+oItem.getAttribute("nom"));var oDiv0=PF_donneObjet("div"+lesFils[0].getAttribute("nom"));oDiv.parentNode.insertBefore(oDiv,oDiv0);if (oDivFils!=null){oDiv.parentNode.insertBefore(oDivFils,oDiv.nextSibling);}}nbPris++;}var lesids="";lesFils=donneLesFils(oActivite,"item");for (var k=0;k<lesFils.length;k++){lesids+=lesFils[k].getAttribute("identifier")+"[;]";}oActivite.setAttribute("availableChildren",lesids.substring(0,lesids.length-3));}function estDerniereActivite(oActivite){if (oActivite.nextSibling!=null && oActivite.nextSibling.nodeName=="item"){return false;}return true;}function estPremiereActivite(oActivite){var res=true;var suiv=oActivite.previousSibling;if (suiv!=null && suiv.nodeName=="item"){res=false;}return res;}function premiereActivite(oActivite){return parent.XML_fils(oActivite,"item");}function derniereActivite(oActivite){var derFils=oActivite.lastChild;while (derFils!=null && derFils.nodeName!="item"){derFils=derFils.previousSibling;}return derFils;}function estFeuille(oActivite){return (parent.XML_fils(oActivite,"item")==null);}function flowTreeTraversalSub(oActivite,traversalDirection,considerChildren,previousTraversalDirection){var reversedDirection=false;var tabRes=new Array();if (previousTraversalDirection=="backward" && estDerniereActivite(oActivite)){traversalDirection="backward";oActivite=premiereActivite(oActivite.parentNode);reversedDirection=true;}if (traversalDirection=="forward"){if ((estDerniereActiviteArbre(oActivite)||estDerniereActiviteDuFlux(oActivite)) || (estRacine(oActivite)&&!considerChildren)){terminateDescendentAttempts(oActivite);if (!MODE_PREEMPTIF){sortieSurBoutonSuivant=true;}tabRes[0]=null;tabRes[1]="";tabRes[2]="true";tabRes[3]="";return tabRes;}if (estFeuille(oActivite)||!considerChildren){if (estDerniereActivite(oActivite)){/*if (estRacine(oActivite)){if (!MODE_PREEMPTIF){sortieSurBoutonSuivant=true;}tabRes[0]=null;tabRes[1]="";tabRes[2]="true";tabRes[3]="";return tabRes;}*/return flowTreeTraversalSub(oActivite.parentNode,"forward",false,"");} else {tabRes[0]=oActivite.nextSibling;tabRes[1]=traversalDirection;tabRes[2]="";tabRes[3]="";return tabRes;}} else {if (!estFeuille(oActivite)){tabRes[0]=premiereActivite(oActivite);tabRes[1]=traversalDirection;tabRes[2]="";tabRes[3]="";return tabRes;} else {tabRes[0]=null;tabRes[1]="";tabRes[2]="";tabRes[3]="SB.2.1-2";return tabRes;}}}if (traversalDirection=="backward"){if (estRacine(oActivite)){tabRes[0]=null;tabRes[1]="";tabRes[2]="";tabRes[3]="SB.2.1-3";return tabRes;}if (estFeuille(oActivite)||!considerChildren){if (!reversedDirection){if (controlMode(oActivite.parentNode,"forwardOnly")=="true"){tabRes[0]=null;tabRes[1]="";tabRes[2]="";tabRes[3]="SB.2.1-4";return tabRes;}}if (estPremiereActivite(oActivite)){return flowTreeTraversalSub(oActivite.parentNode,"backward",false,"");} else {tabRes[0]=oActivite.previousSibling;tabRes[1]=traversalDirection;tabRes[2]="";tabRes[3]="";return tabRes;}} else {if (!estFeuille(oActivite)){if (controlMode(oActivite,"forwardOnly")=="true"){tabRes[0]=premiereActivite(oActivite);tabRes[1]="forward";tabRes[2]="";tabRes[3]="";return tabRes;} else {tabRes[0]=derniereActivite(oActivite);tabRes[1]="backward";tabRes[2]="";tabRes[3]="";return tabRes;}} else {tabRes[0]=null;tabRes[1]="";tabRes[2]="";tabRes[3]="SB.2.1-2";return tabRes;}}}}function flowActivityTraversalSub(oActivite,traversalDirection,previousTraversalDirection){var tabRes=new Array(4);if (controlMode(oActivite.parentNode,"flow")=="false"){tabRes[0]=oActivite;tabRes[1]=false;tabRes[2]="";tabRes[3]="SB.2.2-1";return tabRes;}if (sequencingRulesCheck(oActivite,"skip")!="nil"){var oResu=flowTreeTraversalSub(oActivite,traversalDirection,false,previousTraversalDirection);if (oResu[0]==null){tabRes[0]=oActivite;tabRes[1]=false;tabRes[2]=oResu[2];tabRes[3]=oResu[3];return tabRes;} else {var resRecur;if (previousTraversalDirection=="backward"&&oResu[1]=="backward"){resRecur=flowActivityTraversalSub(oResu[0],oResu[1],"");} else {resRecur=flowActivityTraversalSub(oResu[0],oResu[1],previousTraversalDirection);}return resRecur;}}if (checkActivity(oActivite)){tabRes[0]=oActivite;tabRes[1]=false;tabRes[2]="";tabRes[3]="SB.2.2-2";return tabRes;}if (!estFeuille(oActivite)){var oResu=flowTreeTraversalSub(oActivite,traversalDirection,true,"");if (oResu[0]==null){tabRes[0]=oActivite;tabRes[1]=false;tabRes[2]=oResu[2];tabRes[3]=oResu[3];return tabRes;} else {var resRecur;if (traversalDirection=="backward"&&oResu[1]=="forward"){resRecur=flowActivityTraversalSub(oResu[0],"forward","backward");} else {resRecur=flowActivityTraversalSub(oResu[0],traversalDirection,"");}return resRecur;}}tabRes[0]=oActivite;tabRes[1]=true;tabRes[2]="";tabRes[3]="";return tabRes;}function flowSub(oActivite,traversalDirection,considerChildren){var activiteCandidate=oActivite;var tabRes=new Array(4);var oResu=flowTreeTraversalSub(activiteCandidate,traversalDirection,considerChildren,"");if (oResu[0]==null){tabRes[0]=false;tabRes[1]=activiteCandidate;tabRes[2]=oResu[2];tabRes[3]=oResu[3];return tabRes;} else {activiteCandidate=oResu[0];oResu=flowActivityTraversalSub(activiteCandidate,traversalDirection,"");tabRes[0]=oResu[1];tabRes[1]=oResu[0];tabRes[2]=oResu[2];tabRes[3]=oResu[3];return tabRes;}}function choiceActivityTraversalSub(oActivite,traversalDirection){if (traversalDirection=="forward"){if (sequencingRulesCheck(oActivite,"stopForwardTraversal")!="nil"){return tabR("false;SB.2.4-1");}return tabR("true;");}if (traversalDirection=="backward"){if (!estRacine(oActivite)){if (controlMode(oActivite.parentNode,"forwardOnly")=="true"){return tabR("false;SB.2.4-2");}} else {return tabR("false;SB.2.4-3");}return tabR("true;");}}function startSequencingRequest(){var tabRes=new Array(3);if (activiteCourante!=null){tabRes[0]=null;tabRes[1]="";tabRes[2]="SB.2.5-1";return tabRes;}if (estFeuille(activiteRacine)){tabRes[0]=activiteRacine;tabRes[1]="";tabRes[2]="";return tabRes;} else {var oResu=flowSub(activiteRacine,"forward",true);if (!oResu[0]){tabRes[0]=null;tabRes[1]=oResu[2];tabRes[2]=oResu[3];return tabRes;} else {tabRes[0]=oResu[1];tabRes[1]="";tabRes[2]="";return tabRes;}}}function resumeAllSequencingRequest(){var tabRes=new Array(2);if (activiteCourante!=null){tabRes[0]=null;tabRes[1]="SB.2.6-1";return tabRes;}if (activiteSuspendue==null){tabRes[0]=null;tabRes[1]="SB.2.6-2";return tabRes;}tabRes[0]=activiteSuspendue;tabRes[1]="";return tabRes;}function continueSequencingRequest(){var tabRes=new Array(3);tabRes[1]="";tabRes[2]="";if (activiteCourante==null){tabRes[0]=null;tabRes[2]="SB.2.7-1";return tabRes;}if (!estRacine(activiteCourante)){if (controlMode(activiteCourante.parentNode,"flow")=="false"){tabRes[0]=null;tabRes[2]="SB.2.7-2";return tabRes;}}var oResu=flowSub(activiteCourante,"forward",false);if (!oResu[0]){tabRes[0]=null;tabRes[1]=oResu[2];tabRes[2]=oResu[3];return tabRes;} else {tabRes[0]=oResu[1];return tabRes;}}function previousSequencingRequest(){var tabRes2=new Array(2);if (activiteCourante==null){tabRes2[0]=null;tabRes2[1]="SB.2.8-1";return tabRes2;}if (!estRacine(activiteCourante)){if (controlMode(activiteCourante.parentNode,"flow")=="false"){tabRes2[0]=null;tabRes2[1]="SB.2.8-2";return tabRes2;}}var oResu=flowSub(activiteCourante,"backward",false);if (!oResu[0]){tabRes2[0]=null;tabRes2[1]=oResu[3];return tabRes2;} else {tabRes2[0]=oResu[1];tabRes2[1]="";return tabRes2;}}function estDerniereActiviteArbre(oActivite){if (!estDerniereActivite(oActivite)){return false;}if (!estFeuille(oActivite)){return false;}var oTemp=oActivite;while (oTemp!=null && !estRacine(oTemp)){oTemp=oTemp.parentNode;if (oTemp.nextSibling!=null && oTemp.nextSibling.nodeName=="item"){return false;}}return true;}function estPremiereActiviteArbre(oActivite){if (!estPremiereActivite(oActivite)){return false;}if (!estFeuille(oActivite)){return false;}var oTemp=oActivite;while (oTemp!=null && !estRacine(oTemp)){oTemp=oTemp.parentNode;if (oTemp.previousSibling!=null && oTemp.previousSibling.nodeName=="item" && controlMode(oTemp.parentNode,"flow")=="true"){return false;}}return true;}function choiceSequencingRequest(){var tabRes=new Array(2);var cibleDuChoix=activiteSpecifieParChoix;if (MODE_PREEMPTIF){cibleDuChoix=activiteSpecifieParChoixPreemptif;}var activiteCible=donneActiviteId(cibleDuChoix);if (activiteCible==null){tabRes[0]=null;tabRes[1]="SB.2.9-1";return tabRes;}/*if (TEST_AFF_PARC && MODE_PREEMPTIF){if (constrainedChoiceConsiderations(activiteCible,"preventActivation")=="true" && !estFeuille(activiteCible)){var vDis="";if (!estActive(activiteCible)){vDis="none";}cacherItemSelonRegle(activiteCible,vDis);}}*//*if (activiteCible!=activiteRacine){if (false){tabRes[0]=null;tabRes[1]="SB.2.9-2";return tabRes;}}*/var tabCheminActivites=formerCheminAct(activiteCible,true,activiteRacine,true);for (var i=tabCheminActivites.length-1;i>=0;i--){if (donneRegles(tabCheminActivites[i])!=null){var vDis="";if (sequencingRulesCheck(tabCheminActivites[i],"hiddenFromChoice")!="nil"){vDis="none";tabRes[0]=null;tabRes[1]="SB.2.9-3";}cacherItemSelonRegle(tabCheminActivites[i],vDis);if (vDis=="none"){return tabRes;}}}if (!estRacine(activiteCible)){if (controlMode(activiteCible.parentNode,"choice")=="false"){tabRes[0]=null;tabRes[1]="SB.2.9-4";return tabRes;}}var oAncetre;if (activiteCourante!=null){oAncetre=ancetreCommun(activiteCourante,activiteCible);} else {oAncetre=activiteRacine;}if (activiteCourante==activiteCible){} else if (activiteCourante!=null && estFrere(activiteCourante,activiteCible)){var cibleEstApresActiviteCourante=false;var oTemp=activiteCourante.nextSibling;while (oTemp!=null&&!cibleEstApresActiviteCourante){if (oTemp==activiteCible){cibleEstApresActiviteCourante=true;}oTemp=oTemp.nextSibling;}var tabActivites=new Array();tabActivites[0]=activiteCourante;var traverse;if (cibleEstApresActiviteCourante){traverse="forward";var oSuiv=activiteCourante.nextSibling;while (oSuiv!=activiteCible && oSuiv.nodeName=="item"){tabActivites.push(oSuiv);oSuiv=oSuiv.nextSibling;}} else {traverse="backward";var oSuiv=activiteCourante.previousSibling;while (oSuiv!=activiteCible && oSuiv.nodeName=="item"){tabActivites.push(oSuiv);oSuiv=oSuiv.previousSibling;}}if (tabActivites.length==0){tabRes[0]=null;tabRes[1]="SB.2.9-5";return tabRes;}for (var i=0;i<tabActivites.length;i++){var tabC=choiceActivityTraversalSub(tabActivites[i],traverse);if (tabC[0]=="false"){tabRes[0]=null;tabRes[1]=tabC[1];return tabRes;}}} else if (activiteCourante==null||activiteCourante==oAncetre){var tabCheminActivites=formerCheminAct(activiteCible,false,oAncetre,true);if (tabCheminActivites.length==0){tabRes[0]=null;tabRes[1]="SB.2.9-5";return tabRes;}for (var i=tabCheminActivites.length-1;i>=0;i--){var tabC=choiceActivityTraversalSub(tabCheminActivites[i],"forward");if (tabC[0]=="false"){tabRes[0]=null;tabRes[1]=tabC[1];return tabRes;}if (!estActive(tabCheminActivites[i]) && estNoeudDiff(tabCheminActivites[i],oAncetre) && constrainedChoiceConsiderations(tabCheminActivites[i],"preventActivation")=="true"){tabRes[0]=null;tabRes[1]="SB.2.9-6";return tabRes;}}} else if (activiteCible==oAncetre){var tabCheminActivites=formerCheminAct(activiteCourante,true,activiteCible,true);if (tabCheminActivites.length==0){tabRes[0]=null;tabRes[1]="SB.2.9-5";return tabRes;}for (var i=0;i<tabCheminActivites.length-1;i++){if (controlMode(tabCheminActivites[i],"choiceExit")=="false"){tabRes[0]=null;tabRes[1]="SB.2.9-7";return tabRes;}}} else if (estApres(activiteCible,oAncetre)) {var tabCheminActivites=formerCheminAct(activiteCourante,true,oAncetre,false);if (tabCheminActivites.length==0){tabRes[0]=null;tabRes[1]="SB.2.9-5";return tabRes;}var activiteContrainte=null;for (var i=0;i<tabCheminActivites.length;i++){if (controlMode(tabCheminActivites[i],"choiceExit")=="false"){tabRes[0]=null;tabRes[1]="SB.2.9-7";return tabRes;}if (activiteContrainte==null){if (constrainedChoiceConsiderations(tabCheminActivites[i],"constrainChoice")=="true" && !estFeuille(tabCheminActivites[i])){activiteContrainte=tabCheminActivites[i];}}}if (activiteContrainte!=null){var traverse;if (estApres(activiteCible,activiteContrainte)){traverse="forward";} else {traverse="backward";}var activiteAConsiderer=choiceFlowSub(activiteContrainte,traverse);var estDescendant=false;var oTemp=activiteCible.parentNode;while (oTemp!=null && !estDescendant){if (oTemp==activiteAConsiderer){estDescendant=true;}oTemp=oTemp.parentNode;}if (!estDescendant && activiteCible!=activiteAConsiderer && activiteCible!=activiteContrainte){tabRes[0]=null;tabRes[1]="SB.2.9-8";return tabRes;}}var tabCheminActivites=formerCheminAct(activiteCible,false,oAncetre,true);if (tabCheminActivites.length==0){tabRes[0]=null;tabRes[1]="SB.2.9-5";return tabRes;}if (estApres(activiteCible,activiteCourante)){for (var i=tabCheminActivites.length-1;i>=0;i--){var tabC=choiceActivityTraversalSub(tabCheminActivites[i],"forward");if (tabC[0]=="false"){tabRes[0]=null;tabRes[1]=tabC[1];return tabRes;}if (!estActive(tabCheminActivites[i]) && estNoeudDiff(tabCheminActivites[i],oAncetre) && constrainedChoiceConsiderations(tabCheminActivites[i],"preventActivation")=="true"){tabRes[0]=null;tabRes[1]="SB.2.9-6";return tabRes;}}} else {for (var i=tabCheminActivites.length-1;i>=0;i--){if (!estActive(tabCheminActivites[i]) && estNoeudDiff(tabCheminActivites[i],oAncetre) && constrainedChoiceConsiderations(tabCheminActivites[i],"preventActivation")=="true"){tabRes[0]=null;tabRes[1]="SB.2.9-6";return tabRes;}}}}if (estFeuille(activiteCible)){tabRes[0]=activiteCible;tabRes[1]="";return tabRes;}var oResu=flowSub(activiteCible,"forward",true);if (!oResu[0]){terminateDescendentAttempts(oAncetre);endAttempt(oAncetre);affecteActiviteCourante(activiteCible);tabRes[0]=null;tabRes[1]="SB.2.9-9";return tabRes;} else {tabRes[0]=oResu[1];tabRes[1]="";return tabRes;}}function estApres(oNoeud1,oNoeud2){if (oNoeud2.nodeName=="organization"){return true;}var lesobjs=parent.XML_listeParBalise(activiteRacine,oNoeud1.nodeName);var pos1=0;var pos2=0;for (var n=0;n<lesobjs.length;n++){if (lesobjs[n]==oNoeud1){pos1=n;}if (lesobjs[n]==oNoeud2){pos2=n;}}return (pos1>pos2);}function choiceFlowSub(oActivite,traversalDirection){var oTemp=choiceFlowTreeTraversalSub(oActivite,traversalDirection);if (oTemp==null){return oActivite;} else {return oTemp;}}function choiceFlowTreeTraversalSub(oActivite,traversalDirection){if (traversalDirection=="forward"){if (estRacine(oActivite)||estDerniereActiviteArbre(oActivite)||estDerniereActiviteDuFlux(oActivite)){return null;}if (estDerniereActivite(oActivite)){return choiceFlowTreeTraversalSub(oActivite.parentNode,"forward");} else {return oActivite.nextSibling;}}if (traversalDirection=="backward"){if (estRacine(oActivite)){return null;}if (estPremiereActivite(oActivite)){return choiceFlowTreeTraversalSub(oActivite.parentNode,"backward");} else {return oActivite.previousSibling;}}}function retrySequencingRequest(){var tabRes=new Array(2);if (activiteCourante==null){tabRes[0]=null;tabRes[1]="SB.2.10-1";return tabRes;}if (estActive(activiteCourante)||estSuspendue(activiteCourante)){tabRes[0]=null;tabRes[1]="SB.2.10-2";return tabRes;}if (!estFeuille(activiteCourante)){if (!MODE_PREEMPTIF && !OBJ_GLOBAL_SYSTEM && !FIGER_ETAT_ITEM && estRacine(activiteCourante)){vaRecommencerRacine=true;}var oResu=flowSub(activiteCourante,"forward",true);if (!oResu[0]){tabRes[0]=null;tabRes[1]="SB.2.10-3";return tabRes;} else {tabRes[0]=oResu[1];tabRes[1]="";return tabRes;}} else {tabRes[0]=activiteCourante;tabRes[1]="";return tabRes;}}function exitSequencingRequest(){if (activiteCourante==null){return tabR("false;SB.2.11-1");}if (estActive(activiteCourante)){return tabR("false;SB.2.11-2");}if (estRacine(activiteCourante)){return tabR("true;");}return tabR("false;");}function sequencingRequest(requete){var tabRes=new Array(4);tabRes[0]="notValid";tabRes[1]=null;tabRes[2]="";tabRes[3]="";var resSub;if (requete=="start"){resSub=startSequencingRequest();if (resSub[2]!=""){tabRes[3]=resSub[2];return tabRes;} else {tabRes[0]="valid";tabRes[1]=resSub[0];tabRes[2]=resSub[1];return tabRes;}}if (requete=="resumeAll"){resSub=resumeAllSequencingRequest();if (resSub[1]!=""){tabRes[3]=resSub[1];return tabRes;} else {tabRes[0]="valid";tabRes[1]=resSub[0];return tabRes;}}if (requete=="exit"){resSub=exitSequencingRequest();if (resSub[1]!=""){tabRes[3]=resSub[1];return tabRes;} else {tabRes[2]=resSub[0];tabRes[0]="valid";return tabRes;}}if (requete=="retry"){resSub=retrySequencingRequest();if (resSub[1]!=""){tabRes[3]=resSub[1];return tabRes;} else {tabRes[0]="valid";tabRes[1]=resSub[0];return tabRes;}}if (requete=="continue"){resSub=continueSequencingRequest();if (resSub[2]!=""){tabRes[3]=resSub[2];return tabRes;} else {tabRes[0]="valid";tabRes[1]=resSub[0];tabRes[2]=resSub[1];return tabRes;}}if (requete=="previous"){resSub=previousSequencingRequest();if (resSub[1]!=""){tabRes[3]=resSub[1];return tabRes;} else {tabRes[0]="valid";tabRes[1]=resSub[0];return tabRes;}}if (requete=="choice"){resSub=choiceSequencingRequest();if (resSub[1]!=""){tabRes[3]=resSub[1];return tabRes;} else {tabRes[0]="valid";tabRes[1]=resSub[0];return tabRes;}}if (requete=="jump"){resSub=jumpSequencingRequest();if (resSub[1]!=""){tabRes[3]=resSub[1];return tabRes;} else {tabRes[0]="valid";tabRes[1]=resSub[0];return tabRes;}}tabRes[3]="SB.2.12-1";return tabRes;}function jumpSequencingRequest(){if (activiteCourante==null){return "SB.2.13-1";}var tabRes=new Array(2);var cibleDuChoix=activiteSpecifieParChoix;if (MODE_PREEMPTIF){cibleDuChoix=activiteSpecifieParChoixPreemptif;}tabRes[0]=donneActiviteId(cibleDuChoix);tabRes[1]="";return tabRes;} function deliveryRequest(oActivite){if (!estFeuille(oActivite)){return tabR("notValid;DB.1.1-1");}var tabCheminActivites=formerCheminAct(oActivite,true,activiteRacine,true);for (var i=tabCheminActivites.length-1;i>=0;i--){if (checkActivity(tabCheminActivites[i])){return tabR("notValid;DB.1.1-3");}}return tabR("valid;");}function contentDeliveryEnvironment(oActivite){if (activiteCourante!=null && estActive(activiteCourante)){return "DB.2-1";}if (MODE_PREEMPTIF){return "";}if (tabDejaFaitRollup!=null){if (activiteSuspendue!=null && PF_attr(oActivite,"identifier")!=PF_attr(activiteSuspendue,"identifier")){clearSuspendedActivitySub(oActivite);}terminateDescendentAttempts(oActivite);}var dateEvt=parent.getDateServeur('');var racmn=DOMManifest.documentElement;racmn.setAttribute("dateAcces",dateEvt);if (PF_attr(racmn,"dateEntre")==""){modifEtatMembre=true;racmn.setAttribute("dateEntre",dateEvt);racmn.setAttribute("etatParcours","attempted");}if (!SUIVI_DESACTIVE){var tabCheminActivites=formerCheminAct(oActivite,true,activiteRacine,true);for (var i=tabCheminActivites.length-1;i>=0;i--){if (!estActive(tabCheminActivites[i])){if (deliveryControls(tabCheminActivites[i],"tracked")=="true"){if (estSuspendue(tabCheminActivites[i])){tabCheminActivites[i].removeAttribute("activityIsSuspended");} else {var nbEssai=parseInt(attrObj(tabCheminActivites[i],"attemptCount"));nbEssai=nbEssai+1;tabCheminActivites[i].setAttribute("attemptCount",nbEssai);tabCheminActivites[i].setAttribute("activityProgressStatus","true");initialiserTentative(tabCheminActivites[i]);}}tabCheminActivites[i].setAttribute("activityIsActive","true");}}}affecteActiviteCourante(oActivite);activiteSuspendue=null;PLAN_lancerActivite(oActivite);return "";}function clearSuspendedActivitySub(oActivite){if (activiteSuspendue!=null){var oAncetre=ancetreCommun(oActivite,activiteSuspendue);var tabCheminActivites=formerCheminAct(activiteSuspendue,true,oAncetre,true);for (var i=0;i<tabCheminActivites.length;i++){if (estFeuille(tabCheminActivites[i])){tabCheminActivites[i].removeAttribute("activityIsSuspended");} else {var tabFils=donneLesFils(tabCheminActivites[i],"item");var enSuspend=false;for (var j=0;j<tabFils.length;j++){if (estSuspendue(tabFils[j])){enSuspend=true;break;}}if (!enSuspend){tabCheminActivites[i].removeAttribute("activityIsSuspended");}}}activiteSuspendue=null;}}function limitConditionsCheck(oActivite){if (deliveryControls(oActivite,"tracked")=="false"){return false;}if (estActive(oActivite)||estSuspendue(oActivite)){return false;}var limiteEssais=parseInt(limitConditions(oActivite,"attemptLimit"));if (limiteEssais>0 && attrObj(oActivite,"activityProgressStatus")=="true"){var nbEssai=parseInt(attrObj(oActivite,"attemptCount"));if (nbEssai>=limiteEssais){return true;}}return false;}function sequencingRulesCheck(oActivite,lesActions){var tabRegles=new Array();var tabActions=lesActions.split(",");var objr=donneRegles(oActivite);if (objr!=null){var tabFOr=parent.XML_tabElementFils(objr);for (var i=0;i<tabFOr.length;i++){var action=parent.XML_filsNS(tabFOr[i],"imsss","ruleAction");if (action!=null && tabContient(tabActions,action.getAttribute("action"))){tabRegles.push(tabFOr[i]);}}for (var i=0;i<tabRegles.length;i++){resS=sequencingRulesCheckSub(oActivite,tabRegles[i]);if (resS=="true"){var action=parent.XML_filsNS(tabRegles[i],"imsss","ruleAction");return action.getAttribute("action");}}}return "nil";}function sequencingRulesCheckSub(oActivite,oRegle){var oConditions=parent.XML_filsNS(oRegle,"imsss","ruleConditions");var tabFCond=parent.XML_tabElementFils(oConditions);var tabConditions=new Array(tabFCond.length);for (var i=0;i<tabFCond.length;i++){tabConditions[i]=evalueCondition(tabFCond[i],oActivite);}if (tabConditions.length==0){return "unknown";}var opfin=PF_attr(oConditions,"conditionCombination");if (opfin==""){opfin="all";}return combineResultatsConditions(tabConditions,opfin);}function combineResultatsConditions(tabConditions,opfin){var existeVrai=false;var existeFaux=false;var existeInconnu=false;for (var i=0;i<tabConditions.length;i++){if (tabConditions[i]=="false"){existeFaux=true;}if (tabConditions[i]=="true"){existeVrai=true;}if (tabConditions[i]=="unknown"){existeInconnu=true;}}if (opfin=="all"){if (existeVrai && !existeFaux && !existeInconnu){return "true";}if (!existeFaux && existeInconnu){return "unknown";}}if (opfin=="any"){if (existeVrai){return "true";}if (existeInconnu){return "unknown";}}return "false";}function terminateDescendentAttempts(oActivite){if (activiteCourante==null){return true;}var oAncetre=ancetreCommun(oActivite,activiteCourante);var tabCheminActivites=formerCheminAct(activiteCourante,false,oAncetre,false);for (var i=0;i<tabCheminActivites.length;i++){endAttempt(tabCheminActivites[i]);}}function endAttempt(oActivite){if (estFeuille(oActivite)){if (deliveryControls(oActivite,"tracked")=="true"){if (!estSuspendue(oActivite)){var testBien=true;if (MODE_PREEMPTIF&&ressourceCourante!=null){if (ressourceCourante.getAttribute("adlcp:scormType")!="asset"){testBien=false;}}if (testBien && deliveryControls(oActivite,"completionSetByContent")=="false"){if (attrObj(oActivite,"attemptProgressStatus")=="false" && PF_attr(oActivite,"affecteEtatCompletion")==""){var remetObjAdl=PF_attr(oActivite,"affecteEtatCompletionObj");enregistrerCompletion(oActivite,true);if (remetObjAdl!=""){appliqueValeurAdlObj("attemptCompletionStatus",remetObjAdl,oActivite,null);}oActivite.setAttribute("attemptCompletionAmount","1");oActivite.setAttribute("attemptCompletionStatus","true");}}if (deliveryControls(oActivite,"objectiveSetByContent")=="false" && PF_attr(oActivite,"affecteEtatSucces")==""){var objectifC=donneObjectifCible(oActivite,false);if (objectifC!=null){if (lireEtatObjectif(objectifC,"objectiveProgressStatus")=="false"){if (attrObj(objectifC,"satisfiedByMeasure")=="false"){if (PF_attr(objectifC,"affecteInconnu")==""){enregistrerObjectif(objectifC,"objectiveSatisfiedStatus","true",false);}}}if (!MODE_PREEMPTIF){objectifC.removeAttribute("affecteInconnu");}}}if (!MODE_PREEMPTIF){nettoyerDejaFait(oActivite);}}if (!MODE_PREEMPTIF){affecteDateDocumentFin(oActivite);}}} else {var tabFils=donneLesFils(oActivite,"item");var enSuspend=false;for (var j=0;j<tabFils.length;j++){if (estSuspendue(tabFils[j])){enSuspend=true;break;}}if (enSuspend){oActivite.setAttribute("activityIsSuspended","true");affecteActiviteSuspendue(oActivite);} else {oActivite.removeAttribute("activityIsSuspended");}if (!MODE_PREEMPTIF && !SUIVI_DESACTIVE){durationRollup(oActivite);}}desactiveActivite(oActivite);if (SUIVI_DESACTIVE){return ;}if (!MODE_PREEMPTIF){randomizeChildren(oActivite);}if (PF_attr(activiteRacine,"listeRemonte")!="" && !SANS_REMONTE){var listeRemonte=PF_attr(activiteRacine,"listeRemonte");activiteRacine.removeAttribute("listeRemonte");boucleMultiRollup(oActivite,listeRemonte);}if (tabDejaFaitRollup==null || !tabContient(tabDejaFaitRollup,oActivite.getAttribute("identifier"))){overallRollup(oActivite);}}function boucleMultiRollup(oActivite,listeRemonte){tabRemonter=listeRemonte.substring(3).split("[,]");if (!MODE_PREEMPTIF && tabRemonter.length==0){alert("Multiple Rollup Error");}tabRemonter.sort();var maxr=0;while (tabRemonter.length>0 && maxr<99){var indDer=tabRemonter.length-1;if (tabRemonter[indDer]!=""){var idSui=tabRemonter[indDer].substring(4);if (tabDejaFaitRollup==null || !tabContient(tabDejaFaitRollup,idSui)){var act=parent.XML_trouveNoeud(activiteRacine,"item","identifier",idSui);if (act){overallRollup(act);}}}tabRemonter.splice(indDer,1);maxr++;}}function compteProfondeur(oItem){var num=1;while (oItem!=null && !estRacine(oItem)){oItem=oItem.parentNode;num++;}var str=num+"";if (num<10){str="00"+num;}else if (num<100){str="0"+num;}return str;}function checkActivity(oActivite){if (SUIVI_DESACTIVE){return false;}if (sequencingRulesCheck(oActivite,"disabled")!="nil"){return true;}if (limitConditionsCheck(oActivite)){return true;}if (COMPATIBLE_SCORM12&&parent.blocagePrerequis(oActivite)){return true;}return false;}function donneException(c){var r="";if(c=="NB.2.1-1"){r="Current Activity is already defined / Sequencing session has already begun";}if(c=="NB.2.1-2"){r="Current Activity is not defined / Sequencing session has not begun";}if(c=="NB.2.1-3"){r="Suspended Activity is not defined";}if(c=="NB.2.1-4"){r="Flow Sequencing Control Mode violation";}if(c=="NB.2.1-5"){r="Flow or Forward Only Sequencing Control Mode violation";}if(c=="NB.2.1-6"){r="No activity is previous to the root";}if(c=="NB.2.1-7"){r="Unsupported navigation request";}if(c=="NB.2.1-8"){r="Choice Exit Sequencing Control Mode violation";}if(c=="NB.2.1-9"){r="No activities to consider";}if(c=="NB.2.1-10"){r="Choice Sequencing Control Mode violation";}if(c=="NB.2.1-11"){r="Target activity does not exist";}if(c=="NB.2.1-12"){r="Current Activity already terminated";}if(c=="NB.2.1-13"){r="Undefined navigation request";}if(c=="TB.2.3-1"){r="Current Activity is not defined / Sequencing session has not begun";}if(c=="TB.2.3-2"){r="Current Activity already terminated";}if(c=="TB.2.3-3"){r="Cannot suspend an inactive root";}if(c=="TB.2.3-4"){r="Activity tree root has no parent";}if(c=="TB.2.3-5"){r="Nothing to suspend; No active activities";}if(c=="TB.2.3-6"){r="Nothing to abandon; No active activities";}if(c=="TB.2.3-7"){r="Undefined termination request";}if(c=="SB.2.1-1"){r="Last activity in the tree";}if(c=="SB.2.1-2"){r="Cluster has no available children";}if(c=="SB.2.1-3"){r="No activity is previous to the root";}if(c=="SB.2.1-4"){r="Forward Only Sequencing Control Mode violation";}if(c=="SB.2.2-1"){r="Flow Sequencing Control Mode violation";}if(c=="SB.2.2-2"){r="Activity unavailable";}if(c=="SB.2.4-1"){r="Forward Traversal Blocked";}if(c=="SB.2.4-2"){r="Forward Only Sequencing Control Mode violation";}if(c=="SB.2.4-3"){r="No activity is previous to the root";}if(c=="SB.2.5-1"){r="Current Activity is defined / Sequencing session already begun";}if(c=="SB.2.6-1"){r="Current Activity is defined / Sequencing session already begun";}if(c=="SB.2.6-2"){r="No Suspended Activity defined";}if(c=="SB.2.7-1"){r="Current Activity is not defined / Sequencing session has not begun";}if(c=="SB.2.7-2"){r="Flow Sequencing Control Mode violation";}if(c=="SB.2.8-1"){r="Current Activity is not defined / Sequencing session has not begun";}if(c=="SB.2.8-2"){r="Flow Sequencing Control Mode violation";}if(c=="SB.2.9-1"){r="No target for Choice";}if(c=="SB.2.9-2"){r="Target activity does not exist or is unavailable";}if(c=="SB.2.9.3"){r="Target activity hidden from choice";}if(c=="SB.2.9-4"){r="Choice Sequencing Control Mode violation";}if(c=="SB.2.9-5"){r="No activities to consider";}if(c=="SB.2.9-6"){r="Unable to activate target; target is not a child of the Current Activity";}if(c=="SB.2.9-7"){r="Choice Exit Sequencing Control Mode violation";}if(c=="SB.2.9-8"){r="Unable to choice target activity  constrained choice";}if(c=="SB.2.9-9"){r="Choice request prevented by Flow-only activity";}if(c=="SB.2.10-1"){r="Current Activity is not defined / Sequencing session has not begun";}if(c=="SB.2.10-2"){r="Current Activity is active or suspended";}if(c=="SB.2.10-3"){r="Flow Sequencing Control Mode violation";}if(c=="SB.2.11-1"){r="Current Activity is not defined / Sequencing session has not begun 50";}if(c=="SB.2.11-2"){r="Current Activity has not been terminated";}if(c=="SB.2.12-1"){r="Undefined sequencing request";}if(c=="SB.2.13-1"){r="Current Activity is not defined / Sequencing session has not begun";}if(c=="DB.1.1-1"){r="Cannot deliver a non-leaf activity 53";}if(c=="DB.1.1-2"){r="Nothing to deliver";}if(c=="DB.1.1-3"){r="Activity unavailable";}if(c=="DB.2-1"){r="Identified activity is already active";}return r+"\n"+c;}function affecteActiviteCourante(oAct){activiteCourante=oAct;if (!MODE_PREEMPTIF){itemCourant=activiteCourante;}}function affecteActiviteSuspendue(oAct){activiteSuspendue=oAct;if (!MODE_PREEMPTIF){itemSuspendu=oAct;if (estFeuille(activiteSuspendue)){itemRacine.setAttribute("activiteSuspendue",activiteSuspendue.getAttribute("identifier"));}}}function initialiserTentative(oAct){if (SUIVI_DESACTIVE){return ;}var initActiviteAcheve=true;if (FIGER_ETAT_ITEM && PF_attr(oAct,"attemptCompletionStatus")=="true"){initActiviteAcheve=false;}if (initActiviteAcheve){oAct.removeAttribute("attemptProgressStatus");oAct.removeAttribute("attemptCompletionStatus");oAct.removeAttribute("attemptCompletionAmount");}oAct.setAttribute("infoProgCourant","true");var tempSess=PF_attr(oAct,"attemptAbsoluteDuration");if (tempSess!=""){oAct.setAttribute("activityAbsoluteDuration",parent.ajouterIntervalle(tempSess,PF_attr(oAct,"activityAbsoluteDuration")));oAct.removeAttribute("attemptAbsoluteDuration");}if (!OBJ_GLOBAL_SYSTEM && estRacine(oAct) && oAct.getAttribute("attemptCount")!="1" && !FIGER_ETAT_ITEM){while (objGlobauxCourant.firstChild){objGlobauxCourant.removeChild(objGlobauxCourant.firstChild);}}if (PF_attr(itemRacine,"adlcp:sharedDataGlobalToSystem")=="false" && estRacine(oAct) && oAct.getAttribute("attemptCount")!="1"){for (var i=0;i<allocationsGlobales.length;i++){var oAl=allocationsGlobales[i];if (parent.XML_texteNoeud(oAl)!=""){parent.XML_modifTexteNoeud(oAl,"");oAl.setAttribute("modif","oui");persisteSSP=true;}}var lesvarx=donneNoeudsNS(itemRacine,"adcp","map");for (var i=0;i<lesvarx.length;i++){var idv=PF_attr(lesvarx[i],"targetID");var oExiste=parent.XML_trouveNoeud(allocationsGlobales,"allocation","id",idv);if (oExiste==null){var oN=parent.creerElementCP(DOMManifest,"allocation");oN.setAttribute("id",idv);oN.setAttribute("persistence","course");oN.setAttribute("requested","64000");oN.setAttribute("modif","oui");allocationsGlobales.appendChild(oN);}}}var lesobjs=donneObjectifs(oAct,false);for (var i=0;i<lesobjs.length;i++){var oObj=lesobjs[i];if (initActiviteAcheve || oObj.nodeName.indexOf("primaryObjective")<0){oObj.removeAttribute("objectiveProgressStatus");oObj.removeAttribute("objectiveSatisfiedStatus");oObj.removeAttribute("objectiveMeasureStatus");oObj.removeAttribute("objectiveNormalizedMeasure");oObj.setAttribute("infoObjCourant","true");if (OBJECTIFS_ADLSEQ){oObj.removeAttribute("attemptProgressMeasure");oObj.removeAttribute("attemptProgressMeasureStatus");oObj.removeAttribute("attemptCompletionStatus");oObj.removeAttribute("attemptProgressStatus");oObj.removeAttribute("attemptRawScore");oObj.removeAttribute("attemptMaxScore");oObj.removeAttribute("attemptMinScore");}}if (initActiviteAcheve){var tabFils=donneLesFils(oAct,"item");for (var n=0;n<tabFils.length;n++){tabFils[n].removeAttribute("infoProgCourant");var lesobjs=donneObjectifs(tabFils[n],false);if (lesobjs!=null){for (var i=0;i<lesobjs.length;i++){lesobjs[i].removeAttribute("infoObjCourant");}}}}}}function estRacine(oAct){return (oAct.nodeName=="organization");}function enregistrerEtatObjectif(objectif,nomAttr,valAttr){var activiteAncetre=objectif.parentNode.parentNode.parentNode;if (deliveryControls(activiteAncetre,"tracked")=="true"){objectif.setAttribute(nomAttr,valAttr);objectif.setAttribute("infoObjCourant","true");if (!MODE_PREEMPTIF && valAttr=="false" && estRacine(activiteAncetre)){var racmn=DOMManifest.documentElement;if (nomAttr=="objectiveProgressStatus" && PF_attr(racmn,"etatValidation")=="true"){racmn.setAttribute("etatValidation","");modifEtatMembre=true;}if (nomAttr=="objectiveMeasureStatus" && PF_attr(racmn,"etatScore")=="true"){racmn.setAttribute("etatScore","false");racmn.removeAttribute("score");modifEtatMembre=true;}}if (!MODE_PREEMPTIF && nomAttr=="objectiveProgressStatus" && valAttr=="false"){var lesmaps=parent.XML_tabElementFils(objectif);for (var i=0;i<lesmaps.length;i++){var oFils=lesmaps[i];if (oFils.nodeName.indexOf("mapInfo")>=0){if (PF_attr(oFils,"writeSatisfiedStatus")=="true"){var lid=PF_attr(oFils,"targetObjectiveID");var objG=donneObjectifGlobal(lid,false,false);if (objG!=null){objG.setAttribute(nomAttr,valAttr);objG.removeAttribute("objectiveSatisfiedStatus");parent.parcoursEnregistre=false;objG.setAttribute("modification","true");}break;}}}}}}function enregistrerObjectif(objectif,nomAttr,valAttr,aAppliquer){var activiteAncetre=objectif.parentNode.parentNode.parentNode;if (deliveryControls(activiteAncetre,"tracked")=="false"){return false;}if (!MODE_PREEMPTIF && objectif==null){alert("Can't write objective (null)");return res;}if (FIGER_MEILLEUR_RESULTAT){if (nomAttr=="objectiveMeasureStatus" && PF_attr(objectif,nomAttr)=="true" && valAttr!="true"){return;}if (nomAttr=="objectiveNormalizedMeasure" && PF_attr(objectif,nomAttr)!=""){var vscoreanc=Number(PF_attr(objectif,nomAttr));if (vscoreanc>Number(valAttr)){return;}}}var vStatut="objectiveProgressStatus";if (nomAttr=="objectiveNormalizedMeasure" || nomAttr=="objectiveMeasureStatus"){vStatut="objectiveMeasureStatus";}objectif.setAttribute(vStatut,"true");if (!MODE_PREEMPTIF && valAttr!=PF_attr(objectif,nomAttr)){parent.parcoursEnregistre=false;}objectif.setAttribute(nomAttr,valAttr);if (SUIVI_DESACTIVE){return ;}objectif.setAttribute("infoObjCourant","true");if (!MODE_PREEMPTIF && nomAttr=="objectiveSatisfiedStatus" && valAttr=="true" && PF_attr(activiteAncetre,"dateValidation")==""){activiteAncetre.setAttribute("dateValidation",parent.getDateServeur(''));}if (!MODE_PREEMPTIF && estRacine(activiteAncetre)){var racmn=DOMManifest.documentElement;if (nomAttr=="objectiveSatisfiedStatus"){if (PF_attr(racmn,"evtValidation")!=valAttr){modifEtatMembre=true;}if (valAttr=="true" && PF_attr(racmn,"dateValidation")==""){racmn.setAttribute("dateValidation",parent.getDateServeur(''));racmn.setAttribute("evtValidation","true");}racmn.setAttribute("etatValidation",valAttr);if (valAttr=="true" && parent.lesson_mode=="normal"){if (modeExploration=="valide"){FIGER_ETAT_ITEM=true;}}}if (nomAttr=="objectiveNormalizedMeasure"){var anscore=PF_attr(racmn,"score");if (anscore!=valAttr && (valAttr==""||anscore==""||Number(anscore)!=Number(valAttr))){modifEtatMembre=true;}racmn.setAttribute("etatScore","true");racmn.setAttribute("score",valAttr);}}var lesmaps=parent.XML_tabElementFils(objectif);var typeEnr="";if (lesmaps.length>0){typeEnr=nomAttr.replace(/objective/,"write");}for (var i=0;i<lesmaps.length;i++){var oFils=lesmaps[i];if (oFils.nodeName.indexOf("mapInfo")>=0){if (PF_attr(oFils,typeEnr)=="true"){var lid=PF_attr(oFils,"targetObjectiveID");var objG=donneObjectifGlobal(lid,true,aAppliquer);var etatModif=false;if (PF_attr(objG,vStatut)!="true"){objG.setAttribute(vStatut,"true");etatModif=true;}if (!etatModif && PF_attr(objG,nomAttr)!=valAttr){etatModif=true;}if (FIGER_MEILLEUR_RESULTAT){if (nomAttr=="objectiveMeasureStatus" && PF_attr(objG,nomAttr)=="true" && valAttr!="true"){return;}if (nomAttr=="objectiveNormalizedMeasure" && PF_attr(objG,nomAttr)!=""){var vscoreanc=Number(PF_attr(objG,nomAttr));if (vscoreanc>Number(valAttr)){return;}}}objG.setAttribute(nomAttr,valAttr);if (etatModif){if (!MODE_PREEMPTIF || aAppliquer){parent.parcoursEnregistre=false;objG.setAttribute("modification","true");if (nomAttr=="objectiveSatisfiedStatus" && valAttr=="true"){objG.setAttribute("validation","true");objG.setAttribute("dateValidation",parent.getDateServeur(""));}}}if (MODE_PREEMPTIF && SANS_REMONTE){return ;}var lesautremaps=donneNoeudsNS(activiteRacine,"imsss","mapInfo");var typeLire=typeEnr.replace("write","read");for (var m=0;m<lesautremaps.length;m++){var oMap=lesautremaps[m];if (PF_attr(oMap,"targetObjectiveID")==lid && PF_attr(oMap,typeLire)!="false"){var actiAnce=oMap.parentNode.parentNode.parentNode.parentNode;var lidan=actiAnce.getAttribute("identifier");if (activiteAncetre.getAttribute("identifier")!=lidan){var objectifDistant=oMap.parentNode;objectifDistant.setAttribute(vStatut,"false");if (!estFrere(activiteAncetre,actiAnce)){var listeRemonte=PF_attr(activiteRacine,"listeRemonte");if (listeRemonte==""){listeRemonte="[,]";}var tAjr="_"+lidan+"[,]";if (listeRemonte.indexOf(tAjr)<0){listeRemonte+=compteProfondeur(actiAnce)+tAjr;tAjr="_"+activiteAncetre.getAttribute("identifier")+"[,]";if (listeRemonte.indexOf(tAjr)<0){listeRemonte+=compteProfondeur(activiteAncetre)+tAjr;}activiteRacine.setAttribute("listeRemonte",listeRemonte);}}ajouteItemTestPlan(actiAnce);if (MODE_PREEMPTIF){actiAnce=donneActivite(lidan);actiAnce.removeAttribute("planDejaFait");}}}}break;}}}if (nomAttr=="objectiveNormalizedMeasure" && attrObj(objectif,"satisfiedByMeasure")=="true"){var resEvMe=evaluerSeuilMesureSatisfaction(objectif,false);if (resEvMe!="unknown" && (PF_attr(objectif,"objectiveProgressStatus")=="false" || resEvMe!=PF_attr(objectif,"objectiveProgressStatus"))){enregistrerObjectif(objectif,"objectiveSatisfiedStatus",resEvMe,false);}}if (OBJ_GLOBAL_SYSTEM && parent.SUR_CHORUS && parent.donneParam("sync")=="3"){return parent.parent.postMessage("setOnlineGlobalObjective","*");}}function lireEtatObjectif(objectif,vStatut){var res="false";if (!MODE_PREEMPTIF && objectif==null){alert("Can't read objective ("+vStatut+")");return res;}var activiteAnc=objectif.parentNode.parentNode.parentNode;if (deliveryControls(activiteAnc,"tracked")=="false" && !scoDemandeEtatObjectif){return "false";}if (vStatut=="objectiveProgressStatus" && attrObj(objectif,"satisfiedByMeasure")=="true"){if (lireEtatObjectif(objectif,"objectiveMeasureStatus")=="true"){if (evaluerSeuilMesureSatisfaction(objectif,true)!="unknown"){return "true";}}return "false";}var typeEnr="readSatisfiedStatus";if (vStatut=="objectiveMeasureStatus"){typeEnr="readNormalizedMeasure";}var lesmaps=parent.XML_tabElementFils(objectif);for (var i=0;i<lesmaps.length;i++){var oFils=lesmaps[i];if (oFils.nodeName.indexOf("mapInfo")>=0){if (PF_attr(oFils,typeEnr)!="false"){if (vaRecommencerRacine){return "false";}var objG=donneObjectifGlobal(PF_attr(oFils,"targetObjectiveID"),false,false);if (objG!=null){return attrObj(objG,vStatut);}return "false";}}}if (ROLLUP_SUR_COURANT && PF_attr(objectif,"infoObjCourant")!="true"){if (estRacine(activiteAnc) || controlMode(activiteAnc.parentNode,"useCurrentAttemptObjectiveInfo")=="true"){return "false";}}return attrObj(objectif,vStatut);}function lireValeurObjectif(objectif,nomAttr){var res="false";var vStatut="objectiveProgressStatus";var typeEnr="readSatisfiedStatus";if (nomAttr=="objectiveNormalizedMeasure"){vStatut="objectiveMeasureStatus";typeEnr="readNormalizedMeasure";res="0.0";}if (nomAttr=="objectiveSatisfiedStatus" && attrObj(objectif,"satisfiedByMeasure")=="true"){if (lireEtatObjectif(objectif,"objectiveMeasureStatus")=="true"){return evaluerSeuilMesureSatisfaction(objectif,true);}return "false";}var lesmaps=parent.XML_tabElementFils(objectif);for (var i=0;i<lesmaps.length;i++){var oFils=lesmaps[i];if (oFils.nodeName.indexOf("mapInfo")>=0){if (PF_attr(oFils,typeEnr)!="false"){var objG=donneObjectifGlobal(PF_attr(oFils,"targetObjectiveID"),false,false);if (objG!=null){if (attrObj(objG,vStatut)=="true"){return attrObj(objG,nomAttr);}}return "err";}}}if (attrObj(objectif,vStatut)=="true"){res=attrObj(objectif,nomAttr);}return res;}function donneObjectifGlobal(idGlob,ecrit,objreel){if (idGlob==""){alert("Empty targetObjectiveID");return null;}var objs=objGlobauxCourant;if (MODE_PREEMPTIF && !objreel){objs=objGlobauxPremptif;}var oObj=parent.XML_trouveNoeud(objs,"objectif","id",idGlob);if (oObj==null &&ecrit){oObj=parent.creerElementCP(itemRacine,"objectif");oObj.setAttribute("id",idGlob);objs.appendChild(oObj);}return oObj;}function calculeDateDocument(date0){var temps1 = new Date().getTime();var indexD=0;var annee=date0.substring(indexD,indexD+4);indexD=5;var mois=date0.substring(indexD,indexD+2);indexD=8;var jour=date0.substring(indexD,indexD+2);var dateS=new Date();dateS.setUTCFullYear(Number(annee),Number(mois)-1,Number(jour));var res;if (date0.indexOf(":")>0){indexD=11;dateS.setUTCHours(Number(date0.substring(indexD,indexD+2)),Number(date0.substring(indexD+3,indexD+5)),Number(date0.substring(indexD+6,indexD+8)));}var elapsedSeconds = parseInt(((temps1 - dateS)/1000));return formaterSecondes(elapsedSeconds);}function formaterSecondes(ts){ var sec = (ts % 60); ts -= sec; var tmp = (ts % 3600); ts -= tmp; sec = Math.round(sec); var hour,min; if ((ts % 3600) != 0 ) hour = 0; else hour = (ts / 3600); if ( (tmp % 60) != 0 ) min = 0; else min = (tmp / 60); return intervalleTemps(hour,min,sec);}function intervalleTemps(strHour, strMin, strSec){var strTime = "P";var intHour= parseInt(strHour,10);var intMin= parseInt(strMin,10);var intSec= parseInt(strSec,10); if (intHour>0 || intMin>0 || intSec>0){ strTime += "T"; if (intHour>0)strTime += intHour + "H"; if (intMin>0)strTime += intMin + "M"; if (intSec>0){strTime += ( intSec + "S");}} if (strTime == "P") strTime = "PT0H0M0S"; return strTime;}function enregistrerCompletion(oActivite,val){if (deliveryControls(oActivite,"tracked")=="true"){var ancienEtat=oActivite.getAttribute("attemptCompletionStatus");oActivite.setAttribute("attemptProgressStatus","true");oActivite.setAttribute("activityProgressStatus","true");if (FIGER_ETAT_ITEM && ancienEtat=="true"){return;}var res="false";if (val){res="true";}oActivite.setAttribute("attemptCompletionStatus",res);if (!MODE_PREEMPTIF && ancienEtat!=res){var itemCSS=PF_donneObjet('lienP'+PF_attr(oActivite,"nom"));if (itemCSS){var classd="";if (itemCSS.className.indexOf("Desactive")>0){classd="Desactive";}var etatAcheve="";if (val){etatAcheve="Complete";}changeClassMenuMarque(itemCSS,classd,etatAcheve);}if (res=="true" && PF_attr(oActivite,"dateCompletion")==""){oActivite.setAttribute("dateCompletion",parent.getDateServeur(''));}}if (PF_attr(oActivite,"affecteEtatCompletionObj")==""){appliqueValeurAdlObj("attemptCompletionStatus",res,oActivite,null);}}}function initCompletion(oActivite){if (deliveryControls(oActivite,"tracked")=="true" && !FIGER_ETAT_ITEM){var etat=oActivite.getAttribute("attemptProgressStatus");if (etat=="true"){if (!MODE_PREEMPTIF){oActivite.setAttribute("ancienEtatCompl",PF_attr(oActivite,"attemptCompletionStatus"));}oActivite.removeAttribute("attemptCompletionStatus");/*if (!MODE_PREEMPTIF){parent.parcoursEnregistre=false;}*/}}}function estNoeudDiff(o1,o2){return (PF_attr(o1,"identifier")!=PF_attr(o2,"identifier"));}function formerCheminAct(oDepart,inclureDepart,oArrive,inclureArrivee){var tabCheminActivites=new Array();if (inclureDepart){tabCheminActivites.push(oDepart);}if (!estRacine(oDepart)){var oDansChem=oDepart.parentNode;while (oDansChem!=null && estNoeudDiff(oDansChem,oArrive)){tabCheminActivites.push(oDansChem);if (estRacine(oDansChem)){oDansChem=null;}else{oDansChem=oDansChem.parentNode;}}}if (inclureArrivee && (!inclureDepart || oDepart!=oArrive)){tabCheminActivites.push(oArrive);}return tabCheminActivites;}function ajouteElementSeq(obj,nom){var oDoc=obj.ownerDocument;var oN=null;if (oDoc.createElementNS){if (oDoc.selectNodes){oN=oDoc.createElementNS("http://www.imsglobal.org/xsd/imsss",nom);} else {oN=oDoc.createElement("imsss:"+nom);}} else {if (progIDMSXML=="Msxml2.DOMDocument.3.0"){oN=oDoc.createElement("imsss:"+nom);} else {oN=oDoc.createNode(1,nom,"http://www.imsglobal.org/xsd/imsss");}}obj.appendChild(oN);return oN;}function desactiveActivite(oAct){oAct.removeAttribute("activityIsActive");}function peutMesurerSatisfaction(oAct){ return (!estActive(oAct) || rollupConsiderations(oAct,"measureSatisfactionIfActive")=="true");}function cacherItemSelonRegle(oItem,vDis){if (TEST_AFF_PARC){if (PF_attr(oItem,"isvisible")!="false"|| !estFeuille(oItem)){if (parent.haut.planEnLigne){var oDansPlan=parent.haut.PF_donneObjet("lienNiv"+PF_attr(oItem,"nom"));if (oDansPlan!=null && vDis!=oDansPlan.style.display){oDansPlan.style.display=vDis;if (vDis=="none"){for (var g=0;g<oItem.childNodes.length;g++){var leFils=oItem.childNodes[g];if (leFils.nodeName=="item"){oDansPlan=parent.haut.PF_donneObjet("lienNiv"+PF_attr(leFils,"nom"));if (oDansPlan!=null){oDansPlan.style.display=vDis;}}}}}} else {if (PF_attr(oItem,"isvisible")=="false"){var oDansPlan=PF_donneObjet("divfils"+PF_attr(oItem,"nom"));if (oDansPlan!=null){oDansPlan.style.display=vDis;}} else {var oDansPlan=PF_donneObjet("div"+PF_attr(oItem,"nom"));if (oDansPlan!=null && vDis!=oDansPlan.style.display){oDansPlan.style.display=vDis;if (vDis=="none"){oDansPlan=PF_donneObjet("divfils"+PF_attr(oItem,"nom"));if (oDansPlan!=null){oDansPlan.style.display=vDis;}}}}}}}}function estDerniereActiviteDuFlux(oActivite){if (estFeuille(oActivite) && estDerniereActivite(oActivite) && controlMode(oActivite.parentNode,"flow")=="true"){var oTemp=oActivite;while (oTemp!=null && !estRacine(oTemp)){oTemp=oTemp.parentNode;if (controlMode(oTemp,"flow")=="false"){return true;}var oSuiv=oTemp.nextSibling;if (oSuiv!=null && oSuiv.nodeName=="item" &&!estFeuille(oSuiv)){if (controlMode(oSuiv,"flow")=="false"){return true;}}}}return false;}function affecteDateDocumentFin(oActivite){var dateDc=PF_attr(oActivite,"dateAfficheDoc");if (dateDc!=""){oActivite.removeAttribute("dateAfficheDoc");oActivite.setAttribute("attemptAbsoluteDuration",calculeDateDocument(dateDc));oActivite.setAttribute("dateRemonte",parent.getDateServeur('milli'));parcoursEnregistre=false;}}function donneObjectifADL(oActivite,objectif){if (objectif==null){objectif=donneObjectifCible(oActivite,false);}if (objectif==null){return null;}var idObj=PF_attr(objectif,"objectiveID");if (idObj==""){return null;}var objsSeq=parent.XML_filsNS(oActivite,"imsss","sequencing");if (objsSeq==null){return null;}var objAdl=parent.XML_filsNS(objsSeq,"adlseq","objectives");if (objAdl==null){return null;}return parent.XML_trouveNoeudNS(objAdl,"adlseq","objective","objectiveID",idObj);}function peutLireValeurAdlObj(nomAttr,oActivite,objectif){if (!OBJECTIFS_ADLSEQ){return false;}var objAdl=donneObjectifADL(oActivite,objectif);if (objAdl==null){return false;}var typeEnr=nomAttr.replace("attempt","read");var vStatut="";if (nomAttr=="attemptCompletionStatus"){vStatut="attemptProgressStatus";}if (nomAttr=="attemptProgressMeasure"){vStatut="attemptProgressMeasureStatus";}var lesmaps=parent.XML_tabElementFils(objAdl);for (var i=0;i<lesmaps.length;i++){var oFils=lesmaps[i];if (oFils.nodeName.indexOf("mapInfo")>=0){if (PF_attr(oFils,typeEnr)!="false"){var lid=PF_attr(oFils,"targetObjectiveID");var objG=donneObjectifGlobal(lid,false,false);if (objG!=null){if (vStatut!=""){return (PF_attr(objG,vStatut)=="true");} else {return (PF_attr(objG,nomAttr)!="")}} else {return false;}}}}if (objectif==null){objectif=donneObjectifCible(oActivite,false);}if (vStatut!=""){return PF_attr(objectif,vStatut)=="true";}return PF_attr(objectif,nomAttr)!="";}function lireValeurAdlObj(nomAttr,oActivite,objectif){if (!OBJECTIFS_ADLSEQ){return "";}var objAdl=donneObjectifADL(oActivite,objectif);if (objAdl==null){return "";}var typeEnr=nomAttr.replace("attempt","read");var lesmaps=parent.XML_tabElementFils(objAdl);for (var i=0;i<lesmaps.length;i++){var oFils=lesmaps[i];if (oFils.nodeName.indexOf("mapInfo")>=0){if (PF_attr(oFils,typeEnr)!="false"){var lid=PF_attr(oFils,"targetObjectiveID");var objG=donneObjectifGlobal(lid,false,false);if (objG!=null){if (nomAttr=="attemptCompletionStatus"){cmiCompletionStatus=PF_attr(objG,"cmiCompletionStatus");}return PF_attr(objG,nomAttr);}return "";}}}if (objectif==null){objectif=donneObjectifCible(oActivite,false);}return PF_attr(objectif,nomAttr);}function appliqueValeurAdlObj(nomAttr,valAttr,oActivite,objectif){etatAppliqueValeurAdlObj=false;if (!OBJECTIFS_ADLSEQ || deliveryControls(oActivite,"tracked")=="false"){return;}var depuisObjPrim=false;var valOriginale=valAttr;if (objectif!=null && objectif.nodeName.indexOf("primaryObjective")>=0){depuisObjPrim=true;}if (objectif==null){objectif=donneObjectifCible(oActivite,false);}var objAdl=donneObjectifADL(oActivite,objectif);if (objAdl==null){return;}var typeEnr=nomAttr.replace("attempt","write");var vStatut="";var desactiveEtatAcheve=false;var nomCMI="";if (nomAttr=="attemptCompletionStatus"){vStatut="attemptProgressStatus";nomCMI="completion_status";if (valAttr=="completed"){valAttr="true";}else if (valAttr=="not attempted"||valAttr=="incomplete"){valAttr="false";}else if (valAttr=="unknown"||valAttr==""){desactiveEtatAcheve=true;valAttr="false";}if (objectif.nodeName.indexOf("primaryObjective")>=0){oActivite.setAttribute("affecteEtatCompletionObj",valAttr);}}if (nomAttr=="attemptProgressMeasure"){vStatut="attemptProgressMeasureStatus";nomCMI="progress_measure";}objectif.setAttribute(nomAttr,valAttr);if (vStatut!=""){objectif.setAttribute(vStatut,"true");}if (desactiveEtatAcheve){objectif.setAttribute(vStatut,"false");}var lesmaps=parent.XML_tabElementFils(objAdl);for (var i=0;i<lesmaps.length;i++){var oFils=lesmaps[i];if (oFils.nodeName.indexOf("mapInfo")>=0){if (PF_attr(oFils,typeEnr)=="true"){var lid=PF_attr(oFils,"targetObjectiveID");var objG=donneObjectifGlobal(lid,true,true);var etatModif=false;if (desactiveEtatAcheve){if (PF_attr(objG,vStatut)!="false"){objG.setAttribute(vStatut,"false");etatModif=true;}} else {if (vStatut!="" && PF_attr(objG,vStatut)!="true"){objG.setAttribute(vStatut,"true");etatModif=true;}}if (!etatModif && PF_attr(objG,nomAttr)!=valAttr){etatModif=true;}objG.setAttribute(nomAttr,valAttr);etatAppliqueValeurAdlObj=true;if (valOriginale=="not attempted"||valOriginale=="incomplete"){objG.setAttribute("cmiCompletionStatus",valOriginale);} else {objG.removeAttribute("cmiCompletionStatus");}if (etatModif && !MODE_PREEMPTIF){/*if (depuisObjPrim && nomCMI!=""){var retourSet=parent.API_1484_11.SetValue("cmi."+nomCMI,valOriginale);}*/parent.parcoursEnregistre=false;objG.setAttribute("modification","true");}if (MODE_PREEMPTIF && SANS_REMONTE){return ;}var lesautremaps=donneNoeudsNS(activiteRacine,"adlseq","mapInfo");var typeLire=typeEnr.replace("write","read");for (var m=0;m<lesautremaps.length;m++){var oMap=lesautremaps[m];if (PF_attr(oMap,"targetObjectiveID")==lid && PF_attr(oMap,typeLire)!="false"){var actiAnce=oMap.parentNode.parentNode.parentNode.parentNode;var lidan=actiAnce.getAttribute("identifier");if (oActivite.getAttribute("identifier")!=lidan){var objectifDistant=oMap.parentNode;if (vStatut!=""){objectifDistant.setAttribute(vStatut,"false");} else {objectifDistant.removeAttribute(nomAttr);}if (!estFrere(oActivite,actiAnce)){var listeRemonte=PF_attr(activiteRacine,"listeRemonte");if (listeRemonte==""){listeRemonte="[,]";}var tAjr="_"+lidan+"[,]";if (listeRemonte.indexOf(tAjr)<0){listeRemonte+=compteProfondeur(actiAnce)+tAjr;tAjr="_"+oActivite.getAttribute("identifier")+"[,]";if (listeRemonte.indexOf(tAjr)<0){listeRemonte+=compteProfondeur(oActivite)+tAjr;}activiteRacine.setAttribute("listeRemonte",listeRemonte);}}ajouteItemTestPlan(actiAnce);if (MODE_PREEMPTIF){actiAnce=donneActivite(lidan);actiAnce.removeAttribute("planDejaFait");}}}}break;}}}}
