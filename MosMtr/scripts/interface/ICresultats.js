var RES_valide;var pageSynthese=false;var ignorerEvalSiNonParcourue=true;var existePoidsRemonte=false;var oEval=parent.oSco.evaluation;var syntheseAvecPoids=false;var RES_lienQuestionsNonRepondues=false;var oHtml=document.getElementsByTagName("html")[0];if (parent.defilContenu){oHtml.style.overflow="auto";} else {oHtml.style.overflowY="hidden";oHtml.style.overflowX="hidden";}if (oEval.questions.length==0){if (parent.SCO_compteCMI("cmi.objectives")>1){var calculSurEtatEval=false;if (parent.oSco.scoreBinaire){calculSurEtatEval=true;}if (parent.oSco.forcerReponse){ignorerEvalSiNonParcourue=false;}pageSynthese=true;var scoreAtteint=0;var scoreTotal=0;var precedentPoids=-1;for (var i=1;i<parent.SCO_compteCMI("cmi.objectives");i++){var objCh="cmi.objectives."+i+".";var letat=parent.APIgetValue(objCh+"success_status");if (!ignorerEvalSiNonParcourue || letat!="unknown"){if (!calculSurEtatEval){var poidsO=donnePoidsObjectif(parent.APIgetValue(objCh+"id"));if (precedentPoids>0 && poidsO!=precedentPoids){syntheseAvecPoids=true;}precedentPoids=poidsO;}}}for (var i=1;i<parent.SCO_compteCMI("cmi.objectives");i++){var objCh="cmi.objectives."+i+".";var letat=parent.APIgetValue(objCh+"success_status");if (!ignorerEvalSiNonParcourue || letat!="unknown"){var poidsO=1;if (calculSurEtatEval){scoreTotal+=poidsO;if (letat=="passed"){scoreAtteint+=1;}} else {if (syntheseAvecPoids){poidsO=donnePoidsObjectif(parent.APIgetValue(objCh+"id"));}scoreTotal+=poidsO;var lscore=parent.APIgetValue(objCh+"score.scaled");if (lscore!="" && letat!="unknown"){scoreAtteint+=Number(lscore)*poidsO;}}}}oEval.scoreAtteint=0;oEval.pourcentageAtteint=0;if (scoreTotal>0){if (calculSurEtatEval){oEval.scoreAtteint=scoreAtteint;oEval.scoreTotal=scoreTotal;oEval.pourcentageAtteint=Math.floor(scoreAtteint/scoreTotal*1000)/10;} else {oEval.pourcentageAtteint=Math.floor(scoreAtteint/scoreTotal*10000)/100;oEval.scoreAtteint=oEval.pourcentageAtteint;oEval.scoreTotal=100;}if (oEval.pourcentageAtteint>=oEval.pourcentageRequis){oEval.valide=true;parent.APIsetValue("cmi.success_status","passed");} else {parent.APIsetValue("cmi.success_status","failed");}var score_scaled=oEval.pourcentageAtteint/100;parent.APIsetValue("cmi.score.scaled",score_scaled);parent.APIsetValue("cmi.score.raw",oEval.scoreAtteint);parent.APIsetValue("cmi.score.max",oEval.scoreTotal);parent.APIcommit();if (!calculSurEtatEval){oEval.pourcentageAtteint=Math.floor(oEval.pourcentageAtteint*10)/10;oEval.scoreAtteint=oEval.pourcentageAtteint;}} }}function donneTitrePage(){ var nlex=31;if (pageSynthese){nlex=80;} return donneLex(nlex);}function RES_init(){if (parent.defilContenu){var oHtml=document.getElementsByTagName("html").item(0);oHtml.style.overflow="auto";oHtml.style.overflowX="hidden";}PF_ecritDocW();if (pageSynthese){var lesdivs=document.getElementsByTagName("div");for (var i=0;i<lesdivs.length;i++){var oDiv=lesdivs[i];var lid=oDiv.id;if (lid=="LEX_72"){oDiv.innerHTML=donneLex(82);oDiv.id="";}if (lid=="LEX_73"){oDiv.innerHTML=donneLex(83);oDiv.id="";}if (lid=="LEX_75"){oDiv.innerHTML=donneLex(84);oDiv.id="";}}}RES_valide=oEval.valide;if (oEval.etatCorrige){PF_afficherDiv("STY_detailsRes");}oEval.etatCorrige=false;parent.oSco.numPageCourante=-1;parent.valeurExit("normal");var nlex=31;if (pageSynthese){nlex=80;}PF_modifTexteDiv('STY_titrePage',donneLex(nlex));if (oEval.questionnaire || oEval.correctionManuelle){PF_afficherDiv('STY_zoneQuestRes');} else {PF_afficherDiv('STY_zoneEvalRes');RES_zonesDyn();}afficherResultats();if (parent.temps_session){var tempPss=PF_donneObjet('STY_tempsPasseEval');if (tempPss){tempPss.innerHTML=MD_afficheTemps(parent.temps_session);}}if (parent.oSco.tempsDepasseEvt){var znTDep=PF_donneObjet('STY_zoneTempsDepasse');if (znTDep){znTDep.style.display="";}}initCadreContenuInterne();GLOBAL_initBarreBouton('RES');if (parent.surMosLMS){try {if (parent.parent.planLMS.oFenetre){var leslienspages=document.getElementsByTagName("a");for (var i=0;i<leslienspages.length;i++){if (leslienspages[i].href && leslienspages[i].href.indexOf("top.planLMS.PLAN_basculePlan()")>=0){leslienspages[i].onclick=chopeEtStpEvt;break;}}}} catch(e){}}if (parent.oSco.boutonsSVG=="oui"){if (parent.oSco.formatBouton=="png"){var lesimgs=document.getElementsByTagName("img");var oReg=new RegExp("\\.svg$");for (var i=0;i<lesimgs.length;i++){var lsrc=lesimgs[i].src;if (lsrc.match(oReg)){lesimgs[i].src=lsrc.replace(oReg,".png");}}} else {metBoutonPredfEnSVG("imgBoutonInit");metBoutonPredfEnSVG("imgBoutonSuivant");metBoutonPredfEnSVG("imgBoutonPrecedent");metBoutonPredfEnSVG("imgBoutonValider");}}GEN_activerSuivantDemar();parent.variablesTexte(window.document,parent.tabRegVT());var oCorps=document.getElementsByTagName("body").item(0);if (oCorps.offsetWidth>300){PF_affecterAlt();} else {setTimeout(PF_affecterAlt,100);} window.focus(); if (parent.surMosLMS && oEval.resultatEnvoiLMS){ parent.enregistrerRemonteeTm(); } SPE_initPageResultats(oEval.stylePgResultats);}function SPE_initPageResultats(nomModele){}function metBoutonPredfEnSVG(idm){var oImg=document.images[idm];if (oImg){oImg.src=oImg.src.replace(/\.png$/,".svg");}}document.onclick=GEN_cliqueInterne;function GEN_cliqueInterne(){if (parent.surMosLMS){try {if (parent.parent.planLMS.oFenetre){parent.parent.planLMS.PLAN_effacePop();}} catch(e){}}}function STG_allerSuivant(){parent.valeurExit("normal");if (oEval.branchement==''){parent.allerEtapeSuivante=true;parent.SCO_pageSuivante();} else {var ref=oEval.branchement;if (ref.indexOf('/')<0){ref+='/';}GLOBAL_allerPage(ref);}} function RES_zonesDyn(){PF_masquerDiv('STY_zoneLienDiplome');if (RES_valide){PF_masquerDiv('STY_zoneEchecEval');PF_afficherDiv('STY_zoneSuccesEval');GEN_lireMediaZone("STY_zoneSuccesEval",false);if (oEval.diplome){PF_afficherDiv('STY_zoneLienDiplome');GEN_lireMediaZone("STY_zoneLienDiplome",false);}} else {PF_masquerDiv('STY_zoneSuccesEval');PF_afficherDiv('STY_zoneEchecEval');GEN_lireMediaZone("STY_zoneEchecEval",false);}}function GEN_suivantPossible(){var possible=false;if (parent.oSco.passageEntreActivites && parent.APIgetValue("adl.nav.request_valid.continue")=="true"){possible=true;parent.allerEtapeSuivante=true;}return possible;}function GEN_clavier() {STG_allerSuivant();}function afficherResultats(){afficherCommentaire();if (pageSynthese){afficherDetailObjectifs();} else {afficherDetailQuestions();}}function afficherDetailQuestions(){var existeCert=oEval.existeNiveauCertitude();var res='<table class="STY_tableauRes" cellpadding="0" cellspacing="0"><tr>';if (!oEval.questionnaire){res+='<td class="STY_tableauResEntete STY_tabResIco">&#160;</td>';}res+='<td class="STY_tableauResEntete">'+donneLex(3)+'</td>';if (existeCert){res+='<td class="STY_tableauResEntete STY_tabResNivCert">'+donneLex(98)+'</td>';}if (!oEval.questionnaire){res+='<td class="STY_tableauResEntete STY_tabResScore">'+donneLex(32)+'</td>';}res+='</tr>';for (var i=0;i<oEval.questions.length;i++){var qTmp =oEval.questions[i];if (qTmp.scoreTotal!="0"){var src=chemin_img+'gen/';if (qTmp.valide){src=src+"resQuestionJuste."+parent.oSco.formatBouton;} else {src=src+"resQuestionFaux."+parent.oSco.formatBouton;}res+='<tr>';var balImg="";if (qTmp.correctionManuelle && !qTmp.valide){balImg=' style="visibility:hidden"';}if (!oEval.questionnaire){res+='<td class="STY_tableauResCellule STY_tabResIco"><img src="'+src+'" align="absmiddle" hspace="2"'+balImg+'/></td>';}res+='<td class="STY_tableauResCellule">';var nomQ=eval(i+1)+'. '+qTmp.titre;if (qTmp.type!="questionVide"||window.RES_lienQuestionsNonRepondues){nomQ='<a class="STY_lienCorrige" href="javascript:RES_voirQ(\''+qTmp.codePage+'\')">'+nomQ+'</a>';}res=res+nomQ+'</td>';if (existeCert){var nivCert="&#160;";var intNiv=qTmp.niveauCertitude;if (intNiv>=0){nivCert=donneLex(99);if (intNiv>=0.4){nivCert=donneLex(100);if (intNiv>=0.9){nivCert=donneLex(101);}}}res+='<td class="STY_tableauResCellule STY_tabResNivCert">'+nivCert+'</td>';}if (!oEval.questionnaire){res+='<td class="STY_tableauResCellule STY_tabResScore">'+localeNb(qTmp.scoreAtteint)+'/'+qTmp.scoreTotal+'</td>';}}res+='</tr>';}res=res+'</table>';PF_modifTexteDiv('STY_detailsRes',res);}function afficherCommentaire(){var niveau=oEval.determinerNiveau();if (niveau>=0){var res=oEval.donneCommentaire(niveau);var oCmt=PF_donneObjet('STY_commentaireRes');if (oCmt==null){return;}oCmt.style.display="block";if (oCmt.parentNode.style.display=="none"){oCmt.parentNode.style.display="";}oCmt.innerHTML=res;}}function RES_donneNomEvaluation(){return parent.oSco.titre;}function RES_ouvrirDiplome(){var src=racine_stage+"contenu/local/diplome."+parent.oSco.version;var taille="width=786,height=560";if (screen.width>1000){taille="width=842,height=646";}var fenTmp=this.open(src,'diplome','left=10,top=10,toolbar=no,status=no,menubar=no,'+taille+',resizable=yes,scrollbars=yes');fenTmp.focus();}function RES_voirQ(code){oEval.etatCorrige=true;parent.SCO_allerPage(parent.oSco.numeroPage(code));}function GEN_precedentPossible(){ return false;}function actionTouchePgSuivante(){STG_allerSuivant();}function actionTouchePgPrecedente(){STG_allerPrecedent();}function STG_allerPrecedent(){}function GEN_presseTouche(evt){if (evt==null){evt=window.event;}if (evt.keyCode==8){GEN_bloqueRetour(evt);} else {if ((evt.keyCode==32)||(evt.keyCode==13)){GEN_clavier();}}}function GEN_bloqueRetour(evt){if (evt==null){evt=window.event;}if (evt.keyCode==8 || (evt.keyCode==37&&evt.altKey)){evt.returnValue=false;evt.cancelBubble=true;try {evt.stopPropagation();evt.preventDefault();}catch(e){}}}function afficherDetailObjectifs(){var res='<table class="STY_tableauRes" cellpadding="0" cellspacing="0"><tr>';res+='<td class="STY_tableauResEntete STY_tabResIco">&#160;</td>';res+='<td class="STY_tableauResEntete">'+donneLex(81)+'</td>';res+='<td class="STY_tableauResEntete STY_tabResScore">'+donneLex(32)+'</td></tr>';res+='</tr>';for (var i=1;i<parent.SCO_compteCMI("cmi.objectives");i++){var objCh="cmi.objectives."+i+".";var idObj=parent.APIgetValue(objCh+"id");var letat=parent.APIgetValue(objCh+"success_status");if (!ignorerEvalSiNonParcourue || letat!="unknown"){var resF=false;if (letat=="passed"){resF=true;}var src=chemin_img+'gen/';if (resF){src=src+"resQuestionJuste."+parent.oSco.formatBouton;} else {src=src+"resQuestionFaux."+parent.oSco.formatBouton;}res+='<tr><td class="STY_tableauResCellule STY_tabResIco">';if (letat=="unknown"){res+='&#160;</td>';} else {res+='<img src="'+src+'" align="absmiddle" hspace="2"/></td>';}res+='<td class="STY_tableauResCellule">';res=res+decodeURI(idObj)+'</td>';var lscore=parent.APIgetValue(objCh+"score.scaled");var poidsO=donnePoidsObjectif(idObj);if (lscore!=""){var resus=Math.floor(lscore*1000)/10;lscore=localeNb(resus)+"/100";if (existePoidsRemonte && syntheseAvecPoids){var infp=localeNb(poidsO);if (infp.length>4){infp=infp.substring(0,4);}lscore+=" \xD7"+infp;}}if (lscore==""){lscore="&#160;";}res=res+'<td class="STY_tableauResCellule STY_tabResScore">'+lscore+'</td>';res+='</tr>';}}res=res+'</table>';PF_modifTexteDiv('STY_detailsRes',res);}function donneDateMAJ(){var ldate=parent.oSco.dateMAJ;if (ldate==""){return "";}return parent.oSco.donneDate(ldate);}function GEN_activerSuivantDemar(){if (GEN_suivantPossible()){activerBoutonSuivant();}}function donnePoidsObjectif(lid){var tabPoids=oEval.lsPoidsObjectifs.split("[;]");for (var t=0;t<tabPoids.length;t++){if (tabPoids[t].indexOf(lid+"[.]")==0){var tabP=tabPoids[t].split("[.]");if (!isNaN(tabP[1])){if (tabP[1]!="1"){existePoidsRemonte=true;}return Number(tabP[1]);}}}return 1;}function RES_bascQuestions(){var oDiv=PF_donneObjet("STY_detailsRes");if (oDiv.offsetWidth<10){oDiv.style.display="block";}else {oDiv.style.display="none";}}function MD_afficheTemps(t){var espace="<span style=\"font-size:50%\"> </span>";var strTemps=new String(t);var jours=0;var tabR=strTemps.match(/^P(\d+)DT/);if (tabR!=null){jours=tabR[1];}strTemps=strTemps.substring(strTemps.indexOf('T')+1);var indY=strTemps.indexOf("H");var heures=-1;if (indY>0){heures=parseInt(strTemps.substring(0,indY),10);strTemps=strTemps.substring(indY+1);}heures+=jours*24;indY=strTemps.indexOf("M");var min=-1;if (indY>0){min=parseInt(strTemps.substring(0,indY),10);strTemps=strTemps.substring(indY+1);}indY=strTemps.indexOf("S");var sec=-1;if (indY>0){sec=parseInt(strTemps.substring(0,indY),10);} if (heures<=0){heures='';} else {heures=heures+espace+"h ";} if (min<0 || (min==0&&heures!="")){min='';} else{min=min+espace+"min ";} if (sec<0){sec='';} else{sec=sec+espace+"s";} return heures+min+sec;}
