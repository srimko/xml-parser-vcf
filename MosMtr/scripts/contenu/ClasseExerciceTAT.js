function ExerciceTAT() { this.indications; this.commentaireSucces=null; this.consigne=null; this.tabChamps; this.tabNomChamps; this.tabReponses; this.tabSelects; this.tabCouleurChamps; this.tabPoids; this.tabTxtDef; this.scoreCourant=0; this.scoreTotal=0; this.scoreMin=0;this.scoreMaxPoid=0;this.valide=false; this.titre=''; this.type="TAT"; this.actif=true;this.sensibleCasse=false;this.respectAccents=false;this.ordreAleatoire=false;this.existeZoneTxt=false;this.existeRadio=false;this.scoreManuel="";this.niveauCertitude=-1; this.existeClasseCorrection=false;this.existeClasseSuggRef=false;this.init=exo_init;this.initEchelleScore=exo_initEchelleScore;this.ajouterReponse=exo_ajouterReponse;this.compterTotal=exo_compterTotal;this.valider=exo_valider; this.initialiser=exo_initialiser; this.construireMenu=exo_construireMenu;this.construireMenus=exo_construireMenus;this.desactiver=exo_desactiver; this.solutions=exo_solutions;this.donneSuggestion=exo_donneSuggestion;this.champJuste=exo_champJuste;this.donneTabReponses=exo_donneTabReponses;this.afficherMesReponses=exo_afficherMesReponses;this.champSelectionne=exo_champSelectionne;this.corrigerReponses=exo_corrigerReponses;this.marquerSuggestionRef=exo_marquerSuggestionRef;this.corrigerTrou=exo_corrigerTrou;this.enleverCorrection=exo_enleverCorrection;this.enleverCorrectionTrou=exo_enleverCorrectionTrou;this.effacerMarqueSuggestionRef=exo_effacerMarqueSuggestionRef;this.reactiver=exo_reactiver;}function exo_init(){this.titre=document.title; this.indications= new Array(); this.tabChamps=new Array(); this.tabReponses=new Array(); this.tabSelects=new Array(); this.tabPoids=new Array(); this.tabTxtDef=new Array(); this.tabNomChamps=new Array();this.existeClasseCorrection=classeCSSExiste(".STY_champTATJuste");this.existeClasseSuggRef=classeCSSExiste(".STY_champTATSuggRef"); var STY_texteTAT=PF_donneObjet("STY_texteTAT"); if (STY_texteTAT){ var leszn=STY_texteTAT.getElementsByTagName("textarea"); if (leszn.length>0){ this.existeZoneTxt=true; }}}function exo_initEchelleScore(){var scoreMaxPoids=0;this.tabCouleurChamps=new Array();for (var n=0;n<this.tabChamps.length;n++){if (this.tabPoids[n]=="" || isNaN(Number(this.tabPoids[n]))){this.tabPoids[n]=1;}else {this.tabPoids[n]=Number(this.tabPoids[n]);}scoreMaxPoids+=this.tabPoids[n];this.tabCouleurChamps[n]=PF_donneObjet('champTrou'+this.tabChamps[n]).style.color;}this.scoreMaxPoids=scoreMaxPoids;if (!parent.oSco.scoreBinaire&&parent.oSco.penaliserMauvaiseReponse){this.scoreMin=this.scoreTotal*-1;}this.initialiser();setTimeout(initVarSSP,200);}function initVarSSP(){var tabC=exo.tabChamps;var existeValrecup=false;for (var n=0;n<tabC.length;n++){var nv=exo.tabNomChamps[n];if (nv!=""){var valSpp="";if (nv.indexOf("SSP_VAR_C_")==0){valSpp=getCourseVariable(nv.substring(10));} else if (nv.indexOf("SSP_VAR_U_")==0){valSpp=getUserVariable(nv.substring(10));}if (valSpp!=""){existeValrecup=true;var champTmp=PF_donneObjet("champTrou"+tabC[n]);if (estCase(champTmp)){if (estRadio(champTmp)){var labs=document.getElementsByTagName("label");for (var k=0;k<labs.length;k++){if (labs[k].htmlFor=="champTrou"+tabC[n]){if (labs[k].innerHTML==valSpp){champTmp.checked=true;}}}} else {champTmp.checked=true;}} else if (estListe(champTmp)){for (var k=0;k<champTmp.options.length;k++){if (champTmp.options[k].text==valSpp){champTmp.options[k].selected=true;break;}}} else {champTmp.value=valSpp;}window.focus();}}}if (existeValrecup){detectionReponseValidable();}}function exo_ajouterReponse(lid,num,correction,txt){var res=decodeX(txt);var decalY=(this.tabChamps.length+this.scoreTotal)%2;var reste=correction-num*2-1; if (decalY==1){ reste--; }if (reste==-1){correction=CODE_V;}else{correction=CODE_F;}this.tabReponses.push(new ChampTrou(lid,num,res,correction));}function exo_compterTotal(){if (this.scoreManuel!="" && this.tabChamps.length==1){return 0;}var score0=0;if (parent.oSco.penaliserMauvaiseReponse){for (var i=0;i<this.tabChamps.length;i++){var numChamp=this.tabChamps[i];if (this.champSelectionne(numChamp)){if (this.champJuste(numChamp)){score0+=this.tabPoids[i];} else {score0-=this.tabPoids[i];}}}if (this.scoreMaxPoids==0){return this.scoreTotal;}score0=Math.round(score0/this.scoreMaxPoids*this.scoreTotal*10)/10;} else {var poidTotalItm=0;for (var i=0;i<this.tabChamps.length;i++){var numChamp=this.tabChamps[i];if (this.champJuste(numChamp)){score0+=this.tabPoids[i];}poidTotalItm+=this.tabPoids[i];}if (poidTotalItm==0){return this.scoreTotal;}score0=Math.round(score0/poidTotalItm*this.scoreTotal*10)/10;}if (score0<0 && !parent.oSco.scoreNegatif){score0=0;}return score0;}function exo_valider(){this.scoreCourant=this.compterTotal();if (this.scoreCourant>=this.scoreTotal){this.valide=true;}appliquerNiveauCertitude(this);if (etatEval){for (var n=0;n<this.tabNomChamps.length;n++){var nv=this.tabNomChamps[n];if (nv!=""){var champTmp=PF_donneObjet('champTrou'+this.tabChamps[n]);if (!estRadio(champTmp)||valeurChampPourSSP(n,champTmp)!=""){if (nv.indexOf("SSP_VAR_C_")==0){setCourseVariable(nv.substring(10),valeurChampPourSSP(n,champTmp));} else if (nv.indexOf("SSP_VAR_U_")==0){setUserVariable(nv.substring(10),valeurChampPourSSP(n,champTmp));}}}}}}function valeurChampPourSSP(num,champTmp){var res="";if (estCase(champTmp)){if (valeurCaseCoche(champTmp)=="on"){res="yes";var labs=document.getElementsByTagName("label");for (var k=0;k<labs.length;k++){if (labs[k].htmlFor=="champTrou"+exo.tabChamps[num]){res=labs[k].innerHTML;}}}} else {if (exo.champSelectionne(exo.tabChamps[num])){res=champTmp.value;if (estListe(champTmp)){for (var t=0;t<champTmp.options.length;t++){if (champTmp.options[t].selected){res=champTmp.options[t].text;}}}}}return res;}function exo_initialiser(){if (this.apresDesactive){this.reactiver();}for (var n=0;n<this.tabChamps.length;n++){var champTmp= PF_donneObjet('champTrou'+this.tabChamps[n]);if (estListe(champTmp)){champTmp.value='_INIT_TROU';for (var j=0;j<champTmp.options.length;j++){champTmp.options[j].disabled=false;}} else {champTmp.value='';}if (estCase(champTmp)){champTmp.checked=false;}else {var vVal=this.tabTxtDef[n].replace(";[NOMBRE]","");if (vVal!=""){if (estListe(champTmp)){champTmp.options[0].text=vVal;champTmp.options[0].style.color=COUL_TXT_DEF;champTmp.options[0].selected=true;} else {champTmp.value=vVal;champTmp.style.color=COUL_TXT_DEF;}}}}this.scoreCourant=0;this.valide=false;this.actif=true;this.enleverCorrection();this.effacerMarqueSuggestionRef();}function exo_construireMenus(){for (var n=0;n<this.tabSelects.length;n++){this.construireMenu(this.tabSelects[n]);}}function exo_construireMenu(ref){var champTmp= PF_donneObjet('champTrou'+ref);var effaceValeurVide=false;for (var k=0;k<this.tabReponses.length;k++){var entree=this.tabReponses[k];if (entree.reference==ref){var nouveauChoix = new Option(entree.texte,entree.id);champTmp.options[champTmp.options.length]=nouveauChoix;}}var nbReponses=champTmp.options.length-1;if ((this.ordreAleatoire)&&(nbReponses>1)){melangerReponses(champTmp,nbReponses);melangerReponses(champTmp,nbReponses);if (nbReponses>3){melangerReponses(champTmp,nbReponses);melangerReponses(champTmp,nbReponses);}}/*if (effaceValeurVide){champTmp.remove(0);}*/}function exo_desactiver(){ this.actif=false;for (var i=0;i<this.tabChamps.length;i++){var numChamp=this.tabChamps[i];var ov=PF_donneObjet("champTrou"+numChamp);if (ov){if (etatEval){if (!fonctionInitSurCmtSolution()){ov.onkeypress=desactiverPressageK;ov.onkeydown=desactiverPressageK;ov.onchange=desactiverPressageK;ov.onfocus=desactiverPressageK;ov.onclick=desactiverPressageK;}}if (estListe(ov)){var valSel=ov.value;for (var j=0;j<ov.options.length;j++){if (ov.options[j].value!=valSel){ov.options[j].disabled=true;}}}}}this.apresDesactive=true;}function exo_reactiver(){ this.actif=true;for (var i=0;i<this.tabChamps.length;i++){var numChamp=this.tabChamps[i];var ov=PF_donneObjet("champTrou"+numChamp);if (ov){if (estListe(ov)){var valSel=ov.value;for (var j=0;j<ov.options.length;j++){if (ov.options[j].value!=valSel){ov.options[j].disabled=false;}}}}}}function desactiverPressageK(){return false;}function detectionReponseValidable(){if (reponseValidable()){if (!actionD){actionD=true;activerBoutonInit();activerBoutonValider();}} else {if (actionD){actionD=false;desactiverBoutonInit();desactiverBoutonValider();}}}function actionDetecteSelect(oIn){if (exo.actif){detectionReponseValidable();if (exo.tabChamps.length==1){EXO_validerAuto();}exo.enleverCorrectionTrou(oIn);}}function desactiveSelect(){if (!exo.actif){window.focus();}}function actionDetecteTrou(oIn){if (!exo.actif){window.focus();} else {detectionReponseValidable();if (exo.existeClasseCorrection || exo.existeClasseSuggRef){exo.enleverCorrectionTrou(oIn);}}}function exo_solutions(){this.initialiser();for (var n=0;n<this.tabChamps.length;n++){var idTabTmp=this.tabChamps[n];var champTmp= PF_donneObjet('champTrou'+idTabTmp);var balise=nomBalise(champTmp);for (var k=this.tabReponses.length-1;k>=0;k--){var repTmp=this.tabReponses[k];if (repTmp.reference==idTabTmp && repTmp.correction==CODE_V){if (balise=="select"){champTmp.options[0].text="";selectValeur(champTmp,repTmp.id);} else if (estCase(champTmp)){champTmp.checked=(repTmp.texte=="on");} else {if (trouEnDefaut(champTmp)){champTmp.style.color=this.tabCouleurChamps[n];}champTmp.value=affichageBonneReponseChamp(repTmp.texte);}}}}this.corrigerReponses(false);}function selectValeur(oSelect,val){for(var i=0;i<oSelect.options.length;i++){if (oSelect.options[i].value==val){oSelect.options[i].selected=true;}} }function exo_donneSuggestion(){var res=null;var i=0;while (i<exo.indications.length){if (exo.indications[i].id.indexOf('divSugg')==0){var ref=exo.indications[i].ref;if (ref!='' && suggestionDejaAffiche.indexOf(exo.indications[i].id+',')<0){var tabParams=ref.split(':');var idTrou=tabParams[0];var idRep=tabParams[1];for (var n=0;n<this.tabChamps.length;n++){if (this.tabChamps[n]==idTrou){var oTrou=PF_donneObjet('champTrou'+idTrou);var k=0;var oRep=null;while (k<this.tabReponses.length){if (this.tabReponses[k].reference==idTrou){if (this.tabReponses[k].id==idRep){oRep=this.tabReponses[k];break;}}k++;}var txt1=oTrou.value;if (oRep!=null){if (estCase(oTrou)){if (oTrou.checked){res=exo.indications[i];i=9999;break;}} else if (estListe(oTrou)){if (txt1==idRep){res=exo.indications[i];i=9999;break;}} else {var txt2=oRep.texte;if (!this.sensibleCasse){txt1=txt1.toLowerCase();txt2=txt2.toLowerCase();}if (!this.respectAccents){txt1=sansAccents(txt1);txt2=sansAccents(txt2);}if (correspond(txt1,txt2,idTrou)){res=exo.indications[i];i=9999;break;}}} else if (idRep=='<>'){if (!this.champJuste(idTrou) && this.champSelectionne(idTrou)){res=exo.indications[i];i=9999;break;}}}}}}i++;}if (res==null){i=0;while (i<exo.indications.length){if (exo.indications[i].id.indexOf('divSugg')==0 && exo.indications[i].ref=='' && suggestionDejaAffiche.indexOf(exo.indications[i].id+',')<0){res=exo.indications[i];break;}i++;}}return res;}function correspond(txt1,txt2,idTrou){var res=false;if (txt2=='<>'){if (txt1!=''){var pasCompris=true;var k=0;while (k<exo.tabReponses.length){if (exo.tabReponses[k].reference==idTrou){var txtTest=exo.tabReponses[k].texte;if (!exo.sensibleCasse){txtTest=txtTest.toLowerCase();}if (!exo.respectAccents){txtTest=sansAccents(txtTest);}if (txtTest==txt1){pasCompris=false;break;}}k++;}if (pasCompris){res=true;}}} else if (txt1==txt2){res=true;} else if (reponseAvecRegleCrochet(txt2)){var tabMotsCrochet=parserReponseCrochet(txt2);var existeJuste=false;var existeFaux=false;for (var k=0;k<tabMotsCrochet.length;k++){var tabMotsOu=tabMotsCrochet[k].split("|");var trouveRep=false;for (var h=0;h<tabMotsOu.length;h++){if (tabMotsOu[h].length>0){var oReg=new RegExp("\\b"+tabMotsOu[h]+"\\b");if (txt1.match(oReg)!=null){trouveRep=true;}}}if (trouveRep){existeJuste=true;}else {existeFaux=true;}}res=(existeJuste && !existeFaux);}return res;}function reponseAvecRegleCrochet(txt2){return (txt2.indexOf("[")==0 && txt2.lastIndexOf("]")==(txt2.length-1) && txt2.length>2);}function affichageBonneReponseChamp(txt){if (reponseAvecRegleCrochet(txt)){var txtClair="";var tabMotsCrochet=parserReponseCrochet(txt);var lexOu="or";var lang=parent.oSco.langue;if (lang.length>2){lang=lang.substring(0,2);}if (lang=="fr"){lexOu="ou";}if (lang=="es"||lang=="it"){lexOu="o";}if (lang=="de"){lexOu="oder";}for (var k=0;k<tabMotsCrochet.length;k++){if (txtClair!=""){txtClair+=", ";}var txtTemp="";var tabmm=tabMotsCrochet[k].split("|");for (var n=0;n<tabmm.length;n++){if (txtTemp!=""){txtTemp+=" "+lexOu+" ";}txtTemp+=tabmm[n];}txtClair+=txtTemp;}txt=txtClair;}return txt;}function exo_champSelectionne(idTabTmp){var champTmp= PF_donneObjet('champTrou'+idTabTmp);if (estListe(champTmp)){return (champTmp.value!="_INIT_TROU");}if (estCase(champTmp)){return true;}return (champTmp.value!="" && !trouEnDefaut(champTmp));}function exo_champJuste(idTabTmp){var juste=false;var champTmp= PF_donneObjet('champTrou'+idTabTmp);var txt1=champTmp.value;if (estCase(champTmp)){txt1=valeurCaseCoche(champTmp);} else if (!estListe(champTmp)){if (trouEnDefaut(champTmp)){txt1="";}else {var ttrim=txt1.replace(/\s+$/g,"");if (ttrim!=txt1){txt1=ttrim;champTmp.value=ttrim;} }}var existeReponses=false;for (k=0;k<this.tabReponses.length;k++){var repTmp=this.tabReponses[k];if (repTmp.correction==CODE_V){if (repTmp.reference==idTabTmp){existeReponses=true;if (estListe(champTmp)){if (txt1==repTmp.id){juste=true;}} else if (estCase(champTmp)){if (txt1==repTmp.texte){juste=true;}} else {var txt2=repTmp.texte;var compareTxt=txt2;if (!this.sensibleCasse){txt1=txt1.toLowerCase();compareTxt=txt2.toLowerCase();}if (!this.respectAccents){txt1=sansAccents(txt1);compareTxt=sansAccents(compareTxt);}if (correspond(txt1,compareTxt,idTabTmp)){juste=true;if (txt2!="<>" && !reponseAvecRegleCrochet(txt2)){champTmp.value=txt2;}}}}}}if (!existeReponses){if (estCase(champTmp)&&txt1==""){juste=true;} else if (txt1=='_INIT_TROU'){juste=true;}}return juste;}function exo_donneTabReponses(){var tabRep=new Array();for (var n=0;n<this.tabChamps.length;n++){var tabInteraction=new Array();var idTabTmp=this.tabChamps[n];tabInteraction[0]=this.champJuste(idTabTmp);var oChampTmp= PF_donneObjet('champTrou'+idTabTmp);var vall=oChampTmp.value;if (vall=="_INIT_TROU"){vall="";}if (vall=='\xA0'){vall='';}if (estCase(oChampTmp)){vall="";var texteCherche=valeurCaseCoche(oChampTmp);if (texteCherche=="on"){for (var k=0;k<this.tabReponses.length;k++){var oRep=this.tabReponses[k];if (oRep.reference==idTabTmp && oRep.texte==texteCherche){vall=oRep.id;}}}} else if (!estListe(oChampTmp)){if (trouEnDefaut(oChampTmp)){vall="";}}tabInteraction[1]=vall;tabInteraction[2]="t"+idTabTmp;var typesc="fill-in";var balise=nomBalise(oChampTmp);if (balise=="select"){typesc="choice";vall="";for (var t=0;t<oChampTmp.options.length;t++){if (oChampTmp.options[t].selected){vall=oChampTmp.options[t].text;}}} else if (estCase(oChampTmp)){typesc="choice";vall="no";if (oChampTmp.checked){vall="yes";}if (parent.oSco.langue.indexOf("fr")==0){if (vall=="yes"){vall="oui";}if (vall=="no"){vall="non";}}}if (balise=="textarea"){typesc="long-fill-in";}var ajCorrige="";if (this.scoreManuel!="" && (typesc=="fill-in"||typesc=="long-fill-in"||estCase(oChampTmp))){ajCorrige="[manualCorrection]";}tabInteraction[3]=ajCorrige+vall;tabInteraction[4]=typesc;tabRep[n]=tabInteraction;}return tabRep;}function exo_afficherMesReponses(tabRep){for (var i=0;i<tabRep.length;i++){var oInteraction=tabRep[i];var idTabTmp=oInteraction.id;idTabTmp=idTabTmp.substring(idTabTmp.indexOf("_")+2);var oChampTmp= PF_donneObjet('champTrou'+idTabTmp);if (oChampTmp!=null){if (estListe(oChampTmp)){for (k=0;k<this.tabReponses.length;k++){var repTmp=this.tabReponses[k];if (repTmp.reference==idTabTmp){if (repTmp.id==oInteraction.learner_response){oChampTmp.value=oInteraction.learner_response;}}}if (oInteraction.learner_response==""){oChampTmp.options[0].text="";}} else if (estCase(oChampTmp)){var doitCoche=false;for (var k=0;k<this.tabReponses.length;k++){var oRep=this.tabReponses[k];if (oRep.reference==idTabTmp && oRep.id==oInteraction.learner_response && oRep.texte=="on"){doitCoche=true;}}oChampTmp.checked=doitCoche;} else {if (trouEnDefaut(oChampTmp)){oChampTmp.style.color=couleurInitialeTrouId(idTabTmp);}oChampTmp.value=oInteraction.learner_response;}}}}function couleurInitialeTrouId(lid){for (var m=0;m<exo.tabChamps.length;m++){if (exo.tabChamps[m]==lid){return exo.tabCouleurChamps[m];}}return "";}function clavierTAT(evt){if (evt==null){evt=window.event;}if (evt.keyCode==13){GEN_clavier(evt);}}function GEN_presseTouche(evt){if (evt==null){evt=window.event;}if (evt.keyCode==8){GEN_bloqueRetour(evt);} else if (evt.keyCode==13){GEN_clavier();}}function tapeDansChamp(evt){if (!exo.actif){return false;}var res=true;if (evt==null){evt=window.event;}evt.cancelBubble=true;try {evt.stopPropagation();}catch(e){}if (evt.keyCode==13){if (!etatEval){EXO_valider();evt.returnValue=false;res=false;}}return res;}function tapeDansZone(evt){if (!exo.actif){return false;}if (evt==null){evt=window.event;}evt.cancelBubble=true;try {evt.stopPropagation();}catch(e){}}function sansAccents(chaine){if (parent.oSco.langue.indexOf("de")==0){chaine=chaine.replace(/ä/g,"ae");chaine=chaine.replace(/ö/g,"oe");chaine=chaine.replace(/ü/g,"ue");chaine=chaine.replace(/β/g,"ss");}chaine=chaine.replace(/[éèêë]/g,"e");chaine=chaine.replace(/[àáâãäå]/g,"a");chaine=chaine.replace(/[òóôõöø]/g,"o");chaine=chaine.replace(/[ç]/g,"c");chaine=chaine.replace(/[ìíîï]/g,"i");chaine=chaine.replace(/[ùúûü]/g,"u");chaine=chaine.replace(/[ñ]/g,"n");chaine=chaine.replace(/[ÿ]/g,"y");chaine=chaine.replace(/[ÈÉÊË]/g,"E");chaine=chaine.replace(/[àáâãäå]/g,"a");chaine=chaine.replace(/[ÒÓÔÕÖØ]/g,"O");chaine=chaine.replace(/[Ç]/g,"C");chaine=chaine.replace(/[ÌÍÎÏ]/g,"I");chaine=chaine.replace(/[ÙÚÛÜ]/g,"U");chaine=chaine.replace(/[Ñ]/g,"N");return chaine;}function focusPremierChamp(){if (parent.oSco.config_navigateur!="IE"){window.focus();}if ((exo.tabChamps.length>0)&& (!etatEval || !parent.oSco.evaluation.etatCorrige)){var champTmp= PF_donneObjet('champTrou'+exo.tabChamps[0]);if (!estListe(champTmp)&&!estCase(champTmp) && !trouEnDefaut(champTmp)){try {var scrollAvant=0;var oDep=champTmp;while (oDep!=null && oDep.nodeType==1){scrollAvant+=oDep.scrollTop;oDep=oDep.parentNode;}champTmp.focus();var scrollApres=0;var oDep=champTmp;while (oDep!=null && oDep.nodeType==1){scrollApres+=oDep.scrollTop;oDep=oDep.parentNode;}if (scrollApres>scrollAvant){oDep=champTmp;while (oDep!=null && oDep.nodeType==1){oDep.scrollTop=0;oDep=oDep.parentNode;}window.focus();champTmp.blur();}}catch(e){}}}}function reponseValidable(){if (parent.oSco.forcerReponse){for (var n=0;n<exo.tabChamps.length;n++){var champTmp= PF_donneObjet('champTrou'+exo.tabChamps[n]);if (!estCase(champTmp)){if (!estListe(champTmp)){var val=champTmp.value.replace(/\s/g,'');if (val==''||trouEnDefaut(champTmp)){return false;}} else {if (champTmp.options[0].selected){return false;}}}}if (exo.existeRadio){var tabI=donneGroupeRadio();for (var n=0;n<tabI.length;n++){var tabBtn=tabI[n];var existeSelectionne=false;for (var y=0;y<tabBtn.length;y++){if (tabBtn[y].checked){existeSelectionne=true;}}if (!existeSelectionne){return false;}}}}return true;}function ChampTrou(id,ref,texte,correction) { this.id=id; this.texte=texte; this.correction=correction; this.reference=ref;}function melangerReponses(oChamp,totalR){var numN1=Math.ceil(Math.random()*totalR);var numN2=Math.ceil(Math.random()*totalR);if (numN1!=numN2){var oRep1=oChamp.options[numN1];var oRep2=oChamp.options[numN2];var lePere=oRep1.parentNode;var posInsert=oRep1.nextSibling;oRep2.parentNode.replaceChild(oRep1, oRep2);if (posInsert==oRep2){posInsert=oRep1;}lePere.insertBefore(oRep2,posInsert);}}function cocheCase(oIn){if (!exo.actif){oIn.checked=!oIn.checked;return false;}actionDetecteSelect(oIn);}function cocheRadio(oIn){if (!exo.actif){return false;}actionDetecteSelect(oIn);if (parent.oSco.exoValideChoixUnique){if (donneGroupeRadio().length==1 && exo.tabSelects.length==0 && !exo.existeZoneTxt && !existeChampOuCase()){EXO_validerAuto();}}}function existeChampOuCase(){var lesin=PF_donneObjet("STY_texteTAT").getElementsByTagName("input"); for (var i=0;i<lesin.length;i++){ if (lesin[i].type=="text"||lesin[i].type=="checkbox"||lesin[i].type==""){ return true; } } return false;}function nomBalise(obj){return obj.nodeName.toLowerCase();}function estListe(obj){return (nomBalise(obj)=="select");}function estCaseCoche(obj){return (!estListe(obj) && obj.type=="checkbox");}function estRadio(obj){return (!estListe(obj) && obj.type=="radio");}function estCase(obj){return (estCaseCoche(obj) || estRadio(obj));}function valeurCaseCoche(oCase){if (oCase.checked){return "on";}return "";}function donneGroupeRadio(){var tabGroupe=new Array();var lesin=PF_donneObjet("STY_texteTAT").getElementsByTagName("input");var lsprisgroupe=""; for (var i=0;i<lesin.length;i++){ if (lesin[i].type=="radio"){ var lid=lesin[i].name; if (lsprisgroupe.indexOf(lid)<0){ if (lsprisgroupe!=""){lsprisgroupe+=",";} lsprisgroupe+=lid; } } } var tabNoms=lsprisgroupe.split(","); for (var k=0;k<tabNoms.length;k++){ var tabBoutons=new Array(); for (var i=0;i<lesin.length;i++){ if (lesin[i].type=="radio" && lesin[i].name==tabNoms[k]){ tabBoutons.push(lesin[i]); } } tabGroupe.push(tabBoutons); } return tabGroupe;}var COUL_TXT_DEF="#797979";var COUL_TXT_DEF_MOZ="rgb(121, 121, 121)";function focusChamp(oCh){if (trouEnDefaut(oCh)){oCh.style.color=couleurInitialeTrouId(oCh.id.replace("champTrou",""));oCh.value="";}}function trouEnDefaut(oCh){return (oCh.style.color==COUL_TXT_DEF||oCh.style.color==COUL_TXT_DEF_MOZ);}function decodeX(va){var res="";va=va.replace(/"/g,'\\"');if (va.length>2){va=va.substring(va.length-2)+va.substring(0,va.length-2);}var chaine0="bHOi4ph5sWlr1c2nI7LBuzgaUNv0FDXtm8SodePVqRfwGKkJMxAQjTC";var chaine1="ABCDFGHJKLNOPQTUVWXabcdfghjklnopqtuvwx0124578ierRImMsSz";for (var i=0;i<va.length;i++){var car=va.charAt(i);var indRemplace=chaine0.indexOf(car);if (indRemplace>=0){res+=chaine1.substring(indRemplace,indRemplace+1);} else {res+=car;}}return res.replace(/\\"/g,'"');}function longeurSansRetour(val){val=val.replace(/\r/g,'');return val.replace(/\n/g,'').length;}function controleLongueur(obj,maxL,evt){var taill=longeurSansRetour(obj.value);if (taill > maxL){obj.value=obj.value.substring(0,maxL);return false;} else if (taill == maxL){var oEvt=evt;if (window.event){oEvt=evt;}var code0=oEvt.keyCode;if (code0!=8 && code0!=9 && code0!=37 && code0!=38 && code0!=39 && code0!=40 && code0!=46){if (window.event){oEvt.cancelBubble=false;}else{oEvt.stopPropagation();}oEvt.returnValue=false;return false;}}return true;}var tabVerifLong;function ctrLongApresCopie(obj,maxL){tabVerifLong=new Array();tabVerifLong[0]=obj;tabVerifLong[1]=maxL;setTimeout(controleLongueurApresCopie2,600);}function controleLongueurApresCopie2(){var obj=tabVerifLong[0];var maxL=tabVerifLong[1];if (obj.value.length > maxL){obj.value=obj.value.substring(0,maxL);}}function parserReponseCrochet(txt2){var tabMot=new Array();var fin=txt2.indexOf("]");while (fin>0){tabMot.push(txt2.substring(1,fin));txt2=txt2.substring(fin+1);var suite=txt2.indexOf("[");if (suite>=0){txt2=txt2.substring(suite);fin=txt2.indexOf("]");} else {fin=0;}}return tabMot;}function exo_corrigerReponses(montreFaux){if (!this.existeClasseCorrection){return;}if (montreFaux && !classeCSSExiste(".STY_champTATFaux")){return;}for (var i=0;i<this.tabChamps.length;i++){var numChamp=this.tabChamps[i];this.corrigerTrou(this.tabChamps[i],montreFaux);} }function exo_corrigerTrou(numChamp,montreFaux){var oTrou=PF_donneObjet('champTrou'+numChamp);if (estCase(oTrou)){if (valeurCaseCoche(oTrou)=="on"){if (this.champJuste(numChamp)){oTrou.className="STY_caseTAT STY_caseTATJuste";} else {if (montreFaux){oTrou.className="STY_caseTAT STY_caseTATFaux";}}var leslabs=document.getElementsByTagName("label");for (var k=0;k<leslabs.length;k++){if (leslabs[k].htmlFor=="champTrou"+numChamp){leslabs[k].className=oTrou.className.replace(/STY_caseTAT/g,"STY_labelTAT");break;}}}} else if (this.champSelectionne(numChamp)){if (estListe(oTrou)){if (this.champJuste(numChamp)){oTrou.className="STY_selectTAT STY_selectTATJuste";} else {if (montreFaux){oTrou.className="STY_selectTAT STY_selectTATFaux";}}} else {if (this.champJuste(numChamp)){oTrou.className="STY_champTAT STY_champTATJuste";} else {if (montreFaux){oTrou.className="STY_champTAT STY_champTATFaux";}}}}}function exo_marquerSuggestionRef(ref){if (!this.existeClasseSuggRef){return;}var tabParams=ref.split(':');if (tabParams.length<2){return;}var oTrou=PF_donneObjet('champTrou'+tabParams[0]);if (estCase(oTrou)){initClasseBoutonTrouSuggRef(oTrou);}else if (estListe(oTrou)){oTrou.className+=" STY_selectTATSuggRef";}else {oTrou.className+=" STY_champTATSuggRef";}}function exo_effacerMarqueSuggestionRef(){if (!this.existeClasseSuggRef){return;}for (var i=0;i<this.tabChamps.length;i++){this.enleverCorrectionTrou(PF_donneObjet('champTrou'+this.tabChamps[i]));}}function exo_enleverCorrection(){if (!this.existeClasseCorrection){return;}for (var i=0;i<this.tabChamps.length;i++){this.enleverCorrectionTrou(PF_donneObjet('champTrou'+this.tabChamps[i]));}}function exo_enleverCorrectionTrou(oTrou){if (estCase(oTrou)){if (estRadio(oTrou)){var lesrad=document.getElementsByTagName("input");for (var i=0;i<lesrad.length;i++){var oRad=lesrad[i];if (estRadio(oRad) && oRad.name==oTrou.name){initClasseBoutonTrou(oRad,"");}}} else {initClasseBoutonTrou(oTrou);}}else if (estListe(oTrou)){oTrou.className="STY_selectTAT";}else {oTrou.className="STY_champTAT";}}function initClasseBoutonTrou(oTrou){oTrou.className="STY_caseTAT";var leslabs=document.getElementsByTagName("label");for (var k=0;k<leslabs.length;k++){if (leslabs[k].htmlFor==oTrou.id){leslabs[k].className="STY_labelTAT";break;}}}function initClasseBoutonTrouSuggRef(oTrou){oTrou.className+=" STY_caseTATSuggRef";var leslabs=document.getElementsByTagName("label");for (var k=0;k<leslabs.length;k++){if (leslabs[k].htmlFor==oTrou.id){leslabs[k].className+=" STY_labelTATSuggRef";break;}}}function actionEffacerClsListe(obj){if (!exo.existeClasseCorrection && !exo.existeClasseSuggRef){return;}if (!exo.actif){return;}obj.className="STY_selectTAT";}function actionEffacerClsChamp(obj){if (!exo.existeClasseCorrection && !exo.existeClasseSuggRef){return;}if (!exo.actif){return;}obj.className="STY_champTAT";}function EXO_solutionDirecte(){if ((!etatEval||!parent.oSco.evaluation.etatCorrige) && exo.existeClasseCorrection){var i=0;while (i<exo.indications.length){var ref=exo.indications[i].ref;if (exo.indications[i].ref.indexOf("[solution]")==0){return true;}i++;}}return false;}function fonctionInitSurCmtSolution(){var i=0;while (i<exo.indications.length){if (exo.indications[i].ref.indexOf("[solution]")==0){var resh=PF_donneObjet(exo.indications[i].id).innerHTML;if (resh.indexOf("STG_initialiser()")>0){return true;}break;}i++;}return false;}function verifChampNombre(obj){if (obj.value!="" && isNaN(Number(obj.value.replace(",",".")))){obj.value="";var msg="Please enter a number";if (parent.donneLangue()=="fr"){msg="Veuillez entrer un nombre";}if (parent.donneLangue()=="de"){msg="Bitte geben Sie eine Zahl ein";}alert(msg);setTimeout("focuschampNombre('"+obj.id+"')",100);}}function focuschampNombre(ido){try{PF_donneObjet(ido).focus();}catch(e){}}
