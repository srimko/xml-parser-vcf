function ExerciceQC(typeQC) { this.indications; this.commentaireSucces=null; this.consigne=null; this.tabItems; this.scoreCourant=0; this.scoreTotal;this.scoreMin=0; this.scoreMaxPoids;this.valide=false; this.titre=''; this.racineImage; this.actif=true; this.typeQC=typeQC; this.type="QC"; this.ordreAleatoire=false;this.afficheBoutons=true;this.poidsEnPoints=false;this.niveauCertitude=-1;this.maxSel='';this.existeClasseCorrection=false;this.existeClasseSuggRef=false;this.ajoutClasseFirefox=""; this.init=exo_init;this.initEchelleScore=exo_initEchelleScore;this.valider=exo_valider;this.action=exo_action;this.actionImage=exo_actionImage;this.changerBouton=exo_changerBouton; this.initialiser=exo_initialiser; this.desactiver=exo_desactiver; this.compterMultiple=exo_compterMultiple;this.solutions=exo_solutions;this.donneSuggestion=exo_donneSuggestion;this.donneTabReponses=exo_donneTabReponses;this.afficherMesReponses=exo_afficherMesReponses;this.donneItem=exo_donneItem;this.corrigerReponses=exo_corrigerReponses;this.enleverCorrection=exo_enleverCorrection;this.marquerSuggestionRef=exo_marquerSuggestionRef;this.effacerMarqueSuggestionRef=exo_effacerMarqueSuggestionRef;}function exo_init(){this.titre=document.title;this.tabItems=new Array();this.indications= new Array(); this.racineImage=chemin_img+"gen/bouton"+this.typeQC;this.existeClasseCorrection=classeCSSExiste(".STY_imgBoutonQCSol");this.existeClasseSuggRef=classeCSSExiste(".STY_reponseQCSuggRef");if (afficheBordure){this.existeClasseCorrection=classeCSSExiste(".STY_bordureQCJuste");} else if (!this.existeClasseCorrection){this.existeClasseCorrection=classeCSSExiste(".STY_reponseQCJuste");}}function masqueCelTab(idRep){var obj=PF_donneObjet("trRep"+idRep);obj.style.display="none";var pere=obj.parentNode.parentNode;if (pere.nodeName.toLowerCase()=="table"){pere=pere.parentNode;}if (pere.nodeName.toLowerCase()=="td"){pere.style.display="none";}}function exo_donneItem(lid){ var res=null; for (var i=0;i<this.tabItems.length;i++) {if (this.tabItems[i].id==lid){res=this.tabItems[i];break;}}return res;}function exo_initEchelleScore(){if (this.afficheBoutons && parent.oSco.config_navigateur!="IE" && classeCSSExiste(".STY_imgBoutonQCFx")){this.ajoutClasseFirefox=" STY_imgBoutonQCFx";}if (this.ajoutClasseFirefox!=""){for (var i=0;i<this.tabItems.length;i++){var oImg=PF_donneObjet("boutonRep"+this.tabItems[i].id);oImg.className+=this.ajoutClasseFirefox;}} if (etatEval){ var unEstPris=false; for (var i=0;i<this.tabItems.length;i++){var lePre=this.tabItems[i].prerequis;if (lePre!="DEFAULT"){if (parent.evalVerifPrerequis(lePre)){unEstPris=true;} else {masqueCelTab(this.tabItems[i].id);}}}for (var i=0;i<this.tabItems.length;i++){if (this.tabItems[i].prerequis=="DEFAULT" && unEstPris){masqueCelTab(this.tabItems[i].id);}}if (window.initObjectifsItemQC && !parent.oSco.evaluation.etatCorrige){var compteObj=parent.SCO_compteCMI("cmi.objectives");for (var i=0;i<this.tabItems.length;i++){var oItem=this.tabItems[i];var oTr=PF_donneObjet("trRep"+this.tabItems[i].id);if (oItem.objectif!="" && oTr && oTr.style.display!="none"){for (var t=0;t<compteObj;t++){if (parent.APIgetValue("cmi.objectives."+t+".id")==oItem.objectif && parent.APIgetValue("cmi.objectives."+t+".success_status")=="unknown"){parent.APIsetValue("cmi.objectives."+t+".success_status","failed");break;}}}}} } var nbReponses=this.tabItems.length; var decalY=(nbReponses+this.scoreTotal)%2; if (decalY==1){ for (var i=0;i<this.tabItems.length;i++){this.tabItems[i].estJuste=!this.tabItems[i].estJuste;} } if (this.ordreAleatoire && nbReponses>1){melangerReponses(nbReponses);melangerReponses(nbReponses);if (nbReponses>3){melangerReponses(nbReponses);melangerReponses(nbReponses);}}var scoreMaxPoids=0;if (this.poidsEnPoints){var poidsMax=-9999;var poidsMin=9999;if (this.typeQC=='QCM'){poidsMax=0;poidsMin=0;}var tabScores=new Array();for (var i=0;i<this.tabItems.length;i++){tabScores[i]=this.tabItems[i].poids;}tabScores.sort(trinombre);var limSelection=this.maxSel;if (limSelection==""){limSelection=this.tabItems.length;}else{limSelection=parseInt(limSelection);}for (var i=0;i<tabScores.length && i<limSelection;i++){var ls=tabScores[i];if (this.typeQC=='QCM'){if (ls>0){poidsMax+=ls;}} else {if (ls>poidsMax){poidsMax=ls;}}}limSelection=tabScores.length-limSelection;for (var i=tabScores.length-1;i>=0 && i>=limSelection;i--){var ls=tabScores[i];if (this.typeQC=='QCM'){if (ls<0){poidsMin+=ls;}} else {if (ls<poidsMin){poidsMin=ls;}}}this.scoreMaxPoids=poidsMax;this.scoreTotal=poidsMax;this.scoreMin=poidsMin;} else {for (var i=0;i<this.tabItems.length;i++){var oItem=this.tabItems[i];if (oItem.estJuste){scoreMaxPoids+=oItem.poids;}}this.scoreMaxPoids=scoreMaxPoids;if (!parent.oSco.scoreBinaire && scoreMaxPoids!=0 && parent.oSco.penaliserMauvaiseReponse){this.scoreMin=this.scoreTotal*-1;}}if (!this.ordreAleatoire){var tabItemsOrdre=new Array();var lestd=document.getElementsByTagName("td");for (var i=0;i<lestd.length;i++){var oTd=lestd[i];if (oTd.className=="STY_bordureQC"){var lid=oTd.id;if (lid.indexOf("tdRep")==0){lid=lid.substring(5);tabItemsOrdre.push(this.donneItem(lid));}}}if (tabItemsOrdre.length==this.tabItems.length){this.tabItems=tabItemsOrdre;}}if (window.lettreDevantBoutonQC){var tabL=["A","B","C","D","E","F","G","H","I","J","K","L","M"];var lestd=document.getElementsByTagName("img");var numTrep=0;for (var i=0;i<lestd.length;i++){var oTd=lestd[i];if (oTd.className=="STY_imgBoutonQC"){oTd=oTd.parentNode;if (tabL[numTrep]){var objT=document.createElement("td");objT.className="STY_lettreDevantBoutonQC";var tnd=document.createTextNode(tabL[numTrep]);objT.appendChild(tnd);oTd.parentNode.insertBefore(objT,oTd);if (oTd.vAlign){objT.vAlign=oTd.vAlign}numTrep++;}}}}}function trinombre(a,b){return (b-a);}function melangerReponses(totalR){var numN1=Math.floor(Math.random()*totalR);var numN2=Math.floor(Math.random()*totalR);if (numN1!=numN2){var oRep1=PF_donneObjet("trRep"+exo.tabItems[numN1].id);var oRep2=PF_donneObjet("trRep"+exo.tabItems[numN2].id);var lePere=oRep1.parentNode;var posInsert=oRep1.nextSibling;oRep2.parentNode.replaceChild(oRep1, oRep2);if (posInsert==oRep2){posInsert=oRep1;}lePere.insertBefore(oRep2,posInsert);}}function exo_valider(){window.status='';this.scoreCourant=this.compterMultiple();if (this.scoreCourant>=this.scoreTotal){this.valide=true;}appliquerNiveauCertitude(this);for (var i=0;i<this.tabItems.length;i++){var oItem=this.tabItems[i];if (oItem.objectif!=""){var compteObj=parent.SCO_compteCMI("cmi.objectives");var indexAjoute=compteObj;for (var t=0;t<compteObj;t++){if (parent.APIgetValue("cmi.objectives."+t+".id")==oItem.objectif){indexAjoute=t;break;}}var statut="failed";if (oItem.selectionne){statut="passed";}if (indexAjoute==compteObj){parent.APIsetValue("cmi.objectives."+indexAjoute+".id",oItem.objectif);}parent.APIsetValue("cmi.objectives."+indexAjoute+".success_status",statut);}}}function exo_action(idRep){window.status='';if (this.actif && !qcResult){var oItem=this.donneItem(idRep);/*if (oItem.prerequis=="DEFAULT"){return false;}*/if (this.typeQC=='QCU' && oItem.selectionne){return false;}if (this.typeQC=='QCU' && !oItem.selectionne){this.initialiser(); } else {if (this.existeClasseCorrection && this.afficheBoutons){PF_donneObjet("boutonRep"+idRep).className="STY_imgBoutonQC"+this.ajoutClasseFirefox;}}if (!oItem.selectionne){if (this.typeQC=='QCM' && this.maxSel!=''){var compteSel=0;for (var i=0;i<this.tabItems.length;i++) {if (this.tabItems[i].selectionne){compteSel++;}}if (compteSel>=parseInt(this.maxSel)){return false;}}oItem.selectionne=true;this.actionImage(idRep,true);if (afficheBordure){ PF_changeClasse("tdRep"+idRep,"STY_bordureQC STY_bordureQCDessus"); }} else {oItem.selectionne=false;this.actionImage(idRep,false);if (afficheBordure){ PF_changeClasse("tdRep"+idRep,"STY_bordureQC"); }}if (this.typeQC=='QCU'){setTimeout(EXO_validerAuto,300);}if (this.typeQC=='QCM' && parent.oSco.forcerReponse){var existeReponse=false;for (var i=0;i<this.tabItems.length;i++){if (this.tabItems[i].selectionne){existeReponse=true;}}if (existeReponse){actionDetecte();}else if (actionD){actionD=false;desactiverBoutonValider();desactiverBoutonInit();}} else {actionDetecte();}}}function exo_actionImage(idRep,sel){var nomImage="boutonRep"+idRep;var src = this.racineImage;var nomLien="lien"+idRep;var lien = PF_donneObjet(nomLien);if (sel) {src=src+"_sel";PF_changeClasse(nomLien,"STY_reponseQCSel");} else {PF_changeClasse(nomLien,"STY_reponseQC");}if (etatEval&& (depuisPrecedent || parent.oSco.evaluation.etatCorrige)){ src=src+"."+parent.oSco.formatBouton;} else {src=src+"_hlt."+parent.oSco.formatBouton;}if (this.afficheBoutons){changeImgBtn(PF_donneObjet(nomImage),src);}}function exo_changerBouton(idRep,dessus){if (this.actif && !qcResult){var oItem=this.donneItem(idRep);/*if (oItem.prerequis=="DEFAULT"){return false;}*/var nomImage="boutonRep"+idRep;var src = this.racineImage;var dessusStr="";var oLien=PF_donneObjet("lien"+idRep);var vClass=oLien.className;var classeBase="STY_reponseQC";if (oItem.selectionne) {src=src+"_sel";classeBase+="Sel";}if (dessus) {src=src+"_hlt";classeBase+=" "+classeBase+"Dessus";}src=src+"."+parent.oSco.formatBouton;changeImgBtn(PF_donneObjet(nomImage),src);if (vClass.indexOf("STY_reponseQCFaux")>0){classeBase+=" STY_reponseQCFaux";}if (vClass.indexOf("STY_reponseQCJuste")>0){classeBase+=" STY_reponseQCJuste";}if (this.existeClasseSuggRef && vClass.indexOf("STY_reponseQCSuggRef")>0){classeBase+=" STY_reponseQCSuggRef";}oLien.className=classeBase;}}function exo_initialiser(){for (var i=0;i<this.tabItems.length;i++) {var idRep=this.tabItems[i].id;this.tabItems[i].selectionne=false;if (this.afficheBoutons){var oImg=PF_donneObjet("boutonRep"+idRep);oImg.className="STY_imgBoutonQC"+this.ajoutClasseFirefox;changeImgBtn(oImg,this.racineImage+"."+parent.oSco.formatBouton);}var nomLien="lien"+idRep;PF_changeClasse(nomLien,"STY_reponseQC");if (afficheBordure){PF_changeClasse("tdRep"+idRep,"STY_bordureQC");}}this.actif=true;this.scoreCourant=0;this.valide=false;this.enleverCorrection();}function exo_desactiver(){this.actif=false;if ((!etatEval)||(parent.oSco.evaluation.evalInteraction)){for (var i=0;i<this.tabItems.length;i++) {var idRep=this.tabItems[i].id;var nomImage="boutonRep"+idRep;var src = this.racineImage;if (this.tabItems[i].selectionne) {src=src+"_sel";}src=src+"_dis."+parent.oSco.formatBouton;changeImgBtn(PF_donneObjet(nomImage),src);}}}function exo_compterMultiple() {var score0=0;if (this.poidsEnPoints){for (var i=0;i<this.tabItems.length;i++){var oItem=this.tabItems[i];if (oItem.selectionne){score0+=oItem.poids;}}if (!parent.oSco.penaliserMauvaiseReponse && score0<0 && this.typeQC=="QCM"){score0=0;}return score0;}if (parent.oSco.penaliserMauvaiseReponse){for (var i=0;i<this.tabItems.length;i++){var oItem=this.tabItems[i];if (oItem.selectionne){if (oItem.estJuste){score0+=oItem.poids;} else {score0-=oItem.poids;}}}if (this.scoreMaxPoids==0){if (score0==0){score0=this.scoreTotal;}else {score0=0;}} else {score0=Math.round(score0/this.scoreMaxPoids*this.scoreTotal*10)/10;}} else {var poidTotalItm=0;for (var i=0;i<this.tabItems.length;i++){var oItem=this.tabItems[i];if (oItem.selectionne){if (oItem.estJuste){score0+=oItem.poids;}}if (oItem.estJuste||oItem.selectionne){poidTotalItm+=oItem.poids;}}if (poidTotalItm==0){score0=this.scoreTotal;}else {score0=Math.round(score0/poidTotalItm*this.scoreTotal*10)/10;}}if (score0<0 && !parent.oSco.scoreNegatif){score0=0;}if (score0<this.scoreMin){score0=this.scoreMin;}return score0;}function exo_corrigerReponses(montreFaux){if (!this.existeClasseCorrection){return;}if (classeCSSExiste(".STY_reponseQCJuste")){if (montreFaux && !classeCSSExiste(".STY_reponseQCFaux")){return;}var existeCssFaux=(montreFaux && classeCSSExiste(".STY_reponseQCFaux"));for (var i=0;i<this.tabItems.length;i++){var oItem=this.tabItems[i];var lclasse="STY_reponseQC";if (oItem.selectionne){lclasse="STY_reponseQCSel";}if (oItem.estJuste){if (existeCssFaux && !oItem.selectionne){if (montrerFauxNonSelectionne){lclasse+=" STY_reponseQCFaux";}} else {lclasse+=" STY_reponseQCJuste";}} else if (oItem.selectionne && existeCssFaux){lclasse+=" STY_reponseQCFaux";}PF_changeClasse("lien"+oItem.id,lclasse);}}if (afficheBordure && !this.afficheBoutons){if (montreFaux && !classeCSSExiste(".STY_bordureQCFaux")){return;}var existeCssFaux=(montreFaux && classeCSSExiste(".STY_bordureQCFaux"));for (var i=0;i<this.tabItems.length;i++){var oItem=this.tabItems[i];var lclasse="STY_bordureQC";if (oItem.selectionne){lclasse+=" STY_bordureQCDessus";}if (oItem.estJuste){if (existeCssFaux && !oItem.selectionne){if (montrerFauxNonSelectionne){lclasse+=" STY_bordureQCFaux";}} else {lclasse+=" STY_bordureQCJuste";}} else if (oItem.selectionne && existeCssFaux){lclasse+=" STY_bordureQCFaux";}PF_changeClasse("tdRep"+oItem.id,lclasse);}return ;}if (!this.afficheBoutons){return;}if (montreFaux && !classeCSSExiste(".STY_imgBoutonQCFaux")){return;}var existeCssFaux=(montreFaux && classeCSSExiste(".STY_imgBoutonQCFaux"));for (var i=0;i<this.tabItems.length;i++){var oImg=PF_donneObjet("boutonRep"+this.tabItems[i].id);var lclasse="STY_imgBoutonQC"+this.ajoutClasseFirefox;if (this.tabItems[i].estJuste){if (existeCssFaux && !this.tabItems[i].selectionne){if (montrerFauxNonSelectionne){lclasse+=" STY_imgBoutonQCFaux";}} else {lclasse+=" STY_imgBoutonQCSol";}} else if (this.tabItems[i].selectionne && existeCssFaux){lclasse+=" STY_imgBoutonQCFaux";}oImg.className=lclasse;}}function exo_enleverCorrection(){if (!this.existeClasseCorrection){return;}if (classeCSSExiste(".STY_reponseQCJuste")){for (var i=0;i<this.tabItems.length;i++){var oItem=this.tabItems[i];var lclasse="STY_reponseQC";if (oItem.selectionne){lclasse="STY_reponseQCSel";}PF_changeClasse("lien"+oItem.id,lclasse);}}if (afficheBordure && !this.afficheBoutons){for (var i=0;i<this.tabItems.length;i++){var oItem=this.tabItems[i];var lclasse="STY_bordureQC";if (oItem.selectionne){lclasse+=" STY_bordureQCDessus";}PF_changeClasse("tdRep"+oItem.id,lclasse);}return;}if (!this.afficheBoutons){return;}for (var i=0;i<this.tabItems.length;i++){var oImg=PF_donneObjet("boutonRep"+this.tabItems[i].id);var lclasse="STY_imgBoutonQC"+this.ajoutClasseFirefox;oImg.className=lclasse;}}function exo_marquerSuggestionRef(ref){if (!this.existeClasseSuggRef){return;}var oItem=this.donneItem(ref);var oLien=PF_donneObjet("lien"+oItem.id);if (oLien.className.indexOf("STY_reponseQCSuggRef")<0){oLien.className+=" STY_reponseQCSuggRef";}}function exo_effacerMarqueSuggestionRef(){if (!this.existeClasseSuggRef){return;}for (var i=0;i<this.tabItems.length;i++){var oItem=this.tabItems[i];var oLien=PF_donneObjet("lien"+oItem.id);if (oLien.className.indexOf("STY_reponseQCSuggRef")>0){oLien.className=oLien.className.replace(" STY_reponseQCSuggRef","");}}}function exo_solutions(){if (this.existeClasseCorrection){return this.corrigerReponses(false);}this.initialiser();this.actif=true;for (var i=0;i<this.tabItems.length;i++){if (this.tabItems[i].estJuste){this.action(this.tabItems[i].id);}}}function EXO_peutVoirMesReponses(){return !exo.existeClasseCorrection;}function exo_donneSuggestion(){var res=null;var i=0;while (i<exo.indications.length){if (exo.indications[i].id.indexOf('divSugg')==0){var ref=exo.indications[i].ref;if (ref!=''){var oItemRef=this.donneItem(ref);if (oItemRef!=null && oItemRef.selectionne &&(suggestionDejaAffiche.indexOf(exo.indications[i].id+',')<0)){res=exo.indications[i];break;}}}i++;}if (res==null){i=0;while (i<exo.indications.length){if ((exo.indications[i].id.indexOf('divSugg')==0)&&(exo.indications[i].ref=='')&&(suggestionDejaAffiche.indexOf(exo.indications[i].id+',')<0)){res=exo.indications[i];break;}i++;}}return res;}function exo_donneTabReponses(){var tabRep=new Array();var tabInteraction=new Array();tabInteraction[0]=this.valide;var chReps="";var txtDesc="";for (var idRep=0;idRep<this.tabItems.length;idRep++){if (this.tabItems[idRep].selectionne){if (chReps!=''){chReps+="[,]";}chReps+=this.tabItems[idRep].id;if (txtDesc!=''){txtDesc+=", ";}txtDesc+=texteReponse("lien"+this.tabItems[idRep].id);}}tabInteraction[1]=chReps;tabInteraction[2]="qc";tabInteraction[3]=txtDesc;tabRep[0]=tabInteraction;return tabRep;}function exo_afficherMesReponses(tabRep){if (tabRep.length!=1){return false;}this.actif=true;var oInteraction=tabRep[0];var lesreps=oInteraction.learner_response.split("[,]");for (var j=0;j<lesreps.length;j++){if (lesreps[j]!=''){this.action(lesreps[j]);}}}function ItemReponse(id){ this.id=decodeX(id);this.selectionne=false;this.estJuste=false; this.prerequis; this.poids=1;this.objectif;this.init=initItemReponse;}function initItemReponse(styleR,pre,poi,objectif){styleR=styleR.substring(styleR.length-1);if (styleR=="1"){this.estJuste=true;}this.prerequis=pre;this.objectif=objectif; if (poi!=""){this.poids=Number(poi);}}function doubleClicPgExercice(ccar){if (etatEval){return ;}if (ccar==33){STG_allerPrecedent();}if (ccar==34){if (actionD && !actionValider){EXO_valider();} else {STG_allerSuivant();}}}function actionTouchePgSuivante(glissade){if (glissade){if (etatSuivant && GEN_suivantPossible()){return STG_allerSuivant();}if (actionD && !exo.valide && exo.actif){return EXO_valider();}return;}if (actionValider){if (etatSuivant){ STG_allerSuivant();}} else {if (indexLienOuvert>=0 && indexLienOuvert<exo.tabItems.length){exo.changerBouton(exo.tabItems[indexLienOuvert].id,false);}indexLienOuvert++;if (indexLienOuvert>=exo.tabItems.length){indexLienOuvert=0;}exo.action(exo.tabItems[indexLienOuvert].id);}}function actionTouchePgPrecedente(glissade){if (glissade){if (GEN_precedentPossible()){return STG_allerPrecedent();}return;}if (actionValider){STG_initialiser();} else {if (!actionD && !actionValider && etatPrecedent){return STG_allerPrecedent();}if (indexLienOuvert<0){indexLienOuvert=exo.tabItems.length-1;}exo.action(exo.tabItems[indexLienOuvert].id);exo.changerBouton(exo.tabItems[indexLienOuvert].id,false);}}function texteReponse(idr){var obj=PF_donneObjet(idr);var vDesc=parent.XML_texteNoeud(obj);if (vDesc==""){var lesimg=obj.getElementsByTagName("img");if (lesimg.length>0){vDesc=lesimg[0].title;}}return vDesc;}function decodeX(va){var res="";for (var i=0;i<va.length;i++){var car=va.charAt(i);switch(car){case '3' : res+="0";break;case '8' : res+="1";break;case '7' : res+="2";break;case '9' : res+="3";break;case '1' : res+="7";break;case '0' : res+="8";break;case '2' : res+="9";break;default : res+=car;}}return res;}
