/* EDIT */var BLOQUE_STYLE=false;var STYLE_ITEM_CTXT='style="display:block;min-width:10em;cursor:default;color:#000000; text-decoration: none; padding-top: 2px; padding-right: 0px; padding-bottom: 4px; padding-left: 7px; border:1px solid #ffffff;" onmouseover="this.style.backgroundColor=\'#F7F0A1\';this.style.borderColor=\'#ECE05A\';" onmouseout="this.style.backgroundColor=\'\';this.style.borderColor=\'#ffffff\'"';var peutEnregistrer=false;var memoCmtClic='';var objetSelectCourant=null;var peutEditerDispo=false;var peutEditerCmt=false;var oBarreContext=window.createPopup();document.body.oncontextmenu=EDIT_contextMenu;function EDIT_contextMenu(){var res='<div style="background-color:#ffffff;font-family:Tahoma,Arial;font-size:13px;border:1px solid #444444;border-bottom-width:2px;border-right-width:2px">';var hMenu=32;var peutGnr=false;if (window.location.href.indexOf(fenPere.parent.contenu.codeCourant+".xml")>0){peutGnr=true;}var longueur=170;if (MODE_EDIT){var numprevu=1;if (peutGnr&&peutEnregistrer){res+=creeItemMenu('EDIT_enregistrer()',2);hMenu+=20;numprevu=4;} res+=creeItemMenu('EDIT_recharger()',numprevu);} else {if (peutGnr){if (fenPere.parent.menu.DOMMDStyle.documentElement.getAttribute("editMTR")=="non"){BLOQUE_STYLE=true;}if (fenPere.parent.contenu.SPE_existeCmts()||existeMosMap || ((typePage=="exercice")&&(exo.type=="GD"))){res+=creeItemMenu('EDIT_editer(false)',5);longueur=200;hMenu+=20;if (fenPere.parent.menu.LANGUE=='de'){longueur=240;}}if (!BLOQUE_STYLE){res+=creeItemMenu('EDIT_editer(true)',0);hMenu+=20;}}if (positionPerso!=''&&peutGnr){res+=creeItemMenu('EDIT_retablir()',3);hMenu+=20;}if (fenPere.parent.menu.styleDansMosData){res+=creeItemMenu('EDIT_majStyle()',6);hMenu+=20;}res+=creeItemMenu('EDIT_recharger()',1);}oBarreContext.show(window.event.screenX+5,window.event.screenY+5,longueur,hMenu);oBarreContext.document.body.innerHTML =res+'</div>';return false;}function creeItemMenu(nomFonction,numL){var langGnr=fenPere.parent.menu.LANGUE.substring(0,2);var tabCtx=new Array('Edit Layout','Reload Page','Save','Reset Layout','Cancel','Position Floating Objects','Update Style');if (langGnr=='fr'){tabCtx=new Array('Modifier la disposition','Recharger la page','Enregistrer','R\xE9tablir la disposition','Annuler','Positionner les objets flottants','Mettre \xE0 jour le style');} else if (langGnr=='it'){tabCtx=new Array('Modifica disposizione','Ricarica la pagina','Salva','Resetta il layout','Annullare','Posiziona gli oggetti mobili','Aggiornare lo stile');} else if (langGnr=='de'){tabCtx=new Array('Layout bearbeiten','Seite aktualisieren','Speichern','Layout zur\xFCcksetzen','Abbrechen','Schwebende Elemente positionieren','Stil aktualisieren');}var item='<a hideFocus="true" onclick="parent.'+nomFonction+'" '+STYLE_ITEM_CTXT+'>'+tabCtx[numL]+'</a>';return item;}function EDIT_recharger(){oBarreContext.hide();window.location.reload(true);}function EDIT_retablir(){divsEdites=',';EDIT_enregistrer();}function EDIT_toucheClavier(evt){if (evt==null){evt=window.event;}if (MODE_EDIT){if (evt.keyCode==46) {var range = document.selection.createRange();var typeSel=document.selection.type.toLowerCase();if (typeSel=="control"){var lid=range.item(0).id;if ((range.item(0).tagName=="DIV")&&(EDIT_bonID(lid))){EDIT_marqueDiv(lid);} else {window.event.cancelBubble=true;return false;} }}}}function EDIT_bonID(lid){var res=false;if ((lid!=null)&&(lid!='')){if ((!BLOQUE_STYLE) || EDIT_estCmt(lid)){res=true;}}return res;}function EDIT_supprimeMasque(idObj){var oZonS=PF_donneObjet(idObj);if ((oZonS!=null)&&(oZonS.style.display=="none")){oZonS.parentNode.removeChild(oZonS);}}function EDIT_estCmt(lid){if (lid.indexOf("AP_PNG")>0){return false;}return (lid.indexOf('divCmt')==0 || lid.indexOf('divSugg')==0 || lid.indexOf('divConsigne')==0 || lid.indexOf('MosMap')==0 || lid.indexOf('exoGDd')==0);}function EDIT_editer(modeStyle){oBarreContext.hide();peutEditerDispo=false;peutEditerCmt=false;if (modeStyle){MODE_MODIF="disposition";peutEditerDispo=true;}else {MODE_MODIF="flottant";peutEditerCmt=true;}document.onkeydown=EDIT_toucheClavier;EDIT_supprimeMasque("STY_zoneTitre");EDIT_supprimeMasque("STY_zoneCommentaire");document.getElementsByTagName("body").item(0).style.height="100%";var lesdivs=document.getElementsByTagName("div");document.body.contentEditable=true;for (var i=0;i<lesdivs.length;i++){var oDiv=lesdivs.item(i);if ((EDIT_bonID(oDiv.id)&&((oDiv.currentStyle['position']=='absolute')||(oDiv.currentStyle['position']=='relative'))) && ((modeStyle && !EDIT_estCmt(oDiv.id)) || (!modeStyle && EDIT_estCmt(oDiv.id) && (oDiv.currentStyle['display']!='none')))) {enleverArrondi(oDiv,true);oDiv.parentNode.onresizestart=EDIT_desactiveAction;oDiv.parentNode.onmovestart=EDIT_desactiveAction;oDiv.onresizeend=EDIT_finRedim;oDiv.onmoveend=EDIT_finDeplacement;oDiv.parentNode.onkeydown=EDIT_deplaceFleche;if(oDiv.currentStyle['borderWidth'].indexOf("medium")>=0){oDiv.style.borderWidth="1px";}if(oDiv.currentStyle['borderStyle'].indexOf("none")>=0){oDiv.style.borderStyle="dashed";oDiv.style.borderBottomWidth="2px";}if (oDiv.id.indexOf('MosMap')==0){oDiv.onmouseover=EDIT_faux;}oDiv.onmovestart=EDIT_debutDep;oDiv.onresizestart=EDIT_debutDim;oDiv.oncontrolselect=EDIT_selectCourant;var lesdivsfils=oDiv.getElementsByTagName("div");for (var j=0;j<lesdivsfils.length;j++){var oDivFils=lesdivsfils.item(j);if (oDivFils.id==''||(oDivFils.currentStyle['position']!='absolute'&&oDivFils.currentStyle['position']!='relative')){oDivFils.contentEditable=false;}}lesdivsfils=oDiv.getElementsByTagName("table");for (var j=0;j<lesdivsfils.length;j++){lesdivsfils.item(j).contentEditable=false;}} else {if (!existeMosMap&&(typePage!="exercice"||exo.type!='GD')){oDiv.contentEditable=false;}if ((modeStyle && !EDIT_estCmt(oDiv.id)) || (!modeStyle && EDIT_estCmt(oDiv.id))){oDiv.oncontrolselect=EDIT_desactiveAction;oDiv.onresizestart=EDIT_desactiveAction;oDiv.onmovestart=EDIT_desactiveAction;} else {oDiv.oncontrolselect=EDIT_desactiveAction;oDiv.onresizestart=EDIT_faux;oDiv.onmovestart=EDIT_desactiveAction;}if (oDiv.currentStyle['display']=='none'){EDIT_cacheDivE(oDiv);oDiv.innerHTML="";}}}var inv=PF_donneObjet("zoneInvisible");if (inv!=null){EDIT_cacheDivE(inv);var lesimg=document.getElementsByTagName("img");for (var i=0;i<lesimg.length;i++){var oimg=lesimg.item(i);oimg.oncontrolselect=EDIT_faux;oimg.contentEditable=false;oimg.onresizestart=EDIT_faux;oimg.onmovestart=EDIT_faux;try{oimg.style.cursor="default";}catch(e){}}}document.execCommand("2D-Position",0,true);MODE_EDIT=true;}function EDIT_cacheDivE(inv){inv.style.fontSize="1px";inv.style.position="absolute";inv.style.left="-100px";inv.style.top="-100px";inv.style.overflow="hidden";inv.style.width="5px";inv.style.height="5px";}function EDIT_faux(){return false;}function EDIT_selectCourant(){objetSelectCourant=window.event.srcElement;window.event.cancleBubble=true;return true;}function EDIT_finRedim(){if (MODE_CSS_STRICT){var obj=window.event.srcElement;if (obj.style.width.indexOf('%')<0){var remp1=diffLargeurStrict(obj)*2;var nval=(obj.offsetWidth-remp1);if (nval>1){obj.style.width=(obj.offsetWidth-remp1)+"px";}}if (obj.style.height.indexOf('%')<0){var remp1=diffHauteurStrict(obj)*2;obj.style.minHeight="";var nval=(obj.offsetHeight-remp1);if (nval>1){obj.style.height=nval+"px";}}}EDIT_finBougeage();}function EDIT_finDeplacement(){var objSrc=window.event.srcElement;if (cmtBougePositionDroite && objSrc.parentNode.offsetWidth){var posG=objSrc.parentNode.offsetWidth-objSrc.offsetWidth-parseInt(objSrc.style.left);objSrc.style.right=posG+"px";objSrc.style.left="";}if (cmtBougePositionBas && objSrc.parentNode.offsetHeight){var posG=objSrc.parentNode.offsetHeight-objSrc.offsetHeight-parseInt(objSrc.style.top);objSrc.style.bottom=posG+"px";objSrc.style.top="";}if (memoCmtClic!=''){var lid=objSrc.id;var oCmt=donneCmtID(lid);if (oCmt!=null){memoCmtClic=memoCmtClic.replace(/px/g,'');var tabP=memoCmtClic.split('/');if (cmtBougePositionDroite){var posFin=parseInt(window.event.srcElement.style.right)-parseInt(tabP[0]);oCmt.posX=posFin+parseInt(oCmt.posX);} else {var posFin=parseInt(window.event.srcElement.style.left)-parseInt(tabP[0]);oCmt.posX=posFin+parseInt(oCmt.posX);}if (cmtBougePositionDroite){posFin=parseInt(window.event.srcElement.style.bottom)-parseInt(tabP[1]);oCmt.posY=posFin+parseInt(oCmt.posY);} else {posFin=parseInt(window.event.srcElement.style.top)-parseInt(tabP[1]);oCmt.posY=posFin+parseInt(oCmt.posY);}}}EDIT_finBougeage();}function EDIT_finBougeage(){}function EDIT_desactiveAction(){var lid=window.event.srcElement.id;if (!EDIT_bonID(lid)){window.focus();return false;}else {EDIT_marqueDiv(lid);}}var cmtBougePositionDroite=false;var cmtBougePositionBas=false;function EDIT_debutDep(){memoCmtClic="";var objSrc=window.event.srcElement;var lid=objSrc.id;if (lid.indexOf('divCmt')==0){var oCmt=donneCmtID(lid);if(oCmt!=null && oCmt.orign=='clic'){var pl=objSrc.style.left;if (pl==""){pl=objSrc.style.right;}var pT=objSrc.style.top;if (pT==""){pT=objSrc.style.bottom;}memoCmtClic=pl+"/"+pT;}}cmtBougePositionDroite=false;cmtBougePositionBas=false;if (objSrc.style.right!=""&&objSrc.parentNode.offsetWidth){var posG=objSrc.parentNode.offsetWidth-objSrc.offsetWidth-parseInt(objSrc.style.right);objSrc.style.left=posG+"px";objSrc.style.right="";cmtBougePositionDroite=true;}if (objSrc.style.bottom!=""&&objSrc.parentNode.offsetHeight){var posG=objSrc.parentNode.offsetHeight-objSrc.offsetHeight-parseInt(objSrc.style.bottom);objSrc.style.top=posG+"px";objSrc.style.bottom="";cmtBougePositionBas=true;}EDIT_marqueDiv(lid);window.event.cancleBubble=true;window.event.returnValue=true;return true;}function EDIT_debutDim(){EDIT_marqueDiv(window.event.srcElement.id);window.event.cancelBubble=true;return true;}function EDIT_marqueDiv(lid){if ((peutEditerCmt && EDIT_estCmt(lid)) || (peutEditerDispo && !EDIT_estCmt(lid))){peutEnregistrer=true;if (divsEdites.indexOf(','+lid+',')<0){divsEdites+=lid+",";}}}function EDIT_enregistrer(){var resGnr='';var resCmt='';oBarreContext.hide();var tabEd=divsEdites.split(",");for (var j=0;j<tabEd.length;j++){var lid=tabEd[j];if (lid!=''){var obj=PF_donneObjet(lid);if (obj!=null){if (lid=="divCmtSucces"){resCmt+=EDIT_ligneEnr("cmtSucces",obj);} else if (lid.indexOf("divCmt")==0){oCmt=donneCmtID(lid);if(oCmt!=null&&oCmt.orign=='clic'){ resCmt+="cmt_"+lid.substring(6)+"/left:"+oCmt.posX+"px;top:"+oCmt.posY+"px;"+EDIT_attrS("width",obj.style.width)+EDIT_attrS("height",obj.style.height)+"#";} else if(oCmt!=null && oCmt.orign=='zone'){var oZn=PF_donneObjet(oCmt.idZoneLiee);if (oZn){var decalX=obj.offsetLeft-oZn.offsetLeft;var decalY=obj.offsetTop-oZn.offsetTop;resCmt+="cmt_"+lid.substring(6)+"/left:"+decalX+"px;top:"+decalY+"px;"+EDIT_attrS("width",obj.style.width)+EDIT_attrS("height",obj.style.height)+"#";} else { resCmt+="cmt_"+lid.substring(6)+"/left:"+oCmt.posX+"px;top:"+oCmt.posY+"px;"+EDIT_attrS("width",obj.style.width)+EDIT_attrS("height",obj.style.height)+"#"; }} else {resCmt+=EDIT_ligneEnr("cmt_"+lid.substring(6),obj);}} else if (lid=="divConsigne"){resCmt+=EDIT_ligneEnr("consigne",obj);} else if (lid.indexOf("divSugg")==0){resCmt+=EDIT_ligneEnr("sugg_"+lid.substring(7),obj);} else if (lid.indexOf("MosMap")==0){var objXMLGnr=fenPere.parent.menu.XML_trouveNoeud(fenPere.parent.contenu.DOMPageCourante,"zoneLien","id",lid);if (objXMLGnr!=null){var oImg=PF_donneObjet(objXMLGnr.getAttribute("refImg"));if (oImg!=null){objXMLGnr.setAttribute("gauche",parseInt(obj.style.left)-oImg.offsetLeft);objXMLGnr.setAttribute("haut",parseInt(obj.style.top)-oImg.offsetTop);var atrStyle="display:block;position:absolute;left:"+obj.style.left+";top:"+obj.style.top+";width:"+obj.style.width+";height:"+obj.style.height;objXMLGnr.setAttribute("style",atrStyle);var objHTML=fenPere.parent.contenu.PF_donneObjet(lid);objHTML.style.left=obj.style.left;objHTML.style.top=obj.style.top;objHTML.style.width=obj.style.width;objHTML.style.height=obj.style.height;}}} else if ((lid.indexOf("champTrou")==0)&& exo){} else if (lid.indexOf("exoGD")==0){GD_enrDecalage(lid);} else {resGnr+=EDIT_ligneEnr(lid,obj);}} else {resGnr+=lid+"/supprime:;#";}}}fenPere.parent.contenu.GTR_persitePositons(resGnr,resCmt,document.body.offsetWidth,document.body.offsetHeight);peutEnregistrer=false;setTimeout(EDIT_recharger,200)}function EDIT_ligneEnr(lid,obj){var posX=EDIT_attrS("left",obj.style.left);if (posX==""){posX=EDIT_attrS("left",obj.style.right);}var posY=EDIT_attrS("top",obj.style.top);if (posY==""){posY=EDIT_attrS("top",obj.style.bottom);}return lid+"/"+posX+posY+EDIT_attrS("width",obj.style.width)+EDIT_attrS("height",obj.style.height)+"#";}function EDIT_attrS(attr,val){var res='';if (val!=''){res=attr+":"+val+";";}return res;}function EDIT_deplaceFleche(){var codeC=window.event.keyCode;var majus=false;if (window.event.shiftKey){majus=true;}if ((codeC>36)&&(codeC<41)&& objetSelectCourant){window.event.cancelBubble=true;if (codeC==38){var valp=ajoutePixelPos(objetSelectCourant.currentStyle["top"],majus,true);if (valp!=''){objetSelectCourant.style.top=valp}} else if (codeC==40){var valp=ajoutePixelPos(objetSelectCourant.currentStyle["top"],majus,false);if (valp!=''){objetSelectCourant.style.top=valp}} else if (codeC==37){var valp=ajoutePixelPos(objetSelectCourant.currentStyle["left"],majus,true);if (valp!=''){objetSelectCourant.style.left=valp}} else if (codeC==39){var valp=ajoutePixelPos(objetSelectCourant.currentStyle["left"],majus,false);if (valp!=''){objetSelectCourant.style.left=valp}}EDIT_marqueDiv(objetSelectCourant.id);return false;}}function ajoutePixelPos(valPx,maj,inverse){var resStr="";if (valPx.length>1){var ajV=1;if (maj){ajV=10;}if (inverse){ajV=-ajV;}var indFin=valPx.indexOf("px");if (indFin<0){ indFin=valPx.indexOf("%");}var num=parseInt(valPx.substring(0,indFin));num+=ajV;resStr=num+valPx.substring(indFin);}return resStr;}function EDIT_majStyle(){fenPere.parent.menu.GTR_majStyle(false);EDIT_recharger();}function EDIT_attrDim(obj,attr){var val=retrouveValCSS(obj,attr);var res=0;if (val.indexOf('px')>0){res=parseInt(val);}return res;}function diffLargeurStrict(obj){return EDIT_attrDim(obj,"padding-left")+EDIT_attrDim(obj,"padding-right")+EDIT_attrDim(obj,"border-left-width")+EDIT_attrDim(obj,"border-right-width");}function diffHauteurStrict(obj){return EDIT_attrDim(obj,"padding-top")+EDIT_attrDim(obj,"padding-bottom")+EDIT_attrDim(obj,"border-top-width")+EDIT_attrDim(obj,"border-bottom-width");}/* fin EDIT */function initPgRdr(idEtp,idPg){if (idEtp==""){return window.location.replace("index.html");}window.location.replace("../../index.html?sco="+idEtp+"&idPg="+idPg);}
