var lienCourant;var etatBasculeItems=true;var largeurColZero='';var oFenetre=null;var titreStage;var itemRacine=null;var itemCourant=null;var itemSuspendu=null;var DOMManifest=null;var ressourceCourante=null;var progIDMSXML;var itemsSynchro='';var numAffichageParcours=0;var pageSpecifieeParLienPage="";var dernierItemLance=null;var largeurPlanFerme="0";var auraitDuMettreAJourPlan=false;var masqueSortie=false;var masqueSuspendre=false;var masqueSuivant=false;var masquePrecedent=false;var modeExploration="";var limiteHeures="";var codeGroupeParc="";var largeurPlanInitiale=0;var PLAN_FEN_X,PLAN_FEN_Y,PLAN_FEN_L,PLAN_FEN_H;var planPopupRelMenu=false;var SUIVI_DESACTIVE=false;var PLAN_DESACTIVE=false;var RECHERCHE_POSSIBLE=false;var tabItemsVerif;var oRegScheme;var oCommentairesLMS=null;var supprimerBalises=true;var existeChoixSortie=false;var existeLienItmRacine=false;var gardeCouleurChamp="";var nbSecDemo=30;var TEMPS_INACTIF_AUTORISE=10;var OBJ_GLOBAL_SYSTEM=true;var FIGER_ETAT_ITEM=false;var FIGER_MEILLEUR_RESULTAT=false;var COMPATIBLE_SCORM12=false;var OBJ_DESACTIVE_ITEM="";var OBJECTIFS_ADLSEQ=false;var RETOUR_DERNIER_SUSPENDU=false;function initPlanLMS(){if (parent.RACINE_stage==null){return ;}if (parent.donneParam("txrtl")=="1" || (parent.TXT_DIR_RTL && parent.TXT_DIR_RTL=="oui")){document.body.dir="rtl";}var cadreListe = donneCadreIndex("planLMS");if (cadreListe.offsetWidth>5){largeurPlanInitiale=cadreListe.offsetWidth;}if (parent.LISTE_BL && parent.LISTE_BL>0){largeurColZero=parent.LISTE_BL;largeurPlanFerme=largeurPlanInitiale;}oRegScheme=new RegExp("^\\w+:///?\\w+");DOMManifest=parent.IU_objDom();progIDMSXML=parent.progIDMSXML;appliqueDefautNS(DOMManifest);var succ=false;var doitNettoyerMani=true;if (parent.depuisFenGNR && top.opener.top.menu.cacheMTRManiXML!=""){succ=DOMManifest.loadXML(top.opener.top.menu.cacheMTRManiXML);if (succ){doitNettoyerMani=false;}}if (!succ){var chemMani=parent.RACINE_stage+"imsmanifest.xml";if (parent.SUR_CHORUS){chemMani=parent.RACINE_MOS+"MosSrv/aspx/envoiManifeste.aspx?stg="+parent.serveur.codeStage;if (parent.SUR_CHORUS_ADM && parent.oUtilCnx.id()=="_demovsr"){chemMani+="&vrole=demo&idAdm="+top.opener.top.opener.oUtilCnx.id();} else if (parent.SUR_CHORUS_ADM){chemMani+="&vrole=adm&idAdm="+top.opener.top.usrCnx.id();} else if (parent.SYNC_CORRIGE_ITEM!=""){chemMani+="&vrole=sync";} else {chemMani+=parent.serveur.nCnx();}supprimerBalises=false;} else if (parent.depuisFenGNR && top.opener.top.menu.location.href.indexOf(".aspx")>0){parent.RACINE_MOS=parent.RACINE_stage.substring(0,parent.RACINE_stage.indexOf("/MosPub/")+1);chemMani=parent.RACINE_MOS+"MosSrv/aspx/envoiManifeste.aspx?stg="+parent.serveur.codeStage+"&vrole=aut&idAdm="+top.opener.top.menu.idUtil;supprimerBalises=false;}succ=DOMManifest.load(chemMani);}if (!succ || (DOMManifest.documentElement.nodeName!="manifest")){alert("Error while loading the manifest for "+parent.serveur.codeStage);} else {if (PF_attr(DOMManifest.documentElement,"idCnx")!=""){parent.serveur.vMos_id=prendAttrEtEnleve(DOMManifest,"idCnx");parent.oUtilCnx=new parent.IU_Utilisateur(parent.serveur.vMos_id);parent.serveur.vMos_lang=prendAttrEtEnleve(DOMManifest,"langueCnx");parent.serveur.vMos_nom=prendAttrEtEnleve(DOMManifest,"nomCnx");parent.serveur.vMos_prenom=prendAttrEtEnleve(DOMManifest,"prenomCnx");}if (parent.SUR_CHORUS_ADM && parent.serveur.vMos_nom=="DEMO" && parent.serveur.vMos_prenom=="DEMO"){var nbsec=prendAttrEtEnleve(DOMManifest,"secondesDemo");if (nbsec!=""){nbSecDemo=parseInt(nbsec);}if (nbSecDemo>600){nbSecDemo=600;}setTimeout("parent.LMS_finDemo()",1000*nbSecDemo);}if (parent.tabLex==null && parent.SYNC_CORRIGE_ITEM==""){parent.IU_chargerLangue(parent.serveur.vMos_lang);}COMPATIBLE_SCORM12=modeCompat12(DOMManifest.documentElement);DOMManifest.documentElement.removeAttribute("xsi:schemaLocation");itemRacine=parent.XML_premierNoeud(DOMManifest.documentElement,"organization");if (itemRacine==null){alert("Organization not found");}if (deliveryControls(itemRacine,"tracked")=="false"){SUIVI_DESACTIVE=true;parent.lesson_mode="browse";}parent.serveur.titreStage=parent.XML_texteNoeud(parent.XML_premierNoeud(DOMManifest.documentElement,"title"));parent.document.title=parent.serveur.titreStage;if (parent.SUR_CHORUS && parent.donneParam("cditrm")=="1"){parent.parent.document.title=parent.serveur.titreStage;}var arboHtml;if (parent.SYNC_CORRIGE_ITEM==""){var oCss=PF_donneObjet("feuilleStylePlan");oCss.href = parent.RACINE_STYLE+"css/planLMS.css";var corpsPlanLMS=PF_donneObjet("corpsPlanLMS");if (parent.depuisFenGNR && top.opener.top.menu.cacheMTRPlanCorpsHTML!=""){corpsPlanLMS.innerHTML=top.opener.top.menu.cacheMTRPlanCorpsHTML;} else {parent.renduXSLSub(null,"planLMS",corpsPlanLMS);if (parent.depuisFenGNR){top.opener.top.menu.cacheMTRPlanCorpsHTML=corpsPlanLMS.innerHTML;}}/*if (controlMode(itemRacine,"choice")=="false"){ PLAN_DESACTIVE=true; PLAN_affichagePlan("non"); corpsPlanLMS.style.visibility="hidden";}*/oFenetre=parent.document.getElementById("cadreListe");if (oFenetre!=null){parent.LISTE_L="";}if (!parent.estMoz){if (progIDMSXML=="Msxml2.DOMDocument.6.0"){parent.objXSL.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");}PLAN_FEN_X=initDimPopup("FEN_X");PLAN_FEN_Y=initDimPopup("FEN_Y");PLAN_FEN_L=initDimPopup("FEN_L");PLAN_FEN_H=initDimPopup("FEN_H");if (PLAN_FEN_X!=''&&PLAN_FEN_Y!=''&&PLAN_FEN_L!=''){if (parent.depuisFenGNR){top.opener.top.menu.cacheMTRPlanCorpsHTML="";}if (PLAN_FEN_X!=''){if (PLAN_FEN_X.indexOf(".")==0){planPopupRelMenu=true;PLAN_FEN_X=PLAN_FEN_X.substring(1);}PLAN_FEN_X=Number(PLAN_FEN_X);if (PLAN_FEN_X<0){PLAN_FEN_X=window.screen.width+PLAN_FEN_X;}}if (PLAN_FEN_Y!=''){PLAN_FEN_Y=Number(PLAN_FEN_Y);if (PLAN_FEN_Y<0){PLAN_FEN_Y=window.screen.height+PLAN_FEN_Y;}}if (oFenetre==null){PLAN_affichagePlan('non');if (PLAN_FEN_H==0){PLAN_FEN_H='';}try {oFenetre=window.createPopup();} catch(e){}if (oFenetre!=null && window.location.href.indexOf("http")==0){var cadres = parent.document.getElementById("frame2");if (parent.PLAN_DROIT){cadres.cols="*,1";} else {cadres.cols="1,*";}}}}}PF_modifTexteDiv("STY_planTitreFormation",parent.serveur.titreStage);var planItmRacine=PF_donneObjet("STY_planItmRacine");if (planItmRacine!=null){planItmRacine.innerHTML="<a class=\"STY_planLienItmRacine\" id=\"lienP_racine\" href=\"javascript:clicItem('_racine')\">"+parent.serveur.titreStage+"</a>";existeLienItmRacine=true;itemRacine.setAttribute("nom","_racine");}var chenGenXSL=parent.RACINE_MOS+"MosSrv/xsl/util";if (!parent.SUR_CHORUS){chenGenXSL=parent.RACINE_stage+"MosMtr/xsl";}if (parent.depuisFenGNR && top.opener.top.menu.cacheMTRPlanXSL!=""){parent.objXSL.loadXML(top.opener.top.menu.cacheMTRPlanXSL);} else {var succ=parent.objXSL.load(chenGenXSL+"/GEN_planLMS.xsl");if (!succ){alert("Can't load GEN_planLMS.xsl");return ;}if (parent.depuisFenGNR){top.opener.top.menu.cacheMTRPlanXSL=parent.serialiserXML(parent.objXSL);}}itemRacine.setAttribute("chemImg",parent.RACINE_STYLE+"media/gen/");arboHtml=PF_donneObjet("STY_planArborescence");if (parent.activiteUnique){var idSco=parent.donneParam("sco");var oItem=parent.XML_trouveNoeud(DOMManifest.documentElement,"item","identifier",idSco);var ofils=itemRacine.firstChild;var copie;if (oItem!=null){copie=oItem.cloneNode(true);}while (ofils!=null){itemRacine.removeChild(ofils);ofils=itemRacine.firstChild;}if (copie){itemRacine.appendChild(copie);}}}if (doitNettoyerMani){var oRessources=parent.XML_fils(DOMManifest.documentElement,"resources");var lesitems=parent.XML_listeParBalise(itemRacine,"item");var tabItemsExpand=new Array();if (oRessources!=null){ for (var i=0;i<lesitems.length;i++){ tabItemsExpand[i]=lesitems[i]; } }for (var i=0;i<tabItemsExpand.length;i++){var itemTmp=tabItemsExpand[i];if (!relierNoeudExterne(itemTmp,oRessources)){return ;}}}var lesitems=parent.XML_listeParBalise(itemRacine,"item");if (parent.SYNC_CORRIGE_ITEM==""){var ressarb="";if (parent.depuisFenGNR && top.opener.top.menu.cacheMTRPlanLMS!=""){ressarb=top.opener.top.menu.cacheMTRPlanLMS;} else {for (var i=0;i<lesitems.length;i++){var pos=i+1;lesitems[i].setAttribute("nom","item"+pos);}ressarb=parent.transformeXSL(itemRacine,parent.objXSL);if (parent.depuisFenGNR){top.opener.top.menu.cacheMTRPlanLMS=ressarb;}}arboHtml.innerHTML=ressarb;}if (parent.SUR_CHORUS && !parent.SUR_CHORUS_ADM && parent.SYNC_CORRIGE_ITEM==""){if (PF_attr(DOMManifest.documentElement,"nvStgLms")=="1"){return;}}itemRacine.removeAttribute("chemImg");if (doitNettoyerMani){for (var i=0;i<lesitems.length;i++){var itemTmp=lesitems[i];var titre=itemTmp.firstChild;if (titre!=null){if (titre.nodeName=="title"){itemTmp.removeChild(titre);}}}if (supprimerBalises){if (oRessources!=null){var oFile=parent.XML_premierNoeud(oRessources,"file");while (oFile!=null){oFile.parentNode.removeChild(oFile);oFile=parent.XML_premierNoeud(oRessources,"file");}oFile=parent.XML_premierNoeud(oRessources,"dependency");while (oFile!=null){oFile.parentNode.removeChild(oFile);oFile=parent.XML_premierNoeud(oRessources,"dependency");}}var oMetadata=parent.XML_premierNoeud(DOMManifest.documentElement,"metadata");while (oMetadata!=null){oMetadata.parentNode.removeChild(oMetadata);oMetadata=parent.XML_premierNoeud(DOMManifest.documentElement,"metadata");}}var sequencingCollection=parent.XML_filsNS(DOMManifest.documentElement,"imsss","sequencingCollection");if (sequencingCollection){var lesobjs=donneNoeudsNS(DOMManifest.documentElement,"imsss","sequencing");for (var n=0;n<lesobjs.length;n++){var lid=PF_attr(lesobjs[n],"IDRef");if (lid!=reduitEspaceID(lid)){lesobjs[n].setAttribute("IDRef",reduitEspaceID(lid));}}var tabFilsColl=parent.XML_tabElementFils(sequencingCollection);for (var i=0;i<tabFilsColl.length;i++){var oSeqColl=tabFilsColl[i];var lid=oSeqColl.getAttribute("ID");if (lid!=null){lid=reduitEspaceID(lid);var oSeqItem=parent.XML_trouveNoeudNS(itemRacine,"imsss","sequencing","IDRef",lid);while (oSeqItem!=null){var tabInterneSeq=parent.XML_tabElementFils(oSeqColl);for (var j=0;j<tabInterneSeq.length;j++){var oElt1=tabInterneSeq[j];var nomelt=oElt1.nodeName;if (nomelt.indexOf(":")<0){nomelt="imsss:"+nomelt;}nomelt=nomelt.split(":");var oEnLigne=parent.XML_filsNS(oSeqItem,nomelt[0],nomelt[1]);if (oEnLigne==null){oSeqItem.appendChild(oElt1.cloneNode(true));}}oSeqItem.removeAttribute("IDRef");oSeqItem=parent.XML_trouveNoeudNS(itemRacine,"imsss","sequencing","IDRef",lid);}}}sequencingCollection.parentNode.removeChild(sequencingCollection);}if (parent.depuisFenGNR){top.opener.top.menu.cacheMTRManiXML=parent.serialiserXML(DOMManifest.documentElement);}}if (parent.XML_trouveNoeudNS(itemRacine,"imsss","controlMode","choiceExit","false")!=null){existeChoixSortie=true;} else if (parent.XML_premierNoeudNS(itemRacine,"adlseq","constrainedChoiceConsiderations")!=null){existeChoixSortie=true;}if (parent.XML_premierNoeudNS(itemRacine,"adlseq","objective")!=null){OBJECTIFS_ADLSEQ=true;}/*var sousmanifest=parent.XML_fils(DOMManifest.documentElement,"manifest");while (sousmanifest!=null){if (oRessources==null){oRessources=DOMManifest.documentElement.createElement(resources);}var oRessourcesSub=parent.XML_premierNoeud(sousmanifest,"resources");if (oRessourcesSub!=null){while (oRessourcesSub.childNodes.length>0){oRessources.appendChild(oRessourcesSub.firstChild);}}DOMManifest.documentElement.removeChild(sousmanifest);sousmanifest=parent.XML_fils(DOMManifest.documentElement,"manifest");}*/tabItemsVerif=new Array();var lesitems=parent.XML_listeParBalise(itemRacine,"item");for (var i=0;i<lesitems.length;i++){var itemTmp=lesitems[i];var prend=false;if (limitConditions(itemTmp,"attemptLimit")!="0" || limitConditions(itemTmp,"attemptAbsoluteDurationLimit")!="0.0" || controlMode(itemTmp,"forwardOnly")=="true" || constrainedChoiceConsiderations(itemTmp,"preventActivation")=="true"){prend=true;}if (!prend){var objr=donneRegles(itemTmp);if (objr!=null){var tabFOr=parent.XML_tabElementFils(objr);for (var k=0;k<tabFOr.length;k++){var action=parent.XML_filsNS(tabFOr[k],"imsss","ruleAction");var laction=PF_attr(action,"action");if (laction=="disabled" || laction=="hiddenFromChoice" || laction=="stopForwardTraversal"){prend=true;k=99;if (laction=="stopForwardTraversal"){existeChoixSortie=true;}if (laction=="hiddenFromChoice"){var oDansPlan=PF_donneObjet("div"+PF_attr(itemTmp,"nom"));if (oDansPlan!=null){oDansPlan.style.display="none";oDansPlan=PF_donneObjet("divfils"+PF_attr(itemTmp,"nom"));if (oDansPlan!=null){oDansPlan.style.display="none";}}}}}}}if (prend){tabItemsVerif.push(itemTmp.getAttribute("identifier"));}}if (PF_attr(itemRacine,"adlseq:objectivesGlobalToSystem")=="false"){OBJ_GLOBAL_SYSTEM=false;}if (PF_attr(itemRacine,"freezeCompletedItem")=="true"){FIGER_ETAT_ITEM=true;} else {if (parent.XML_trouveNoeudNS(itemRacine,"adlcp","map","targetID","MosMemoEtatParcours")!=null){FIGER_ETAT_ITEM=true;}}if (PF_attr(itemRacine,"keepBestResult")=="true"){FIGER_MEILLEUR_RESULTAT=true;FIGER_ETAT_ITEM=true;}if (PF_attr(itemRacine,"goToLastSuspendedItem")=="true"){RETOUR_DERNIER_SUSPENDU=true;itemRacine.removeAttribute("goToLastSuspendedItem");}OBJ_DESACTIVE_ITEM=PF_attr(itemRacine,"disableOutlineItem");if ((parent.FICH_PARCOURS!=""||parent.SUR_CHORUS) && !parent.activiteUnique && !parent.SUR_CHORUS_ADM){var oRacParc=null;var succ=false;DOMManifest.documentElement.removeAttribute("numAcces");if (!FIGER_ETAT_ITEM && PF_attr(itemRacine,"identifier").indexOf("MosOrg")!=0){reduireIdObjs("imsss");if (OBJECTIFS_ADLSEQ){reduireIdObjs("adlseq");}reduireIdentifiantsPlan("item");reduireIdentifiantsPlan("resource");reduireIdentifiantsPlan("organization");}var objectifsALire=";";var lesmaps=donneNoeudsNS(itemRacine,"imsss","mapInfo");if (lesmaps.length==0){lesmaps=donneNoeudsNS(itemRacine,"","mapInfo");}for (var n=0;n<lesmaps.length;n++){var oMap=lesmaps[n];if (PF_attr(oMap,"readSatisfiedStatus")!="false"||PF_attr(oMap,"readNormalizedMeasure")!="false"){var lido=PF_attr(oMap,"targetObjectiveID");if (objectifsALire.indexOf(";"+lido+";")<0){objectifsALire+=lido+";";}/*oMap.parentNode.parentNode.parentNode.parentNode.setAttribute("doRollup","true");rollupMultiple=true;*/}}if (OBJECTIFS_ADLSEQ){lesmaps=donneNoeudsNS(itemRacine,"adlseq","mapInfo");for (var n=0;n<lesmaps.length;n++){var oMap=lesmaps[n];if (PF_attr(oMap,"readCompletionStatus")!="false"||PF_attr(oMap,"readProgressMeasure")!="false"){var lido=PF_attr(oMap,"targetObjectiveID");if (objectifsALire.indexOf(";"+lido+";")<0){objectifsALire+=lido+";";}}}}var DOMParc=parent.IU_objDom();if (parent.SUR_CHORUS){var tabParam=new Array();tabParam[0]="userID##"+parent.serveur.vMos_id;tabParam[1]="courseID##"+parent.serveur.codeStage;tabParam[2]="groupID##"+parent.serveur.codeGroupe;var ogl="false";if (OBJ_GLOBAL_SYSTEM){ogl="true";}tabParam[3]="objectivesGlobalToSystem##"+ogl;tabParam[4]="objectifsALire##"+objectifsALire;ogl="false";if (parent.SYNC_CORRIGE_ITEM!=""){ogl="true";}tabParam[5]="syncCorrigeItem##"+ogl;tabParam[6]="userLanguage##"+userLanguage();if (parent.serveur.vMos_nom==""){tabParam[7]="getUserName##true";}var oRetour=parent.SYS_service("redonnerParcours",tabParam);oRacParc=parent.XML_filsNS(oRetour,"","manifest");if (oRacParc!=null){succ=true;if (PF_attr(oRacParc,"groupeFerme")=="oui"){PF_masquerDiv("STY_planArborescence");alert("The group is closed");return false;}if (parent.serveur.vMos_nom==""){parent.serveur.vMos_nom=PF_attr(oRacParc,"vMos_nom");parent.serveur.vMos_prenom=PF_attr(oRacParc,"vMos_prenom");}parent.serveur.codeInscription=oRacParc.getAttribute("codeInscription");modeExploration=PF_attr(oRacParc,"modeExploration");limiteHeures=PF_attr(oRacParc,"limiteHeures");parent.modeTentative=PF_attr(oRacParc,"modeTentative");codeGroupeParc=PF_attr(oRacParc,"codeGroupe");parent.serveur.codeGroupe=codeGroupeParc;if (PF_attr(oRacParc,"estTuteur")=="1"){parent.serveur.estTuteur=true;}parent.serveur.numAcces=PF_attr(oRacParc,"numAcces");if (PF_attr(oRacParc,"minutesInactives")!=""){var minutesInactives=parseInt(PF_attr(oRacParc,"minutesInactives"));if (!isNaN(minutesInactives)){TEMPS_INACTIF_AUTORISE=minutesInactives;}}DOMParc=parent.IU_objDom();var oInsertD=oRacParc;if (parent.estMoz){oInsertD=DOMParc.importNode(oRacParc,true);}if (DOMParc.documentElement){DOMParc.replaceChild(oInsertD,DOMParc.documentElement);} else {DOMParc.appendChild(oInsertD);}oRacParc=DOMParc.documentElement;} else {PF_masquerDiv("STY_planArborescence");alert("User not enrolled or group not found");return false;}if (parent.serveur.vMos_id=="_guest"){modeExploration="toujours";}} else {try {succ=DOMParc.load(parent.FICH_PARCOURS);} catch(e){succ=false;}if (succ){oRacParc=DOMParc.documentElement;}}if (succ && oRacParc!=null && oRacParc.nodeName=="manifest"){appliqueDefautNS(DOMParc);var racDomi=DOMManifest.documentElement;recupereAttr(oRacParc,racDomi,"dateEntre");recupereAttr(oRacParc,racDomi,"dateAcces");recupereAttr(oRacParc,racDomi,"dateValidation");recupereAttr(oRacParc,racDomi,"dateCompletion");recupereAttr(oRacParc,racDomi,"etatParcours");recupereAttr(oRacParc,racDomi,"etatValidation");recupereAttr(oRacParc,racDomi,"etatScore");recupereAttr(oRacParc,racDomi,"score");recupereAttr(oRacParc,racDomi,"tempsTotal");var orga=parent.XML_premierNoeud(oRacParc,"organization");if (orga!=null){recupereItem(orga);var derSusp=PF_attr(orga,"activiteSuspendue");if (PF_attr(orga,"goToLastSuspendedItem")=="true"){RETOUR_DERNIER_SUSPENDU=true;}if (derSusp!="" && (estSuspendue(orga)||RETOUR_DERNIER_SUSPENDU)){itemSuspendu=parent.XML_trouveNoeud(racDomi,"item","identifier",derSusp);if (itemSuspendu && RETOUR_DERNIER_SUSPENDU){var lesitems=itemRacine.getElementsByTagName("*");for (var i=0;i<lesitems.length;i++){if (lesitems[i].nodeName=="item"){lesitems[i].removeAttribute("activityIsSuspended");}}var setSusp=itemSuspendu;while (setSusp!=null && setSusp.nodeName!="organizations"){setSusp.setAttribute("activityIsSuspended","true");setSusp=setSusp.parentNode;}}}if (PF_attr(orga,"activityProgressStatus")==""){parent.ENTREE_PARCOURS=true;}}var objectifsGlobaux0=parent.XML_fils(oRacParc,"objectifsGlobaux");if (objectifsGlobaux0!=null){if (OBJECTIFS_ADLSEQ){for (var k=0;k<objectifsGlobaux0.childNodes.length;k++){var objk=objectifsGlobaux0.childNodes[k];var valeursADL=PF_attr(objk,"valeursADL");if (valeursADL!=""){recuperationValADLSurObj(valeursADL,objk);objk.removeAttribute("valeursADL");}}}racDomi.appendChild(parent.IU_importeNoeud(racDomi,objectifsGlobaux0));}if (!parent.SUR_CHORUS){var gardeReponses=parent.XML_fils(oRacParc,"gardeReponses");if (gardeReponses!=null){racDomi.appendChild(parent.IU_importeNoeud(racDomi,gardeReponses));}var allocationGlobales0=parent.XML_fils(oRacParc,"allocationsGlobales");if (allocationGlobales0!=null){racDomi.appendChild(parent.IU_importeNoeud(racDomi,allocationGlobales0));}}}}objGlobauxCourant=parent.XML_fils(DOMManifest.documentElement,"objectifsGlobaux");if (objGlobauxCourant==null){objGlobauxCourant=parent.creerElementCP(DOMManifest,"objectifsGlobaux");DOMManifest.documentElement.appendChild(objGlobauxCourant);}if (!parent.SUR_CHORUS){allocationsGlobales=parent.XML_fils(DOMManifest.documentElement,"allocationsGlobales");}if (allocationsGlobales==null){allocationsGlobales=parent.creerElementCP(DOMManifest,"allocationsGlobales");DOMManifest.documentElement.appendChild(allocationsGlobales);}appliquerAleatoire(itemRacine);var racmn=DOMManifest.documentElement;if (modeExploration!=""){if (modeExploration=="toujours"){parent.lesson_mode="browse";} else if (modeExploration=="valide"){if (PF_attr(racmn,"etatValidation")=="true"){parent.lesson_mode="review";}} else if (modeExploration=="complete"){if (PF_attr(racmn,"etatParcours")=="completed"){parent.lesson_mode="review";}}}if (parent.SYNC_CORRIGE_ITEM!=""){modeExploration="";parent.lesson_mode="normal";var tabG=parent.SYNC_CORRIGE_ITEM.split(";");var oActCorr=donneActivite(tabG[0]);if (oActCorr==null){return ;}var oObjCorr=donneObjectifCible(oActCorr,true);activiteRacine=itemRacine;if (FIGER_ETAT_ITEM && (tabG[1]=="incomplete"||tabG[1]=="notAttempted"||tabG[1]=="attempted") && PF_attr(oActCorr,"attemptCompletionStatus")=="true"){FIGER_ETAT_ITEM=false;}if (FIGER_MEILLEUR_RESULTAT && (tabG[1]=="failed"||tabG[1]=="unknown"||tabG[1]=="score")){FIGER_MEILLEUR_RESULTAT=false;}if (tabG[1]=="incomplete"||tabG[1]=="completed"){marquerAccesCorrigeAdmin(oActCorr);oActCorr.setAttribute("attemptProgressStatus","true");var resP="false";if (tabG[1]=="completed"){resP="true";}oActCorr.setAttribute("attemptCompletionStatus",resP);if (completionThreshold(oActCorr,"completedByMeasure")=="true"){if (tabG[1]=="completed"){oActCorr.setAttribute("attemptCompletionAmount","1.0");oActCorr.setAttribute("attemptCompletionAmountStatus","true");} else {oActCorr.removeAttribute("attemptCompletionAmount");oActCorr.removeAttribute("attemptCompletionAmountStatus");}}} else if (tabG[1]=="notAttempted"||tabG[1]=="attempted"){if (tabG[1]=="notAttempted"){oActCorr.setAttribute("attemptCount","0");oActCorr.removeAttribute("activityProgressStatus");} else {marquerAccesCorrigeAdmin(oActCorr);}oActCorr.removeAttribute("attemptProgressStatus");oActCorr.removeAttribute("attemptCompletionStatus");oActCorr.removeAttribute("activityAbsoluteDuration");oActCorr.removeAttribute("attemptAbsoluteDuration");} else if (tabG[1]=="time"){if (PF_attr(oActCorr,"attemptProgressStatus")=="true"){if (tabG[2]==""){oActCorr.removeAttribute("activityAbsoluteDuration");} else {oActCorr.setAttribute("activityAbsoluteDuration",tabG[2]);}oActCorr.removeAttribute("attemptAbsoluteDuration");}} else if (tabG[1]=="unknown"){enregistrerEtatObjectif(oObjCorr,"objectiveMeasureStatus","false");enregistrerEtatObjectif(oObjCorr,"objectiveProgressStatus","false");} else if (tabG[1]=="score"){if (tabG[2]==""){enregistrerEtatObjectif(oObjCorr,"objectiveMeasureStatus","false");} else {enregistrerObjectif(oObjCorr,"objectiveNormalizedMeasure",tabG[2],false);}} else if (tabG[1]=="regenere"){} else if (tabG[1]=="attemptCount"){oActCorr.setAttribute("attemptCount",tabG[2]);} else {var resEvMe="";if (tabG[1]=="passed"){resEvMe="true";}else if (tabG[1]=="failed"){resEvMe="false";}enregistrerObjectif(oObjCorr,"objectiveSatisfiedStatus",resEvMe,false);if (tabG[2]!=""){enregistrerObjectif(oObjCorr,"objectiveNormalizedMeasure",tabG[2],false);}}oActCorr.setAttribute("dateRemonte",parent.getDateServeur('milli'));tabDejaFaitRollup=new Array();if (tabG[1]=="time"){var tabCheminActivites=formerCheminAct(oActCorr,true,activiteRacine,true);for (var j=0;j<tabCheminActivites.length;j++){if (j>0){durationRollup(tabCheminActivites[j]);}}}overallRollup(oActCorr);}if (parent.SUR_CHORUS_ADM){try {parent.serveur.numCnx=top.opener.parent.serveur.numCnx;parent.serveur.vMos_id=top.opener.top.usrCnx.id();} catch(e){}}if (parent.donneParam("rch")=="1" && !parent.activiteUnique){RECHERCHE_POSSIBLE=true;var champRechercheInterne=PF_donneObjet("STY_champRechercheInterne");if (champRechercheInterne!=null){try {champRechercheInterne.addEventListener("keypress",tapeRechercheInterne,false);champRechercheInterne.addEventListener("focus",focusRechercheInterne,false);} catch(e){champRechercheInterne.attachEvent("onkeypress", tapeRechercheInterne);champRechercheInterne.attachEvent("onfocus", focusRechercheInterne);}if (champRechercheInterne.title=="textinfo"){champRechercheInterne.title="";champRechercheInterne.value=donneLex(503);gardeCouleurChamp=valCSS(champRechercheInterne,"color","color",parent.estMoz);champRechercheInterne.style.color="#999999";}}} else {PF_masquerDiv("STY_zoneRechercheInterne");}if (parent.donneParam("vgp")=="0"){PF_masquerDiv("STY_zoneBoutonCollab");}if (largeurPlanInitiale>0||oFenetre!=null){PF_affecterAlt();largeurPlanInitiale=-1;}if (COMPATIBLE_SCORM12){var e = parent.document.createElement("script");var ajRac="";if (!parent.SUR_CHORUS){ajRac=parent.RACINE_stage+"MosMtr/";} e.src = ajRac+"scripts/lms/scorm12.js"; e.type="text/javascript"; parent.document.getElementsByTagName("head")[0].appendChild(e);} else {parent.haut.location="menu.html";}}}function modeCompat12(racmn){if (PF_attr(racmn,"scorm12")=="1"){racmn.removeAttribute("scorm12");return true;}if (PF_attr(racmn,"scorm12")=="0"){alert("SCORM 1.2 courses must be converted in MOS Chorus.");DOMManifest=null;return;}if (!parent.SUR_CHORUS){var osc=parent.XML_fils(racmn,"metadata");if (osc && parent.XML_texteNoeud(parent.XML_fils(osc,"schemaversion"))=="SCORM 1.2 Compatibility Mode"){return true;}}return false;}function tapeRechercheInterne(event){if (!event){event=window.event;}parent.haut.tapeRechercheInterne(event);}function focusRechercheInterne(event){if (!event){event=window.event;}parent.haut.focusRechercheInterne(event);}function changeClassMenuMarque(itemObj,nomClasse,etatAcheve){var strNomClasse=itemObj.className;var nouvelleClasse=strNomClasse;if (strNomClasse.indexOf("STY_planLienTitrePage")==0){var classeSelonType="STY_planLienActivite";if (strNomClasse.indexOf("STY_planLienEvaluation")>0){classeSelonType="STY_planLienEvaluation";} else if (strNomClasse.indexOf("STY_planLienDocument")>0){classeSelonType="STY_planLienDocument";}nouvelleClasse="STY_planLienTitrePage "+classeSelonType;if (strNomClasse.indexOf("STY_planLienTitrePageSel")>0){nouvelleClasse+=" STY_planLienTitrePageSel";}if (etatAcheve=="Complete"){nouvelleClasse+=" STY_planLienTitrePageComplete";}if (nomClasse=="Desactive"){nouvelleClasse+=" STY_planLienTitrePageDesactive";itemObj.style.cursor="not-allowed";} else {itemObj.style.cursor="";}} else if (strNomClasse.indexOf("STY_planLienTitreEtape")==0){nouvelleClasse="STY_planLienTitreEtape";if (strNomClasse.indexOf("Ouvert")>0){nouvelleClasse+=" STY_planLienTitreEtapeOuvert"; }if (etatAcheve=="Complete"){nouvelleClasse+=" STY_planLienTitreEtapeComplete";}if (nomClasse=="Desactive"){nouvelleClasse+=" STY_planLienTitreEtapeDesactive"; }} else if (strNomClasse.indexOf("STY_planLienTitreModule")==0){nouvelleClasse="STY_planLienTitreModule";if (strNomClasse.indexOf("Ouvert")>0){nouvelleClasse+=" STY_planLienTitreModuleOuvert"; }if (etatAcheve=="Complete"){nouvelleClasse+=" STY_planLienTitreModuleComplete";}if (nomClasse=="Desactive"){nouvelleClasse+=" STY_planLienTitreModuleDesactive"; }} else if (strNomClasse.indexOf("STY_planLienItmRacine")==0){nouvelleClasse="STY_planLienItmRacine";if (etatAcheve=="Complete"){nouvelleClasse+=" STY_planLienItmRacineComplete";}if (nomClasse=="Desactive"){nouvelleClasse+=" STY_planLienItmRacine"+nomClasse;}}if (strNomClasse!=nouvelleClasse){itemObj.className=nouvelleClasse;}}function deselectionneLien(lienCourant){if (lienCourant!=null){lienCourant.className=lienCourant.className.replace(/ \w+Sel/,""); }}function selectionneLien(idLien){deselectionneLien(lienCourant);var oLien = PF_donneObjet(idLien);lienCourant=oLien;var classss=oLien.className;if (oLien!=null && classss.indexOf('Sel')==-1){oLien.className=classss.replace("Desactive","")+' STY_planLienTitrePageSel';}}var transitionCssBascule="init";var dureeTransitionCssBascule="1";function peutTransitionCssBascule(oDiv){if (!parent.estMoz || document.body.offsetWidth<20){return false;}if (transitionCssBascule=="init"){transitionCssBascule=valCSS(oDiv,"","-moz-transition-property",parent.estMoz);if (transitionCssBascule==null || transitionCssBascule==""){transitionCssBascule=valCSS(oDiv,"","-webkit-transition-property",parent.estMoz);}if (transitionCssBascule==null || transitionCssBascule=="all"){transitionCssBascule="";}var ts=valCSS(oDiv,"","-webkit-transition-duration",parent.estMoz);if (ts==null || ts==""){ts=valCSS(oDiv,"","-moz-transition-duration",parent.estMoz);}if (ts==null || ts==""){ts="1";}dureeTransitionCssBascule=ts;}return transitionCssBascule!="";}function basculeItem(nomItem){var oDiv=PF_donneObjet("divFils"+nomItem);var oImg=PF_donneObjet("img"+nomItem);var numB="0";if (oDiv==null){return ;}var vOuvre=false;if (oDiv.style.display=="none"){vOuvre=true;var deroulePossible=false;var oitem=parent.XML_trouveNoeud(itemRacine,"item","nom",nomItem);if (estActive(oitem) && !estSuspendue(oitem)){deroulePossible=true;} else {if (choixSurFilsPossible(oitem)){deroulePossible=true;}}if (deroulePossible){if (peutTransitionCssBascule(oDiv)){declencheAnimationBascule1(oDiv);} else {oDiv.style.display="block";}numB="1";/*var forcerTest=false;var oAnc=oitem;while (oAnc!=null && !estRacine(oAnc)){if (tabContient(tabItemsVerif,PF_attr(oAnc,"identifier"))){forcerTest=true;}oAnc=oAnc.parentNode;}*/afficherParcoursItem(oitem,false);}} else {if (peutTransitionCssBascule(oDiv)){refermeAnimationBascule1(oDiv.id);} else {oDiv.style.display="none";}}basculeClasseNiveau(nomItem,vOuvre);parent.haut.changeImgBtn(oImg,parent.RACINE_STYLE+"media/gen/planModule"+numB+".png");PLAN_menuPop();}function PLAN_afficheItem(nomItem){var oDiv=PF_donneObjet("divFils"+nomItem);var oImg=PF_donneObjet("img"+nomItem);if (peutTransitionCssBascule(oDiv)){declencheAnimationBascule1(oDiv);} else {oDiv.style.display="block";}basculeClasseNiveau(nomItem,true);parent.haut.changeImgBtn(oImg,parent.RACINE_STYLE+"media/gen/planModule1.png");}function PLAN_fermerItem(nomItem){if (nomItem!=''){var oitem;if (nomItem=="_racine"){oitem=itemRacine;} else {oitem=parent.XML_trouveNoeud(itemRacine,"item","nom",nomItem);}if (PF_attr(oitem,"isvisible")=="false"){return;}var oDiv=PF_donneObjet("divFils"+nomItem);var oImg=PF_donneObjet("img"+nomItem);if (peutTransitionCssBascule(oDiv)){refermeAnimationBascule1(oDiv.id);} else {oDiv.style.display="none";}basculeClasseNiveau(nomItem,false);parent.haut.changeImgBtn(oImg,parent.RACINE_STYLE+"media/gen/planModule0.png");}}function basculeClasseNiveau(nomItem,ouvre){var lienMod=PF_donneObjet("lienP"+nomItem);if (ouvre){if (lienMod.className.indexOf("STY_planLienTitreModule")>=0){lienMod.className+=" STY_planLienTitreModuleOuvert";}if (lienMod.className.indexOf("STY_planLienTitreEtape")>=0){lienMod.className+=" STY_planLienTitreEtapeOuvert";}} else {lienMod.className=lienMod.className.replace(" STY_planLienTitreModuleOuvert","");lienMod.className=lienMod.className.replace(" STY_planLienTitreEtapeOuvert","");}}function PLAN_basculeTout(deroule){ var sourceImg; var afficheDiv; if (deroule){ sourceI="0.png"; destI="1.png"; afficheDiv="block"; } else { sourceI="1.png"; destI="0.png"; afficheDiv="none"; } var lesitems=parent.XML_listeParBalise(itemRacine,"item"); for (var k=0;k<lesitems.length;k++){var itemTmp=lesitems[k];if (parent.XML_fils(itemTmp,"item")!=null){var id=itemTmp.getAttribute("nom");var oDiv=PF_donneObjet("divFils"+id);if (oDiv!=null && oDiv.style.display!=afficheDiv){activiteSpecifieParChoixPreemptif=itemTmp.getAttribute("identifier");if (!deroule || estActive(itemTmp)||(parent.haut.NAVIG_requete("choice",true)=="true")){var oImg=PF_donneObjet("img"+id);if (oImg!=null){var sourceImg=new String(oImg.src);if (sourceImg.indexOf("/blanc.gif")>0){oImg.style.filter=oImg.style.filter.replace(sourceI,destI);} else {oImg.src=sourceImg.replace(sourceI,destI);}}if (deroule || PF_attr(itemTmp,"isvisible")!="false"){oDiv.style.display=afficheDiv;}basculeClasseNiveau(id,deroule);}}}}etatBasculeItems=!etatBasculeItems;if (deroule){PLAN_afficheParcours(false);}PLAN_menuPop();}function PLAN_afficheParcours(async){if (SUIVI_DESACTIVE){if (numAffichageParcours==0 && !oFenetre){PF_afficherDiv("STY_planArborescence");}return ;}if (parent.haut.planEnLigne && itemCourant!=null){parent.haut.NAVIG_remplirNiveau1(parent.haut.PF_donneObjet("STY_ligneNiveau1"));var idact=itemCourant.getAttribute("nom");if (itemCourant.parentNode.nodeName=="item"){var codePereN1=itemCourant.parentNode.getAttribute("nom");parent.haut.selectionneItmNiveau(codePereN1,1);parent.haut.NAVIG_remplirNiveau2Passif(codePereN1);parent.haut.selectionneItmNiveau(idact,2);} else { parent.haut.selectionneItmNiveau(idact,1); }}var cadreListe = donneCadreIndex("planLMS");if (cadreListe.offsetWidth<20 && !oFenetre){auraitDuMettreAJourPlan=true;return false;}if (async && tabDejaFaitRollup!=null){return false;}SANS_REMONTE=true;var tabFilsR=donneLesFils(itemRacine,"item");for (var i=0;i<tabFilsR.length;i++){afficherParcoursItem(tabFilsR[i],false);}if (existeLienItmRacine){afficherParcoursItem(itemRacine,true);}if (numAffichageParcours==0 && !oFenetre){PF_afficherDiv("STY_planArborescence");}numAffichageParcours++;SANS_REMONTE=false;auraitDuMettreAJourPlan=false;tabTestItemPlan=new Array();activiteSpecifieParChoixPreemptif="";}function PLAN_basculerTout(aff){PLAN_basculeTout(aff);}function PLAN_affichagePlan(val){if (PLAN_DESACTIVE && val!="non"){return;}window.status='';if (oFenetre!=null){if (val=="non"){if (oFenetre.hide){oFenetre.hide();}else {oFenetre.style.display="none";}return ;}if (auraitDuMettreAJourPlan){PLAN_afficheParcours(false);}PLAN_menuPop();} else {var cadres = parent.document.getElementById("frame2");if (val=='oui'){if (parent.serveur.largeurCol==0 || parent.serveur.largeurCol==largeurPlanFerme){if (largeurColZero!=''){parent.serveur.largeurCol=largeurColZero;} else {parent.serveur.largeurCol='23%';if (!cadres){parent.serveur.largeurCol='260';}}}if (parent.PLAN_DROIT){cadres.cols="*,"+parent.serveur.largeurCol;} else {cadres.cols=parent.serveur.largeurCol+",*";}if (largeurPlanInitiale==0){PF_affecterAlt();largeurPlanInitiale=-1;}if (auraitDuMettreAJourPlan){PLAN_afficheParcours(false);}} else {try {var cadreListe = donneCadreIndex("planLMS");if (cadreListe.offsetWidth>1){parent.serveur.largeurCol=cadreListe.offsetWidth;}} catch(e){}if (parent.PLAN_DROIT){cadres.cols="*,"+largeurPlanFerme;} else {cadres.cols=largeurPlanFerme+",*";}}}}function PLAN_planEstAffiche(){var cadres = parent.document.getElementById("frame2");if (cadres){if (cadres.cols==largeurPlanFerme+",*"||cadres.cols=="*,"+largeurPlanFerme){return false;} else if (largeurPlanFerme==0 && cadres.cols=="1,*"||cadres.cols=="*,1"){return false;}} else {cadres = parent.document.getElementById("cadreListe");if (cadres.offsetWidth<=largeurPlanFerme){return false;}}return true;}function PLAN_basculePlan(){var vAff="non";if (!PLAN_planEstAffiche()){vAff="oui";}PLAN_affichagePlan(vAff);}function PLAN_basculeItems(){PLAN_basculeTout(etatBasculeItems);}function PLAN_effacePop(){if (oFenetre!=null){if (oFenetre.nodeType && oFenetre.nodeType==1){if (oFenetre.offsetWidth>1){var oRegAp=objetRegleCss(".STY_planLMSIfrmAnimAp");if (oRegAp==null){oFenetre.style.display="none";} else {affichagePlanEnCours=true;setTimeout(effMenuPopInterneTm1,50);}}} else {oFenetre.hide();}}}function PLAN_menuPop(){if (window.tabItemsPlFlott){for (var k=0;k<window.tabItemsPlFlott.length;k++){afficherParcoursItem(parent.XML_trouveNoeud(DOMManifest.documentElement,"item","identifier",window.tabItemsPlFlott[k]),false,true);}window.tabItemsPlFlott=null;}if (oFenetre!=null){if (oFenetre.nodeType && oFenetre.nodeType==1){return PLAN_menuPopInterne(); }var oTete=oFenetre.document.getElementsByTagName("head").item(0);var oStyle=oFenetre.document.createElement("link");oStyle.setAttribute("type","text/css");oStyle.setAttribute("rel","stylesheet");oStyle.setAttribute("href",parent.RACINE_STYLE+"css/planLMS.css");oTete.appendChild(oStyle);oFenetre.document.body.className="STY_fondPlanLMS";var htmlm='<div class="STY_bordureFenPlanLMS">'+document.body.innerHTML+'</div>';htmlm=htmlm.replace(/href="javascript\:/g,'href="#" onclick="parent.');htmlm=htmlm.replace(/onclick="bascule/g,'onclick="parent.bascule');htmlm=htmlm.replace(/onmouseover="PF_survol/g,'onmouseover="parent.PF_survolPlanPop');htmlm=htmlm.replace(/onmouseout="PF_survol/g,'onmouseout="parent.PF_survolPlanPop');var fenrelle=PLAN_FEN_H;if (fenrelle==''){fenrelle=750;}var fenRelatifPos=document.body;if (planPopupRelMenu){fenRelatifPos=parent.haut.document.body;}oFenetre.show(PLAN_FEN_X,PLAN_FEN_Y,PLAN_FEN_L,fenrelle,fenRelatifPos);oFenetre.document.body.innerHTML =htmlm;if (PLAN_FEN_H==''){try {var oplanar=oFenetre.document.getElementById("STY_planArborescence");fenrelle=oplanar.offsetHeight+ajMargePop(oplanar);var planTitreFormation=oFenetre.document.getElementById("STY_planTitreFormation");if (planTitreFormation){fenrelle+=planTitreFormation.offsetHeight+ajMargePop(planTitreFormation);}fenrelle+=40;oFenetre.show(PLAN_FEN_X,PLAN_FEN_Y,PLAN_FEN_L,fenrelle,fenRelatifPos);} catch(e){}}}}var affichagePlanEnCours=false;function PLAN_menuPopInterne(directEv){if (!oFenetre.nodeType){return;}affichagePlanEnCours=true;var oReg=objetRegleCss(".STY_planLMSIfrm");var txtAnim="";var oRegAv=null;if (oFenetre.offsetWidth<5){oRegAv=objetRegleCss(".STY_planLMSIfrmAnimAv");if (oRegAv){txtAnim=";"+oRegAv.style.cssText;}}if (oReg){oFenetre.style.cssText=oReg.style.cssText+txtAnim;}if (oRegAv){setTimeout(affMenuPopInterneTm1,50);} else {affMenuPopInterneTm1();}}function affMenuPopInterneTm1(){oFenetre.style.display="block";var oRegCour=objetRegleCss(".STY_planLMSIfrm");var ajHauto="";if (oFenetre.style.height=="auto"){var hauteur=getPageSizeWithScroll();hauteur+=5;var maxPage=0;if (window.innerHeight){maxPage=parent.window.innerHeight;}else {maxPage=parent.document.documentElement.clientHeight;}if (hauteur>maxPage){hauteur=maxPage-oFenetre.offsetTop-10;}ajHauto=";height:"+hauteur+"px";}if (oRegCour!=null){oFenetre.style.cssText+=";"+oRegCour.style.cssText+ajHauto;}setTimeout("affichagePlanEnCours=false;",200);}function effMenuPopInterneTm1(){var dureeTrans=pl_dureeTransitionCssObjet(oFenetre);var oRegCour=objetRegleCss(".STY_planLMSIfrmAnimAp");oFenetre.style.cssText+=";"+oRegCour.style.cssText;setTimeout("affichagePlanEnCours=false;oFenetre.style.display='none'",dureeTrans);}function pl_dureeTransitionCssObjet(obj){var ts=oFenetre.style.webkitTransitionDuration;if (ts==null || ts==""){ts=oFenetre.style.MozTransitionDuration;}if (ts==null || ts==""){return 0;}ts=ts.split(" ")[0];ts=ts.replace("s","");ts=ts.replace(",","");return Number(ts)*1000;}function getPageSizeWithScroll(){if (window.innerHeight && window.scrollMaxY) {return window.innerHeight + window.scrollMaxY;}return document.documentElement.scrollHeight;}function objetRegleCss(nomClasse){for (var m=0;m<document.styleSheets.length;m++){var ofCSS=document.styleSheets.item(m);var tabRule=ofCSS.rules;if (tabRule==null){tabRule=ofCSS.cssRules;} for (var j=0;j<tabRule.length;j++){if (tabRule[j].selectorText==nomClasse){return tabRule[j];}}}return null;}function PF_survolPlanPop(img,num){var oImg=oFenetre.document.getElementById(img);if (oImg!=null){var nSrc=oImg.src;var estPngIE=false;if (nSrc.indexOf('blanc.gif')>0 && oImg.style.filter && oImg.style.filter!=''){estPngIE=true;}if (num==0){nSrc=nSrc.replace("_survl0","_survl1");if (estPngIE){oImg.style.filter=oImg.style.filter.replace("_survl0","_survl1");}} else {nSrc=nSrc.replace("_survl1","_survl0");if (estPngIE){oImg.style.filter=oImg.style.filter.replace("_survl1","_survl0");}}oImg.src=nSrc;}}function ajMargePop(obj){var res=0;if (obj.style.marginTop.indexOf("px")>0){res+=parseInt(obj.style.marginTop.replace("px",""));}if (obj.style.marginBottom.indexOf("px")>0){res+=parseInt(obj.style.marginBottom.replace("px",""));}return res;}function clicRacine(){activiteSpecifieParChoix=itemRacine.getAttribute("identifier");overallSequencing("choice");}function clicItem(nomItem){PLAN_effacePop();var oitem;if (nomItem=="_racine"){oitem=itemRacine;} else {oitem=parent.XML_trouveNoeud(itemRacine,"item","nom",nomItem);}if (!estFeuille(oitem) && (controlMode(oitem.parentNode,"choice")=="false"||controlMode(oitem,"flow")=="false")){if (choixSurFilsPossible(oitem)){return basculeItem(nomItem);}}if (choixItemLineairePossible(oitem)){activiteSpecifieParChoix=oitem.getAttribute("identifier");MODE_PREEMPTIF=false;overallSequencing("choice");}}function choixSurFilsPossible(oitem){var filsItem=parent.XML_fils(oitem,"item");var filTmp=filsItem;while (filTmp!=null&&filTmp.nodeName=="item"){MODE_PREEMPTIF=true;activiteSpecifieParChoixPreemptif=filTmp.getAttribute("identifier");if (overallSequencing("choice")=="true"){return true;} else {if (choixSurFilsPossible(filTmp)){return true;}}filTmp=filTmp.nextSibling;}return false;}function donneActivite(idActivite){if (idActivite==itemRacine.getAttribute("identifier")){return itemRacine;} else {return parent.XML_trouveNoeud(itemRacine,"item","identifier",idActivite);}}function estFrere(oN1,oN2){var res=false;var i=0;if (oN1.parentNode){var tabF=parent.XML_tabElementFils(oN1.parentNode);while (!res && i<tabF.length){if (tabF[i]==oN2){res=true;}i++;}}return res;}function ancetreCommun(oN1,oN2){var tabAncetre=new Array();var oAnc=oN1.parentNode;var oCommun=null;if (estRacine(oN1)||estRacine(oN2)){return oN1;}if (PF_attr(oN1,"identifier")==PF_attr(oN2,"identifier")){return oN2;}while ((oAnc!=null)&&((oAnc.nodeName=="item")||(oAnc.nodeName=="organization"))){tabAncetre.push(oAnc);oAnc=oAnc.parentNode;}oAnc=oN2.parentNode;while ((oAnc!=null)&&(oCommun==null)){var lid=PF_attr(oAnc,"identifier");for (var i=0;i<tabAncetre.length;i++){if (PF_attr(tabAncetre[i],"identifier")==lid){oCommun=oAnc;}}oAnc=oAnc.parentNode;}return oCommun;}function PLAN_lancerActivite(oActivite){var idref=PF_attr(oActivite,"identifierref");if (idref==""){return ;}var oRessource=parent.XML_trouveNoeud(DOMManifest,"resource","identifier",idref);if (oRessource==null){alert("resource not found for activity "+oActivite.getAttribute("identifier"));return false;}var href=oRessource.getAttribute("href");oRessource.removeAttribute("type");var base="";var avecProtocole=(href.match(oRegScheme)!=null);if (!avecProtocole){base=PF_attr(DOMManifest.documentElement,"xml:base");base+=PF_attr(oRessource.parentNode,"xml:base");base+=PF_attr(oRessource,"xml:base");} else {var tmpH=href.replace("://",":||");var indp=tmpH.indexOf("/");if (indp>0){if (parent.origineScoExterne=="initEvt"){parent.initEvtPostMessage();}tmpH=tmpH.replace(":||","://");parent.origineScoExterne=tmpH.substring(0,indp);}}var parameters=PF_attr(oActivite,"parameters");if (pageSpecifieeParLienPage!=""){parameters+="&idPg="+pageSpecifieeParLienPage;pageSpecifieeParLienPage="";}if (!parent.SUR_CHORUS && top.opener){try {if (top.opener.top.menu && top.opener.top.menu.NOM_CREATEUR=="MOS Chorus"){parameters+="&Rd_Cache="+Math.round(Math.random()*10000);}} catch(e){}}if (parameters!=""){while ((parameters.indexOf("?")==0) || (parameters.indexOf("&")==0)){parameters=parameters.substring(1);}if (parameters.indexOf("#")==0 && href.indexOf("#")>0){parameters="";}if (href.indexOf("?")>0){parameters="&"+parameters;} else {parameters="?"+parameters;}}ressourceCourante=oRessource;var typeR=PF_attr(oRessource,"adlcp:scormType");if (typeR==""){typeR=="sco";}var nomActivite="";var oDshtml=PF_donneObjet('lienP'+oActivite.getAttribute("nom"));if (oDshtml!=null){nomActivite=oDshtml.innerHTML;}parent.haut.PF_modifTexteDiv("STY_titreEtapeJS",nomActivite);PF_modifTexteDiv("STY_titreEtapeJS",nomActivite);var nomSeqPere="";var oPereSeq=oActivite.parentNode;if (!estRacine(oPereSeq)){var oDshtml0=PF_donneObjet('lienP'+oPereSeq.getAttribute("nom"));if (oDshtml0!=null){var nomSeqPere=oDshtml0.innerHTML;}}parent.haut.PF_modifTexteDiv("STY_titreSequencePere",nomSeqPere);PF_modifTexteDiv("STY_titreSequencePere",nomSeqPere);if (parent.haut.oFlashIntBar){try {parent.haut.oFlashIntBar.MOS_setCurrentItem(PF_attr(oActivite,"identifier"),nomActivite,nomSeqPere);}catch(e){}}href=base+href+parameters;if (!avecProtocole){href=parent.RACINE_stage+href;}if (parent.API_1484_11==null){return ;}if (parent.API_1484_11.etatCommunication=="enCours"){parent.API_1484_11.scoEnAttente=true;} else {parent.API_1484_11.etatCommunication="pasInitialise";}var oNavInter=parent.XML_filsNS(oActivite,"adlnav","presentation");if (oNavInter!=null){oNavInter=parent.XML_filsNS(oNavInter,"adlnav","navigationInterface");}masquePrecedent=masqueBoutonLMS(oNavInter,"previous","ActivitePrecedente");masqueSuivant=masqueBoutonLMS(oNavInter,"continue","ActiviteSuivante");masqueSortie=masqueBoutonLMS(oNavInter,"exitAll","QuitterTout");masqueSuspendre=masqueBoutonLMS(oNavInter,"suspendAll","SuspendreTout");var cacherEx=(masqueSortie&&masqueSuspendre);cacherBoutonUI("Quitter",cacherEx);dernierItemLance=oActivite;var dateEvt=parent.getDateServeur('');var oPereA=oActivite;while (oPereA!=null){oPereA.setAttribute("dateAcces",dateEvt);if (estRacine(oPereA)){DOMManifest.documentElement.setAttribute("dateAcces",dateEvt);oPereA=null;} else {oPereA=oPereA.parentNode;}}itemRacine.setAttribute("activiteSuspendue",oActivite.getAttribute("identifier"));nettoyerDejaFait(oActivite);if (parent.STYLE_INTERFACE=="scorm_4th_test_suite" && controlMode(oActivite,"choiceExit")=="false"){PLAN_affichagePlan("non");} PLAN_synchronisePlan(oActivite); parent.haut.NAVIG_barreProgress(oActivite,0); var avecMD=(PF_attr(DOMManifest.documentElement,"avecMD").indexOf(","+oActivite.getAttribute("identifier")+",")>=0);if (typeR=="asset"){repercuteMapDocument(oActivite);parent.haut.NAVIG_majFleches(!masquePrecedent,!masqueSuivant);PLAN_afficheParcours(true);if (deliveryControls(oActivite,"tracked")=="true"){oActivite.setAttribute("dateAfficheDoc",dateEvt);}} else {setTimeout("majBoutonsInit('pasInitialise')",1300);}try {var res=parent.contenuLMS.location.href;} catch(e){ifrmm=parent.document.getElementById("maincontent").getElementsByTagName("iframe")[0];ifrmm.src="about:blank";return setTimeout("parent.contenuLMS.location.replace('"+href+"')",200);}if (parent.contenuLMS.location.href==href){parent.contenuLMS.location=adrPageBlanche();return setTimeout("parent.contenuLMS.location.replace('"+href+"')",200);}parent.contenuLMS.location.replace(href);}function majBoutonsInit(etatSco){if (parent.API_1484_11 && parent.API_1484_11.etatCommunication==etatSco && tabDejaFaitRollup==null){parent.haut.NAVIG_majFleches(!masquePrecedent,!masqueSuivant);PLAN_afficheParcours(true);}}function PLAN_synchronisePlan(oItem){var codePereN1="";var pere=oItem.parentNode;var tabInverseAff=new Array();var listeParents=",";while(pere!=null && pere.nodeName=="item"){var nomItm=pere.getAttribute("nom");var oDiv=parent.planLMS.PF_donneObjet("divFils"+nomItm);if (oDiv!=null){listeParents+=nomItm+",";if (oDiv.style.display=='none'){tabInverseAff.push(nomItm);}}codePereN1=nomItm;pere=pere.parentNode;}if (itemsSynchro!=''){var tabPrecItems=itemsSynchro.split(',');var textChaine=tabInverseAff.join(",");for (var i=0;i<tabPrecItems.length;i++){if (listeParents.indexOf(tabPrecItems[i]+",")<0){PLAN_fermerItem(tabPrecItems[i]);}}itemsSynchro='';}for (var i=tabInverseAff.length-1;i>=0;i--){PLAN_afficheItem(tabInverseAff[i]);itemsSynchro+=nomItm+',';}var nomT=itemCourant.getAttribute("nom");selectionneLien('lienP'+nomT);if (parent.haut.planEnLigne){ if (codePereN1!=""){parent.haut.NAVIG_remplirNiveau2Passif(codePereN1);parent.haut.selectionneItmNiveau(nomT,2); } else { parent.haut.selectionneItmNiveau(nomT,1); parent.haut.viderNiveau2(); }}}function appliquerAleatoire(oActivite){selectChildren(oActivite);randomizeChildren(oActivite);var lesFils=donneLesFils(oActivite,"item");for (var k=0;k<lesFils.length;k++){appliquerAleatoire(lesFils[k]);}}function donneCadreIndex(nomC){var objF=null;var lescadresindex=parent.document.getElementsByTagName("frame");if (lescadresindex.length==0){return parent.document.getElementById("cadreListe");} else {for (var j=0;j<lescadresindex.length;j++){if (lescadresindex.item(j).name==nomC){objF=lescadresindex.item(j);}}}return objF;}function derniereDateSurFils(itemTmp,attr){var tabFils=donneLesFils(itemTmp,"item");var derDate="";for (var j=0;j<tabFils.length;j++){var dateComp=PF_attr(tabFils[j],attr);if (dateComp!="" && (derDate=="" || dateComp>derDate)){derDate=dateComp;}}return derDate;}function afficherParcoursItem(itemTmp,forcer,depuisRePlanFLottant){var lidi=itemTmp.getAttribute("identifier");var forcer0=forcer;var tabFils=donneLesFils(itemTmp,"item");if (OBJ_DESACTIVE_ITEM!=""){var actifPossible=choixItemLineairePossible(itemTmp);desactiverItemPlan(itemTmp,!actifPossible);if (!actifPossible){for (var j=0;j<tabFils.length;j++){afficherParcoursItem(tabFils[j],false,depuisRePlanFLottant);}return;}if (actifPossible && tabContient(tabItemsVerif,lidi)){itemTmp.removeAttribute("planDejaFait");}}if (controlMode(itemTmp.parentNode,"choice")=="false" || (controlMode(itemTmp,"flow")=="false" && tabFils.length>0)){if (tabContient(tabItemsVerif,lidi)){ TEST_AFF_PARC=true;activiteSpecifieParChoixPreemptif=lidi;MODE_PREEMPTIF=true; choiceSequencingRequest(); TEST_AFF_PARC=false; }desactiverItemPlan(itemTmp,true);} else {if (existeChoixSortie || tabContient(tabItemsVerif,lidi) || tabContient(tabTestItemPlan,lidi) || forcer){if (PF_attr(itemTmp,"planDejaFait")!="oui" && (PF_attr(itemTmp,"isvisible")!="false"||tabFils.length>0)){ activiteSpecifieParChoixPreemptif=lidi; TEST_AFF_PARC=true; var resSeq=parent.haut.NAVIG_requete("choice",true); TEST_AFF_PARC=false; desactiverItemPlan(itemTmp,(resSeq=="false")); itemTmp.setAttribute("planDejaFait","oui"); if (forcer || tabContient(tabItemsVerif,lidi)||tabContient(tabTestItemPlan,lidi)){ forcer0=true; }}}}if (tabFils.length>0){var choixPere=controlMode(itemTmp,"choice");var conteneur=PF_donneObjet('divFils'+itemTmp.getAttribute("nom"));if (depuisRePlanFLottant || (conteneur!=null && conteneur.style.display!="none" && conteneur.offsetHeight>5)){for (var j=0;j<tabFils.length;j++){/*if (choixPere=="false" || (controlMode(tabFils[j],"flow")=="false" && !estFeuille(tabFils[j]))){desactiverItemPlan(tabFils[j],true);} else {afficherParcoursItem(tabFils[j],forcer0);}*/afficherParcoursItem(tabFils[j],forcer0,depuisRePlanFLottant);}} else {if (!window.tabItemsPlFlott){window.tabItemsPlFlott=new Array();}for (var j=0;j<tabFils.length;j++){if (!tabContient(tabItemsPlFlott,tabFils[j].getAttribute("identifier"))){tabItemsPlFlott.push(tabFils[j].getAttribute("identifier"));}}}}}function desactiverItemPlan(oItem,desact){var classd="";if (desact){classd="Desactive";}if (oItem==null){alert("Null desactiverItemPlan "+desact);}var nnom=PF_attr(oItem,"nom");if (nnom!=""){var itemCSS=PF_donneObjet('lienP'+nnom);var etatAcheve="";if (PF_attr(oItem,"attemptProgressStatus")=="true"){if (PF_attr(oItem,"attemptCompletionStatus")=="true"){etatAcheve="Complete";}}changeClassMenuMarque(itemCSS,classd,etatAcheve);}}function masqueBoutonLMS(oNavInter,nomBouton,nomFR){var masque=false;if (oNavInter!=null){var tabFils=parent.XML_tabElementFils(oNavInter);for (var m=0;m<tabFils.length;m++){var fiston=tabFils[m];if (fiston.nodeName.indexOf("hideLMSUI")>=0){if (parent.XML_texteNoeud(fiston)==nomBouton){masque=true;m=20;}}}}if (parent.haut.oFlashIntBar){try{parent.haut.oFlashIntBar.MOS_hideLMSBtn(nomBouton,masque);}catch(e){}}cacherBoutonUI(nomFR,masque);return masque;}function cacherBoutonUI(nomFR,masque){var oZone=parent.haut.PF_donneObjet("STY_zoneBouton"+nomFR);if (oZone!=null){if (masque){oZone.style.visibility="hidden";} else {oZone.style.visibility="visible";}}oZone=PF_donneObjet("STY_zoneBouton"+nomFR);if (oZone!=null){if (masque){oZone.style.visibility="hidden";} else {oZone.style.visibility="visible";}}}function recupereAttr(objsource,objcible,nomAttr){var attr=objsource.getAttribute(nomAttr);if (attr!=null){objcible.setAttribute(nomAttr,attr);}}function recupereItem(itemTmp){var oActivite=parent.XML_trouveNoeud(itemRacine,"item","identifier",itemTmp.getAttribute("identifier"));if (oActivite==null){if (itemTmp.getAttribute("identifier")==itemRacine.getAttribute("identifier")){oActivite=itemRacine;}}if (oActivite==null){return false;}if (PF_attr(itemTmp,"attemptCompletionStatus")=="true"&&PF_attr(itemTmp,"attemptProgressStatus")=="true"){var itemCSS=PF_donneObjet('lienP'+PF_attr(oActivite,"nom"));if (itemCSS!=null){var nclss=itemCSS.className;if (nclss.indexOf(" ")>0){nclss=nclss.substring(0,nclss.indexOf(" "));}itemCSS.className=itemCSS.className+" "+nclss+"Complete";}}if (deliveryControls(oActivite,"tracked")=="true"){if (PF_attr(itemTmp,"activityProgressStatus")!=""){recupereAttr(itemTmp,oActivite,"activityProgressStatus");recupereAttr(itemTmp,oActivite,"activityIsActive");recupereAttr(itemTmp,oActivite,"activityIsSuspended");recupereAttr(itemTmp,oActivite,"attemptCount");recupereAttr(itemTmp,oActivite,"attemptProgressStatus");recupereAttr(itemTmp,oActivite,"attemptCompletionStatus");recupereAttr(itemTmp,oActivite,"attemptAbsoluteDuration");recupereAttr(itemTmp,oActivite,"infoProgCourant");recupereAttr(itemTmp,oActivite,"availableChildren");recupereAttr(itemTmp,oActivite,"attemptCompletionAmount");recupereAttr(itemTmp,oActivite,"attemptCompletionAmountStatus");recupereAttr(itemTmp,oActivite,"activityAbsoluteDuration");recupereAttr(itemTmp,oActivite,"activityCompletionStatus");recupereAttr(itemTmp,oActivite,"dateValidation");recupereAttr(itemTmp,oActivite,"dateCompletion");recupereAttr(itemTmp,oActivite,"dateAcces");if (!parent.SUR_CHORUS){recupereAttr(itemTmp,oActivite,"attemptDate");recupereAttr(itemTmp,oActivite,"dateRemonte");}var oBjs=parent.XML_filsNS(itemTmp,"imsss","objectives");if (oBjs!=null){var objPrim=parent.XML_filsNS(oBjs,"imsss","primaryObjective");if (objPrim!=null){var objPrimSource=donneObjectifCible(oActivite,true);recupereObjectif(objPrim,objPrimSource);}var objsimple=objPrim.nextSibling;while (objsimple!=null){var objOriginal=donneObjectifId(oActivite,PF_attr(objsimple,"objectiveID"));if (objOriginal!=null){recupereObjectif(objsimple,objOriginal);}objsimple=objsimple.nextSibling;}}}}if (PF_attr(oActivite,"identifierref")!=""){var oSco=parent.XML_premierNoeud(itemTmp,"sco");if (oSco!=null){var oInsertD=oSco;if (parent.estMoz){oInsertD=oActivite.ownerDocument.importNode(oSco,true);}oActivite.appendChild(oInsertD);}}var filsitem=itemTmp.firstChild;while (filsitem!=null && filsitem.nodeName=="item"){recupereItem(filsitem);filsitem=filsitem.nextSibling;}}function recupereObjectif(ob1,ob2){recupereAttr(ob1,ob2,"objectiveProgressStatus");recupereAttr(ob1,ob2,"objectiveSatisfiedStatus");recupereAttr(ob1,ob2,"objectiveMeasureStatus");recupereAttr(ob1,ob2,"objectiveNormalizedMeasure");recupereAttr(ob1,ob2,"infoObjCourant");if (OBJECTIFS_ADLSEQ){var valeursADL=PF_attr(ob1,"valeursADL");if (valeursADL!=""){recuperationValADLSurObj(valeursADL,ob2);}}/*recupereAttr(ob1,ob2,"dateValidation");*/}function recuperationValADLSurObj(valeursADL,ob2){var tabV=valeursADL.split("/");recupereAttrValAdl(tabV,ob2,"ProgressStatus",0);recupereAttrValAdl(tabV,ob2,"CompletionStatus",1);recupereAttrValAdl(tabV,ob2,"ProgressMeasureStatus",2);recupereAttrValAdl(tabV,ob2,"ProgressMeasure",3);recupereAttrValAdl(tabV,ob2,"RawScore",4);recupereAttrValAdl(tabV,ob2,"MinScore",5);recupereAttrValAdl(tabV,ob2,"MaxScore",6);}function recupereAttrValAdl(tabV,obj,attr,num){if (tabV.length>num && tabV[num]!=""){obj.setAttribute("attempt"+attr,tabV[num]);}}function donneLex(num){return window.parent.donneLex(num);}function donneNoeudsNS(objXML,ns,balise){if (progIDMSXML=="Msxml2.DOMDocument.6.0" || (parent.estMoz && objXML.selectNodes)){return objXML.selectNodes(".//*[local-name()='"+balise+"']");} else {if (progIDMSXML=="Msxml2.DOMDocument.3.0"){if (ns!=""){balise=ns+":"+balise;}}return objXML.getElementsByTagName(balise);}}function initDimPopup(val){var res="";var obj=parent.XML_trouveNoeudNS(parent.objXSL,"xsl","template","name",val);if (obj!=null){res=parent.XML_texteNoeud(obj);}return res;}function surMenuCtxt(event){return true;}function repercuteMapDocument(oDoc){var objectif=donneObjectifCible(oDoc,false);if (objectif!=null){var lesmaps=parent.XML_tabElementFils(objectif);var lid="";for (var i=0;i<lesmaps.length;i++){var oFils=lesmaps[i];if (oFils.nodeName.indexOf("mapInfo")>=0){if (PF_attr(oFils,"writeSatisfiedStatus")=="true"){lid=PF_attr(oFils,"targetObjectiveID");var lesautremaps=donneNoeudsNS(activiteRacine,"imsss","mapInfo");if (lesautremaps.length==0){lesautremaps=donneNoeudsNS(activiteRacine,"","mapInfo");}var typeLire="readSatisfiedStatus";for (var m=0;m<lesautremaps.length;m++){var oMap;if (parent.estMoz){oMap=lesautremaps[m];}else {oMap=lesautremaps[m];}if (PF_attr(oMap,"targetObjectiveID")==lid && PF_attr(oMap,typeLire)!="false"){var actiAnce=oMap.parentNode.parentNode.parentNode.parentNode;var lidan=actiAnce.getAttribute("identifier");if (oDoc.getAttribute("identifier")!=lidan){ajouteItemTestPlan(actiAnce);}}}break;}}}}}function ajouteItemTestPlan(oAct){var codeItem=oAct.getAttribute("identifier");if (!MODE_PREEMPTIF && !tabContient(tabTestItemPlan,codeItem)){tabTestItemPlan.push(codeItem);oAct.removeAttribute("planDejaFait");var obj=parent.XML_trouveNoeud(itemRacine,"item","identifier",codeItem);if (obj==null && PF_attr(itemRacine,"identifier")==codeItem){obj=itemRacine;}if (obj){obj.removeAttribute("planDejaFait");nettoyerDejaFaitFils(obj);}}}function NAVIG_allerSuivant(){parent.haut.NAVIG_allerSuivant();}function NAVIG_allerPrecedent(){parent.haut.NAVIG_allerPrecedent();}function PLAN_choixRacine(){clicItem("_racine");}function PLAN_choixSequenceParent(){if (itemCourant!=null){if (itemCourant.parentNode.nodeName=="item"){if (itemCourant.previousSibling && itemCourant.previousSibling.nodeName=="item"){return clicItem(itemCourant.parentNode.getAttribute("nom"));} else {var oGrandPere=itemCourant.parentNode.parentNode;if (oGrandPere && oGrandPere.nodeName=="item"){return clicItem(oGrandPere.getAttribute("nom"));}}}}clicItem("_racine");}function nettoyerDejaFaitFils(obj){obj.removeAttribute("planDejaFait");var tabFils=donneLesFils(obj,"item");for (var j=0;j<tabFils.length;j++){tabFils[j].removeAttribute("planDejaFait");}}function nettoyerDejaFait(oAnc){var nettoieTout=false;if (existeChoixSortie){nettoieTout=true;} else {oAnc.removeAttribute("planDejaFait");if (tabItemsVerif.length>0){while (oAnc!=null&&(oAnc.nodeName=="item"||oAnc.nodeName=="organization")){oAnc=oAnc.parentNode;if (tabContient(tabItemsVerif,PF_attr(oAnc,"identifier"))){if (constrainedChoiceConsiderations(oAnc,"constrainChoice")=="true"){nettoieTout=true;oAnc=null;} else {nettoyerDejaFaitFils(oAnc);}}}}}if (nettoieTout){var lesitems=parent.XML_listeParBalise(itemRacine,"item");for (var i=0;i<lesitems.length;i++){lesitems[i].removeAttribute("planDejaFait");}itemRacine.removeAttribute("planDejaFait");}}function appliqueDefautNS(Dom0){if (Dom0.nodeType==1){Dom0=Dom0.ownerDocument;}if (progIDMSXML=="Msxml2.DOMDocument.6.0"){Dom0.setProperty("SelectionNamespaces","xmlns:dflt='http://www.imsglobal.org/xsd/imscp_v1p1' xmlns:adlseq='http://www.adlnet.org/xsd/adlseq_v1p3' xmlns:adlnav='http://www.adlnet.org/xsd/adlnav_v1p3' xmlns:imsss='http://www.imsglobal.org/xsd/imsss' xmlns:adlcp='http://www.adlnet.org/xsd/adlcp_v1p3'");}if (parent.estMoz){Dom0.defaultNS="http://www.imsglobal.org/xsd/imscp_v1p1";}}function PLAN_bloqueRetour(evt){if (evt==null){evt=window.event;}if (evt.keyCode==8){var cible=evt.target; if (!parent.estMoz){cible=evt.srcElement;} if (cible!=null && cible.id=="STY_champRechercheInterne"){return true;}evt.returnValue=false;evt.cancelBubble=true;try {evt.stopPropagation();evt.preventDefault();}catch(e){}return false;}return true;}function desactCDroit(event){if (event){event.stopPropagation();event.returnValue=false;} else {window.event.returnValue=false;}return false;}function desactiverClicDroit(){document.getElementsByTagName("html")[0].oncontextmenu=desactCDroit;}var oFlashIntBarPlan=null;function NAVIG_initFlashNavBar(){var oDiv=PF_donneObjet("FlashNavBar");if (oDiv==null){oDiv=window.document;}var tabWM=oDiv.getElementsByTagName('object');if (tabWM.length>0){oFlashIntBarPlan=tabWM[0];if (parent.estMoz){oFlashIntBarPlan=document.embeds[oFlashIntBar.id];}}}function userLanguage(){return parent.LANGUE;}function getCourseTitle(){return parent.serveur.titreStage;}function relierNoeudExterne(itemTmp,oRessources){var idref=PF_attr(itemTmp,"identifierref");if (idref==""){return true;}var oRess=parent.XML_trouveNoeud(oRessources,"resource","identifier",idref);if (oRess!=null){var lhref=PF_attr(oRess,"href");if (lhref.indexOf("/imsmanifest.xml")>0){var adrManifExterne=lhref;if (lhref.indexOf("../")==0){adrManifExterne=parent.RACINE_stage+lhref;adrManifExterne=adrManifExterne.replace("/"+parent.serveur.codeStage+"/../","/");}var DOMManifestExterne=parent.IU_objDom();appliqueDefautNS(DOMManifestExterne);var succ=DOMManifestExterne.load(adrManifExterne);if (succ && (DOMManifestExterne.documentElement.nodeName=="manifest")){var orgaExterne=parent.XML_premierNoeud(DOMManifestExterne.documentElement,"organization");if (orgaExterne!=null){var oItemExt=parent.XML_trouveNoeud(orgaExterne,"item","identifier",itemTmp.getAttribute("identifier"));if (oItemExt!=null){orgaExterne=oItemExt;}itemTmp.removeAttribute("identifierref");var recupTitre=parent.XML_texteNoeud(parent.XML_fils(itemTmp,"title"));while (itemTmp.childNodes.length>0){itemTmp.removeChild(itemTmp.firstChild);}var lesitemsext=parent.XML_listeParBalise(orgaExterne,"item");for (var r=0;r<lesitemsext.length;r++){var oExiste=parent.XML_trouveNoeud(itemRacine,"item","identifier",PF_attr(lesitemsext[r],"identifier"));if (oExiste!=null){var msgDupli="Duplicated ID. Item "+PF_attr(oExiste,"identifier")+" already exists.";msgDupli+=" \nPlease change this identifier in the content editor by right-clicking on the identifier."; if (parent.LANGUE=="fr"){msgDupli="Identifiant dupliqu\xE9. L'item "+PF_attr(oExiste,"identifier")+" existe d\xE9ja.";msgDupli+=" \nChangez l'identifiant dans l'\xE9diteur de contenu avec un clic-droit sur l'identifiant.";}alert(msgDupli);return false;}}for (var hh=orgaExterne.childNodes.length-1;hh>=0;hh--){var oInsertD=orgaExterne.childNodes[hh];if (parent.estMoz){oInsertD=itemTmp.ownerDocument.importNode(oInsertD,true);}itemTmp.insertBefore(oInsertD,itemTmp.firstChild);}var oTitreN=parent.XML_fils(itemTmp,"title");parent.XML_modifTexteNoeud(oTitreN,recupTitre);var oRessourcesExternes=parent.XML_fils(DOMManifestExterne.documentElement,"resources");if (oRessourcesExternes!=null){adrManifExterne=adrManifExterne.substring(0,adrManifExterne.length-15);var lesitemsext=parent.XML_listeParBalise(itemTmp,"item");for (var r=0;r<lesitemsext.length;r++){var oRess=parent.XML_trouveNoeud(oRessourcesExternes,"resource","identifier",PF_attr(lesitemsext[r],"identifierref"));if (oRess!=null){var idDupli=PF_attr(lesitemsext[r],"idDupli");if (idDupli!=""){oRess.setAttribute("identifier",idDupli+PF_attr(oRess,"identifier"));lesitemsext[r].setAttribute("identifierref",PF_attr(oRess,"identifier"));lesitemsext[r].removeAttribute("idDupli");}var lhrefext=PF_attr(oRess,"href");if (lhrefext.match(oRegScheme)==null){var base="";base=PF_attr(DOMManifestExterne.documentElement,"xml:base");base+=PF_attr(oRess.parentNode,"xml:base");base+=PF_attr(oRess,"xml:base");lhrefext=base+lhrefext;if (lhrefext.indexOf("../")!=0){oRess.setAttribute("href",adrManifExterne+lhrefext);}}if (parent.estMoz){oRess=oRessources.ownerDocument.importNode(oRess,true);}oRessources.appendChild(oRess);}}}lesitemsext=parent.XML_listeParBalise(itemTmp,"item");for (var r=0;r<lesitemsext.length;r++){if (!relierNoeudExterne(lesitemsext[r],oRessources)){return false;}}}}}}return true;}function choixItemLineairePossible(oActivite){if (OBJ_DESACTIVE_ITEM==""){return true;}if (estRacine(oActivite)){return true;}if (OBJ_DESACTIVE_ITEM=="always"){return false;}if (OBJ_DESACTIVE_ITEM=="notAttempted" && attrObj(oActivite,"activityProgressStatus")=="true" && parseInt(attrObj(oActivite,"attemptCount"))>0){if (!estFeuille(oActivite)){var premFeuille=premiereFeuillePourChoixObj(oActivite);if (premFeuille==null || !choixItemLineairePossible(premFeuille)){return false;}}return true;}if (OBJ_DESACTIVE_ITEM=="notCompleted"||OBJ_DESACTIVE_ITEM=="notSatisfied"){var nattr="dateCompletion";if (OBJ_DESACTIVE_ITEM=="notSatisfied"){nattr="dateValidation";}if (PF_attr(oActivite,nattr)!=""){return true;}return itemValidePourChoixObj(derniereFeuillePourChoixObj(oActivite),nattr);}if (OBJ_DESACTIVE_ITEM=="courseNotCompleted"){return PF_attr(itemRacine,"dateCompletion")!="";}return false;}function premiereFeuillePourChoixObj(oItem){if (!estFeuille(oItem)){var itmsfils=parent.XML_listeParBalise(oItem,"item");if (itmsfils.length>0){return premiereFeuillePourChoixObj(itmsfils[0]);}return null;} else {return oItem;}}function derniereFeuillePourChoixObj(oItem){var oPrec=oItem.previousSibling;if (oPrec!=null && oPrec.nodeName=="item"){if (!estFeuille(oPrec)){var itmsfils=parent.XML_listeParBalise(oPrec,"item");if (itmsfils.length>0){oPrec=itmsfils[itmsfils.length-1];}}return oPrec;} else {oPrec=oItem.parentNode;if (estRacine(oPrec)){return oPrec;}return derniereFeuillePourChoixObj(oPrec);}}function itemValidePourChoixObj(oPrec,nattr){if (PF_attr(oPrec,nattr)!=""){return true;}if (PF_attr(oPrec,"dateAfficheDoc")!=""){return true;}if (PF_attr(oPrec,"attemptCount")!=""&&PF_attr(oPrec,"identifierref")!=""){var oRessource=parent.XML_trouveNoeud(DOMManifest,"resource","identifier",PF_attr(oPrec,"identifierref"));if (PF_attr(oRessource,"adlcp:scormType")=="asset"){return true;}}return false;}function marquerAccesCorrigeAdmin(oActivite){var tabCheminActivites=formerCheminAct(oActivite,true,activiteRacine,true);for (var i=tabCheminActivites.length-1;i>=0;i--){if (deliveryControls(tabCheminActivites[i],"tracked")=="true"){var nbEssai=parseInt(attrObj(tabCheminActivites[i],"attemptCount"));if (nbEssai=="0"){tabCheminActivites[i].setAttribute("attemptCount","1");}tabCheminActivites[i].setAttribute("activityProgressStatus","true");}}}function reduitEspaceID(str){str=str.replace(/%20/g,' ');str=str.replace(/^\s\s*/,'').replace(/\s\s*$/,'');str=str.replace(/\s\s*/g," ");return str;}function reduireIdObjs(ns){var lesobjs=donneNoeudsNS(itemRacine,ns,"objective");for (var n=0;n<lesobjs.length;n++){var lid=PF_attr(lesobjs[n],"objectiveID");if (lid!=reduitEspaceID(lid)){lesobjs[n].setAttribute("objectiveID",reduitEspaceID(lid));}var lesmaps=donneNoeudsNS(lesobjs[n],ns,"mapInfo");for (var m=0;m<lesmaps.length;m++){lid=PF_attr(lesmaps[m],"targetObjectiveID");if (lid!=reduitEspaceID(lid)){lesmaps[m].setAttribute("targetObjectiveID",reduitEspaceID(lid));}}}}function reduireIdentifiantsPlan(bal){var lesobjs=donneNoeudsNS(DOMManifest.documentElement,"",bal);for (var n=0;n<lesobjs.length;n++){var lid=PF_attr(lesobjs[n],"identifier");if (lid!=reduitEspaceID(lid)){lesobjs[n].setAttribute("identifier",reduitEspaceID(lid));}if (bal=="item"){lid=PF_attr(lesobjs[n],"identifierref");if (lid!=reduitEspaceID(lid)){lesobjs[n].setAttribute("identifierref",reduitEspaceID(lid));}}}}function prendAttrEtEnleve(DOMManifest,attr){var val=PF_attr(DOMManifest.documentElement,attr);DOMManifest.documentElement.removeAttribute(attr);return val;}function declencheAnimationBascule1(oBasc){if (window.tabIdAnimBascule==null){tabIdAnimBascule=new Array();}tabIdAnimBascule.push(oBasc);var numPointeur=tabIdAnimBascule.length-1;oBasc.style.webkitTransitionProperty="none";oBasc.style.MozTransitionProperty="none";oBasc.style.visible="hidden";oBasc.style.display="block";var hautFin=valCSS(oBasc,"","height",parent.estMoz);var padH=valCSS(oBasc,"","padding-top",parent.estMoz);var padB=valCSS(oBasc,"","padding-bottom",parent.estMoz);if (transitionCssBascule.indexOf("height")>=0){oBasc.style.height="0px";oBasc.style.overflow="hidden";}if (transitionCssBascule.indexOf("padding")>=0){oBasc.style.paddingTop="0px";oBasc.style.paddingBottom="0px";}if (transitionCssBascule.indexOf("opacity")>=0){oBasc.style.opacity="0";}setTimeout("declencheAnimationBascule2("+numPointeur+",'"+hautFin+"','"+padH+"','"+padB+"')",50);}function declencheAnimationBascule2(numPointeur,hautFin,padH,padB){var oBasc=tabIdAnimBascule[numPointeur];oBasc.style.webkitTransitionProperty=transitionCssBascule;oBasc.style.MozTransitionProperty=transitionCssBascule;oBasc.style.webkitTransitionDuration=dureeTransitionCssBascule;oBasc.style.MozTransitionDuration=dureeTransitionCssBascule;oBasc.style.visible="";if (transitionCssBascule.indexOf("height")>=0){oBasc.style.height=hautFin;}if (transitionCssBascule.indexOf("padding")>=0){oBasc.style.paddingTop=padH;oBasc.style.paddingBottom=padB;}if (transitionCssBascule.indexOf("opacity")>=0){oBasc.style.opacity="1";}setTimeout("declencheAnimationBascule3("+numPointeur+")",dureeTransitionCssObjet());}function dureeTransitionCssObjet(){var ts=dureeTransitionCssBascule;ts=ts.split(" ")[0];ts=ts.replace("s","");ts=ts.replace(",","");return Number(ts)*1000;}function declencheAnimationBascule3(numPointeur){var oBasc=tabIdAnimBascule[numPointeur];oBasc.style.webkitTransitionProperty="none";oBasc.style.MozTransitionProperty="none";oBasc.style.height=null;oBasc.style.opacity=null;PLAN_menuPopInterne(false);}function refermeAnimationBascule1(lid){if (window.tabIdAnimBascule==null){tabIdAnimBascule=new Array();}var numPointeur=-1;for (var i=0;i<tabIdAnimBascule.length;i++){if (lid==tabIdAnimBascule[i].id){numPointeur=i;break;}}if (numPointeur<0){tabIdAnimBascule.push(PF_donneObjet(lid));numPointeur=tabIdAnimBascule.length-1;}var oBasc=tabIdAnimBascule[numPointeur];if (transitionCssBascule.indexOf("height")>=0){oBasc.style.height=valCSS(oBasc,"","height",parent.estMoz);}setTimeout("refermeAnimationBascule2("+numPointeur+")",50);}function refermeAnimationBascule2(numPointeur){ var oBasc=tabIdAnimBascule[numPointeur];oBasc.style.webkitTransitionProperty=transitionCssBascule;oBasc.style.MozTransitionProperty=transitionCssBascule;oBasc.style.webkitTransitionDuration=dureeTransitionCssBascule;oBasc.style.MozTransitionDuration=dureeTransitionCssBascule;if (transitionCssBascule.indexOf("height")>=0){oBasc.style.overflow="hidden";oBasc.style.height="0";}if (transitionCssBascule.indexOf("padding")>=0){oBasc.style.paddingTop="0";oBasc.style.paddingBottom="0";}if (transitionCssBascule.indexOf("opacity")>=0){oBasc.style.opacity="0";}setTimeout("refermeAnimationBascule3("+numPointeur+")",dureeTransitionCssObjet());}function refermeAnimationBascule3(numPointeur){var oBasc=tabIdAnimBascule[numPointeur];oBasc.style.webkitTransitionProperty="none";oBasc.style.MozTransitionProperty="none";oBasc.style.display="none";oBasc.style.height=null;oBasc.style.paddingTop=null;oBasc.style.paddingBottom=null;oBasc.style.opacity=null;PLAN_menuPopInterne();}function adrPageBlanche(){if (parent.SUR_CHORUS){return "about:blank";}return parent.RACINE_stage+"MosMtr/gen/blanc.htm";}function remonteSiEtatManque(){if (itemRacine){var lesitems=parent.XML_listeParBalise(itemRacine,"item");var tabItemTraite=new Array();for (var i=0;i<lesitems.length;i++){if (!estFeuille(lesitems[i])){tabItemTraite.push(lesitems[i]);}}tabItemTraite.push(itemRacine);for (var i=0;i<tabItemTraite.length;i++){var manqueCompletion=false;var premFils=null;if (PF_attr(tabItemTraite[i],"attemptCompletionStatus")!="true"){manqueCompletion=true;var tabFils=donneLesFils(tabItemTraite[i],"item");for (var n=0;n<tabFils.length;n++){if (PF_attr(tabFils[n],"attemptCompletionStatus")!="true"){manqueCompletion=false;}}premFils=tabFils[0];}var manqueReussite=false;if (PF_attr(tabItemTraite[i],"objectiveSatisfiedStatus")!="true"){manqueReussite=true;var tabFils=donneLesFils(tabItemTraite[i],"item");for (var n=0;n<tabFils.length;n++){if (PF_attr(tabFils[n],"objectiveSatisfiedStatus")!="true"){manqueReussite=false;}}premFils=tabFils[0];}var manqueScore=false;var rObjPere=donneObjectifCible(tabItemTraite[i],false);if (rObjPere && PF_attr(rObjPere,"objectiveMeasureStatus")!="true"){var tabFils=donneLesFils(tabItemTraite[i],"item");for (var n=0;n<tabFils.length;n++){var rObj=donneObjectifCible(tabFils[n],false);if (rObj && PF_attr(rObj,"objectiveMeasureStatus")=="true"){manqueScore=true;}}premFils=tabFils[0];}if (manqueCompletion||manqueReussite||manqueScore){if (premFils){overallRollup(premFils);}}}}}function PLAN_afficheMessageActivitePlan(){var objD=PF_donneObjet("STY_msgInactivite");if (objD==null){objD=document.createElement("div");objD.setAttribute("class","STY_msgInactivite");objD.setAttribute("id","STY_msgInactivite");objD.setAttribute("style","position:absolute;z-index:999");objD.id="STY_msgInactivite";objD.className="STY_msgInactivite";var msgH=donneLex(615)+'<br><br><button onclick="PLAN_basculeResterActif()">&#160;OK&#160;</button><br>';objD.innerHTML=msgH;document.body.appendChild(objD);window.fenActifOvrt=objD;if (!PLAN_planEstAffiche()){window.refermePlanApresContinueActif=true;}setTimeout("PLAN_finChoixTM()",90000);}PLAN_affichagePlan("oui");PF_masquerDiv("STY_planArborescence");}function PLAN_basculeResterActif(){dateDerniereActionLMS=(new Date()).getTime();if (window.fenActifOvrt){window.fenActifOvrt.parentNode.removeChild(window.fenActifOvrt);window.fenActifOvrt=null;PF_afficherDiv("STY_planArborescence");if (window.refermePlanApresContinueActif){window.refermePlanApresContinueActif=null;PLAN_affichagePlan("non");}}}function PLAN_finChoixTM(){if (window.fenActifOvrt!=null){dateDerniereActionLMS=null;parent.haut.NAVIG_retour("suspendAll");}}
